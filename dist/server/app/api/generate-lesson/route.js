"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate-lesson/route";
exports.ids = ["app/api/generate-lesson/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_linguaspark_app_api_generate_lesson_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate-lesson/route.ts */ \"(rsc)/./app/api/generate-lesson/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate-lesson/route\",\n        pathname: \"/api/generate-lesson\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-lesson/route\"\n    },\n    resolvedPagePath: \"D:\\\\linguaspark\\\\app\\\\api\\\\generate-lesson\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_linguaspark_app_api_generate_lesson_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate-lesson/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZS1sZXNzb24lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmdlbmVyYXRlLWxlc3NvbiUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmdlbmVyYXRlLWxlc3NvbiUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDbGluZ3Vhc3BhcmslNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNsaW5ndWFzcGFyayZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDSTtBQUNqRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvPzI3ZDQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiRDpcXFxcbGluZ3Vhc3BhcmtcXFxcYXBwXFxcXGFwaVxcXFxnZW5lcmF0ZS1sZXNzb25cXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlLWxlc3NvblwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZ2VuZXJhdGUtbGVzc29uL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiRDpcXFxcbGluZ3Vhc3BhcmtcXFxcYXBwXFxcXGFwaVxcXFxnZW5lcmF0ZS1sZXNzb25cXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate-lesson/route.ts":
/*!******************************************!*\
  !*** ./app/api/generate-lesson/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_lesson_ai_generator_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/lesson-ai-generator-server */ \"(rsc)/./lib/lesson-ai-generator-server.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n\n // Updated import to use server-side generator\n\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { sourceText, lessonType, studentLevel, targetLanguage, sourceUrl, contentMetadata, structuredContent, wordCount, readingTime } = body;\n        // Validate required fields\n        if (!sourceText || !lessonType || !studentLevel || !targetLanguage) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing required fields\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate user authentication\n        const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__.createServerSupabaseClient)();\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\n        if (authError || !user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication required\"\n            }, {\n                status: 401\n            });\n        }\n        // Generate lesson using enhanced AI pipeline with contextual information\n        const lesson = await _lib_lesson_ai_generator_server__WEBPACK_IMPORTED_MODULE_1__.lessonAIServerGenerator.generateLesson({\n            sourceText,\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sourceUrl,\n            contentMetadata,\n            structuredContent,\n            wordCount,\n            readingTime\n        });\n        console.log(\"\\uD83C\\uDF93 Generated lesson structure:\", {\n            hasLesson: !!lesson,\n            hasSections: !!lesson?.sections,\n            sectionKeys: lesson?.sections ? Object.keys(lesson.sections) : [],\n            lessonType: lesson?.lessonType,\n            studentLevel: lesson?.studentLevel,\n            targetLanguage: lesson?.targetLanguage\n        });\n        // Ensure lesson has proper structure\n        const safeLesson = {\n            lessonType: lesson.lessonType || lessonType,\n            studentLevel: lesson.studentLevel || studentLevel,\n            targetLanguage: lesson.targetLanguage || targetLanguage,\n            sections: {\n                warmup: lesson.sections?.warmup || [\n                    \"What do you already know about this topic?\",\n                    \"Have you had similar experiences?\",\n                    \"What would you like to learn more about?\"\n                ],\n                vocabulary: lesson.sections?.vocabulary || [],\n                reading: lesson.sections?.reading || sourceText.substring(0, 500),\n                comprehension: lesson.sections?.comprehension || [\n                    \"What is the main idea of this text?\",\n                    \"What supporting details can you identify?\"\n                ],\n                discussion: lesson.sections?.discussion || [\n                    \"What is your opinion on this topic?\",\n                    \"How would you handle this situation?\"\n                ],\n                grammar: lesson.sections?.grammar || {\n                    focus: \"Present Perfect Tense\",\n                    examples: [\n                        \"I have learned many new things.\",\n                        \"She has improved her skills.\"\n                    ],\n                    exercise: [\n                        \"I _____ (learn) a lot today.\",\n                        \"They _____ (complete) the project.\"\n                    ]\n                },\n                pronunciation: lesson.sections?.pronunciation || {\n                    word: \"communication\",\n                    ipa: \"/kəˌmjuːnɪˈkeɪʃən/\",\n                    practice: \"Practice saying: communication in a sentence.\"\n                },\n                wrapup: lesson.sections?.wrapup || [\n                    \"What new vocabulary did you learn?\",\n                    \"Which concepts need more practice?\"\n                ]\n            }\n        };\n        console.log(\"✅ Safe lesson structure created with all required sections\");\n        // Save lesson to database\n        const { data: savedLesson, error: saveError } = await supabase.from(\"lessons\").insert({\n            tutor_id: user.id,\n            title: `${lessonType} Lesson - ${new Date().toLocaleDateString()}`,\n            lesson_type: lessonType,\n            student_level: studentLevel,\n            target_language: targetLanguage,\n            source_url: sourceUrl,\n            source_text: sourceText,\n            lesson_data: safeLesson\n        }).select().single();\n        if (saveError) {\n            console.error(\"Error saving lesson:\", saveError);\n            // Return lesson even if save fails\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                lesson: safeLesson\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            lesson: {\n                ...safeLesson,\n                id: savedLesson.id\n            }\n        });\n    } catch (error) {\n        console.error(\"Error generating lesson:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate lesson\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTREO0FBQ2MsQ0FBQyw4Q0FBOEM7QUFDdkQ7QUFFM0QsZUFBZUcsS0FBS0MsT0FBb0I7SUFDN0MsSUFBSTtRQUNGLE1BQU1DLE9BQU8sTUFBTUQsUUFBUUUsSUFBSTtRQUMvQixNQUFNLEVBQ0pDLFVBQVUsRUFDVkMsVUFBVSxFQUNWQyxZQUFZLEVBQ1pDLGNBQWMsRUFDZEMsU0FBUyxFQUNUQyxlQUFlLEVBQ2ZDLGlCQUFpQixFQUNqQkMsU0FBUyxFQUNUQyxXQUFXLEVBQ1osR0FBR1Y7UUFFSiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDRSxjQUFjLENBQUNDLGNBQWMsQ0FBQ0MsZ0JBQWdCLENBQUNDLGdCQUFnQjtZQUNsRSxPQUFPVixxREFBWUEsQ0FBQ00sSUFBSSxDQUFDO2dCQUFFVSxPQUFPO1lBQTBCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUMvRTtRQUVBLCtCQUErQjtRQUMvQixNQUFNQyxXQUFXaEIsZ0ZBQTBCQTtRQUMzQyxNQUFNLEVBQ0ppQixNQUFNLEVBQUVDLElBQUksRUFBRSxFQUNkSixPQUFPSyxTQUFTLEVBQ2pCLEdBQUcsTUFBTUgsU0FBU0ksSUFBSSxDQUFDQyxPQUFPO1FBRS9CLElBQUlGLGFBQWEsQ0FBQ0QsTUFBTTtZQUN0QixPQUFPcEIscURBQVlBLENBQUNNLElBQUksQ0FBQztnQkFBRVUsT0FBTztZQUEwQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDL0U7UUFFQSx5RUFBeUU7UUFDekUsTUFBTU8sU0FBUyxNQUFNdkIsb0ZBQXVCQSxDQUFDd0IsY0FBYyxDQUFDO1lBQzFEbEI7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7UUFDRjtRQUVBVyxRQUFRQyxHQUFHLENBQUMsNENBQWtDO1lBQzVDQyxXQUFXLENBQUMsQ0FBQ0o7WUFDYkssYUFBYSxDQUFDLENBQUNMLFFBQVFNO1lBQ3ZCQyxhQUFhUCxRQUFRTSxXQUFXRSxPQUFPQyxJQUFJLENBQUNULE9BQU9NLFFBQVEsSUFBSSxFQUFFO1lBQ2pFdEIsWUFBWWdCLFFBQVFoQjtZQUNwQkMsY0FBY2UsUUFBUWY7WUFDdEJDLGdCQUFnQmMsUUFBUWQ7UUFDMUI7UUFFQSxxQ0FBcUM7UUFDckMsTUFBTXdCLGFBQWE7WUFDakIxQixZQUFZZ0IsT0FBT2hCLFVBQVUsSUFBSUE7WUFDakNDLGNBQWNlLE9BQU9mLFlBQVksSUFBSUE7WUFDckNDLGdCQUFnQmMsT0FBT2QsY0FBYyxJQUFJQTtZQUN6Q29CLFVBQVU7Z0JBQ1JLLFFBQVFYLE9BQU9NLFFBQVEsRUFBRUssVUFBVTtvQkFBQztvQkFBOEM7b0JBQXFDO2lCQUEyQztnQkFDbEtDLFlBQVlaLE9BQU9NLFFBQVEsRUFBRU0sY0FBYyxFQUFFO2dCQUM3Q0MsU0FBU2IsT0FBT00sUUFBUSxFQUFFTyxXQUFXOUIsV0FBVytCLFNBQVMsQ0FBQyxHQUFHO2dCQUM3REMsZUFBZWYsT0FBT00sUUFBUSxFQUFFUyxpQkFBaUI7b0JBQUM7b0JBQXVDO2lCQUE0QztnQkFDcklDLFlBQVloQixPQUFPTSxRQUFRLEVBQUVVLGNBQWM7b0JBQUM7b0JBQXVDO2lCQUF1QztnQkFDMUhDLFNBQVNqQixPQUFPTSxRQUFRLEVBQUVXLFdBQVc7b0JBQ25DQyxPQUFPO29CQUNQQyxVQUFVO3dCQUFDO3dCQUFtQztxQkFBK0I7b0JBQzdFQyxVQUFVO3dCQUFDO3dCQUFnQztxQkFBcUM7Z0JBQ2xGO2dCQUNBQyxlQUFlckIsT0FBT00sUUFBUSxFQUFFZSxpQkFBaUI7b0JBQy9DQyxNQUFNO29CQUNOQyxLQUFLO29CQUNMQyxVQUFVO2dCQUNaO2dCQUNBQyxRQUFRekIsT0FBT00sUUFBUSxFQUFFbUIsVUFBVTtvQkFBQztvQkFBc0M7aUJBQXFDO1lBQ2pIO1FBQ0Y7UUFFQXZCLFFBQVFDLEdBQUcsQ0FBQztRQUVaLDBCQUEwQjtRQUMxQixNQUFNLEVBQUVSLE1BQU0rQixXQUFXLEVBQUVsQyxPQUFPbUMsU0FBUyxFQUFFLEdBQUcsTUFBTWpDLFNBQ25Ea0MsSUFBSSxDQUFDLFdBQ0xDLE1BQU0sQ0FBQztZQUNOQyxVQUFVbEMsS0FBS21DLEVBQUU7WUFDakJDLE9BQU8sQ0FBQyxFQUFFaEQsV0FBVyxVQUFVLEVBQUUsSUFBSWlELE9BQU9DLGtCQUFrQixHQUFHLENBQUM7WUFDbEVDLGFBQWFuRDtZQUNib0QsZUFBZW5EO1lBQ2ZvRCxpQkFBaUJuRDtZQUNqQm9ELFlBQVluRDtZQUNab0QsYUFBYXhEO1lBQ2J5RCxhQUFhOUI7UUFDZixHQUNDK0IsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSWYsV0FBVztZQUNiekIsUUFBUVYsS0FBSyxDQUFDLHdCQUF3Qm1DO1lBQ3RDLG1DQUFtQztZQUNuQyxPQUFPbkQscURBQVlBLENBQUNNLElBQUksQ0FBQztnQkFBRWtCLFFBQVFVO1lBQVc7UUFDaEQ7UUFFQSxPQUFPbEMscURBQVlBLENBQUNNLElBQUksQ0FBQztZQUN2QmtCLFFBQVE7Z0JBQ04sR0FBR1UsVUFBVTtnQkFDYnFCLElBQUlMLFlBQVlLLEVBQUU7WUFDcEI7UUFDRjtJQUNGLEVBQUUsT0FBT3ZDLE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFDLDRCQUE0QkE7UUFDMUMsT0FBT2hCLHFEQUFZQSxDQUFDTSxJQUFJLENBQUM7WUFBRVUsT0FBTztRQUE0QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNqRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2FwcC9hcGkvZ2VuZXJhdGUtbGVzc29uL3JvdXRlLnRzPzVhYmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCJcbmltcG9ydCB7IGxlc3NvbkFJU2VydmVyR2VuZXJhdG9yIH0gZnJvbSBcIkAvbGliL2xlc3Nvbi1haS1nZW5lcmF0b3Itc2VydmVyXCIgLy8gVXBkYXRlZCBpbXBvcnQgdG8gdXNlIHNlcnZlci1zaWRlIGdlbmVyYXRvclxuaW1wb3J0IHsgY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Utc2VydmVyXCJcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IFxuICAgICAgc291cmNlVGV4dCwgXG4gICAgICBsZXNzb25UeXBlLCBcbiAgICAgIHN0dWRlbnRMZXZlbCwgXG4gICAgICB0YXJnZXRMYW5ndWFnZSwgXG4gICAgICBzb3VyY2VVcmwsXG4gICAgICBjb250ZW50TWV0YWRhdGEsXG4gICAgICBzdHJ1Y3R1cmVkQ29udGVudCxcbiAgICAgIHdvcmRDb3VudCxcbiAgICAgIHJlYWRpbmdUaW1lXG4gICAgfSA9IGJvZHlcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghc291cmNlVGV4dCB8fCAhbGVzc29uVHlwZSB8fCAhc3R1ZGVudExldmVsIHx8ICF0YXJnZXRMYW5ndWFnZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyByZXF1aXJlZCBmaWVsZHNcIiB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgdXNlciBhdXRoZW50aWNhdGlvblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQoKVxuICAgIGNvbnN0IHtcbiAgICAgIGRhdGE6IHsgdXNlciB9LFxuICAgICAgZXJyb3I6IGF1dGhFcnJvcixcbiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKClcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGxlc3NvbiB1c2luZyBlbmhhbmNlZCBBSSBwaXBlbGluZSB3aXRoIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICBjb25zdCBsZXNzb24gPSBhd2FpdCBsZXNzb25BSVNlcnZlckdlbmVyYXRvci5nZW5lcmF0ZUxlc3Nvbih7XG4gICAgICBzb3VyY2VUZXh0LFxuICAgICAgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgc291cmNlVXJsLFxuICAgICAgY29udGVudE1ldGFkYXRhLFxuICAgICAgc3RydWN0dXJlZENvbnRlbnQsXG4gICAgICB3b3JkQ291bnQsXG4gICAgICByZWFkaW5nVGltZSxcbiAgICB9KVxuXG4gICAgY29uc29sZS5sb2coXCLwn46TIEdlbmVyYXRlZCBsZXNzb24gc3RydWN0dXJlOlwiLCB7XG4gICAgICBoYXNMZXNzb246ICEhbGVzc29uLFxuICAgICAgaGFzU2VjdGlvbnM6ICEhbGVzc29uPy5zZWN0aW9ucyxcbiAgICAgIHNlY3Rpb25LZXlzOiBsZXNzb24/LnNlY3Rpb25zID8gT2JqZWN0LmtleXMobGVzc29uLnNlY3Rpb25zKSA6IFtdLFxuICAgICAgbGVzc29uVHlwZTogbGVzc29uPy5sZXNzb25UeXBlLFxuICAgICAgc3R1ZGVudExldmVsOiBsZXNzb24/LnN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlOiBsZXNzb24/LnRhcmdldExhbmd1YWdlXG4gICAgfSlcblxuICAgIC8vIEVuc3VyZSBsZXNzb24gaGFzIHByb3BlciBzdHJ1Y3R1cmVcbiAgICBjb25zdCBzYWZlTGVzc29uID0ge1xuICAgICAgbGVzc29uVHlwZTogbGVzc29uLmxlc3NvblR5cGUgfHwgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbDogbGVzc29uLnN0dWRlbnRMZXZlbCB8fCBzdHVkZW50TGV2ZWwsXG4gICAgICB0YXJnZXRMYW5ndWFnZTogbGVzc29uLnRhcmdldExhbmd1YWdlIHx8IHRhcmdldExhbmd1YWdlLFxuICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgd2FybXVwOiBsZXNzb24uc2VjdGlvbnM/Lndhcm11cCB8fCBbXCJXaGF0IGRvIHlvdSBhbHJlYWR5IGtub3cgYWJvdXQgdGhpcyB0b3BpYz9cIiwgXCJIYXZlIHlvdSBoYWQgc2ltaWxhciBleHBlcmllbmNlcz9cIiwgXCJXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGxlYXJuIG1vcmUgYWJvdXQ/XCJdLFxuICAgICAgICB2b2NhYnVsYXJ5OiBsZXNzb24uc2VjdGlvbnM/LnZvY2FidWxhcnkgfHwgW10sXG4gICAgICAgIHJlYWRpbmc6IGxlc3Nvbi5zZWN0aW9ucz8ucmVhZGluZyB8fCBzb3VyY2VUZXh0LnN1YnN0cmluZygwLCA1MDApLFxuICAgICAgICBjb21wcmVoZW5zaW9uOiBsZXNzb24uc2VjdGlvbnM/LmNvbXByZWhlbnNpb24gfHwgW1wiV2hhdCBpcyB0aGUgbWFpbiBpZGVhIG9mIHRoaXMgdGV4dD9cIiwgXCJXaGF0IHN1cHBvcnRpbmcgZGV0YWlscyBjYW4geW91IGlkZW50aWZ5P1wiXSxcbiAgICAgICAgZGlzY3Vzc2lvbjogbGVzc29uLnNlY3Rpb25zPy5kaXNjdXNzaW9uIHx8IFtcIldoYXQgaXMgeW91ciBvcGluaW9uIG9uIHRoaXMgdG9waWM/XCIsIFwiSG93IHdvdWxkIHlvdSBoYW5kbGUgdGhpcyBzaXR1YXRpb24/XCJdLFxuICAgICAgICBncmFtbWFyOiBsZXNzb24uc2VjdGlvbnM/LmdyYW1tYXIgfHwge1xuICAgICAgICAgIGZvY3VzOiBcIlByZXNlbnQgUGVyZmVjdCBUZW5zZVwiLFxuICAgICAgICAgIGV4YW1wbGVzOiBbXCJJIGhhdmUgbGVhcm5lZCBtYW55IG5ldyB0aGluZ3MuXCIsIFwiU2hlIGhhcyBpbXByb3ZlZCBoZXIgc2tpbGxzLlwiXSxcbiAgICAgICAgICBleGVyY2lzZTogW1wiSSBfX19fXyAobGVhcm4pIGEgbG90IHRvZGF5LlwiLCBcIlRoZXkgX19fX18gKGNvbXBsZXRlKSB0aGUgcHJvamVjdC5cIl1cbiAgICAgICAgfSxcbiAgICAgICAgcHJvbnVuY2lhdGlvbjogbGVzc29uLnNlY3Rpb25zPy5wcm9udW5jaWF0aW9uIHx8IHtcbiAgICAgICAgICB3b3JkOiBcImNvbW11bmljYXRpb25cIixcbiAgICAgICAgICBpcGE6IFwiL2vJmcuMbWp1y5BuyarLiGtlyarKg8mZbi9cIixcbiAgICAgICAgICBwcmFjdGljZTogXCJQcmFjdGljZSBzYXlpbmc6IGNvbW11bmljYXRpb24gaW4gYSBzZW50ZW5jZS5cIlxuICAgICAgICB9LFxuICAgICAgICB3cmFwdXA6IGxlc3Nvbi5zZWN0aW9ucz8ud3JhcHVwIHx8IFtcIldoYXQgbmV3IHZvY2FidWxhcnkgZGlkIHlvdSBsZWFybj9cIiwgXCJXaGljaCBjb25jZXB0cyBuZWVkIG1vcmUgcHJhY3RpY2U/XCJdXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCLinIUgU2FmZSBsZXNzb24gc3RydWN0dXJlIGNyZWF0ZWQgd2l0aCBhbGwgcmVxdWlyZWQgc2VjdGlvbnNcIilcblxuICAgIC8vIFNhdmUgbGVzc29uIHRvIGRhdGFiYXNlXG4gICAgY29uc3QgeyBkYXRhOiBzYXZlZExlc3NvbiwgZXJyb3I6IHNhdmVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwibGVzc29uc1wiKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHR1dG9yX2lkOiB1c2VyLmlkLFxuICAgICAgICB0aXRsZTogYCR7bGVzc29uVHlwZX0gTGVzc29uIC0gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpfWAsXG4gICAgICAgIGxlc3Nvbl90eXBlOiBsZXNzb25UeXBlLFxuICAgICAgICBzdHVkZW50X2xldmVsOiBzdHVkZW50TGV2ZWwsXG4gICAgICAgIHRhcmdldF9sYW5ndWFnZTogdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICAgIHNvdXJjZV91cmw6IHNvdXJjZVVybCxcbiAgICAgICAgc291cmNlX3RleHQ6IHNvdXJjZVRleHQsXG4gICAgICAgIGxlc3Nvbl9kYXRhOiBzYWZlTGVzc29uLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoc2F2ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2F2aW5nIGxlc3NvbjpcIiwgc2F2ZUVycm9yKVxuICAgICAgLy8gUmV0dXJuIGxlc3NvbiBldmVuIGlmIHNhdmUgZmFpbHNcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGxlc3Nvbjogc2FmZUxlc3NvbiB9KVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBsZXNzb246IHtcbiAgICAgICAgLi4uc2FmZUxlc3NvbixcbiAgICAgICAgaWQ6IHNhdmVkTGVzc29uLmlkLFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIGxlc3NvbjpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlc3NvblwiIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImxlc3NvbkFJU2VydmVyR2VuZXJhdG9yIiwiY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwic291cmNlVGV4dCIsImxlc3NvblR5cGUiLCJzdHVkZW50TGV2ZWwiLCJ0YXJnZXRMYW5ndWFnZSIsInNvdXJjZVVybCIsImNvbnRlbnRNZXRhZGF0YSIsInN0cnVjdHVyZWRDb250ZW50Iiwid29yZENvdW50IiwicmVhZGluZ1RpbWUiLCJlcnJvciIsInN0YXR1cyIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsImxlc3NvbiIsImdlbmVyYXRlTGVzc29uIiwiY29uc29sZSIsImxvZyIsImhhc0xlc3NvbiIsImhhc1NlY3Rpb25zIiwic2VjdGlvbnMiLCJzZWN0aW9uS2V5cyIsIk9iamVjdCIsImtleXMiLCJzYWZlTGVzc29uIiwid2FybXVwIiwidm9jYWJ1bGFyeSIsInJlYWRpbmciLCJzdWJzdHJpbmciLCJjb21wcmVoZW5zaW9uIiwiZGlzY3Vzc2lvbiIsImdyYW1tYXIiLCJmb2N1cyIsImV4YW1wbGVzIiwiZXhlcmNpc2UiLCJwcm9udW5jaWF0aW9uIiwid29yZCIsImlwYSIsInByYWN0aWNlIiwid3JhcHVwIiwic2F2ZWRMZXNzb24iLCJzYXZlRXJyb3IiLCJmcm9tIiwiaW5zZXJ0IiwidHV0b3JfaWQiLCJpZCIsInRpdGxlIiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsImxlc3Nvbl90eXBlIiwic3R1ZGVudF9sZXZlbCIsInRhcmdldF9sYW5ndWFnZSIsInNvdXJjZV91cmwiLCJzb3VyY2VfdGV4dCIsImxlc3Nvbl9kYXRhIiwic2VsZWN0Iiwic2luZ2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate-lesson/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/google-ai-server.ts":
/*!*********************************!*\
  !*** ./lib/google-ai-server.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createGoogleAIServerService: () => (/* binding */ createGoogleAIServerService)\n/* harmony export */ });\n// Server-side Google AI (Gemini) APIs service layer\nclass GoogleAIServerService {\n    constructor(config){\n        this.model = \"models/gemini-2.5-flash\" // Use actual available model\n        ;\n        this.config = config;\n    }\n    async makeGeminiRequest(prompt, options = {}) {\n        // Try different model names based on actual available models from API\n        const modelsToTry = [\n            \"models/gemini-2.5-flash\",\n            \"models/gemini-2.5-pro\",\n            \"models/gemini-2.0-flash\",\n            \"models/gemini-flash-latest\",\n            \"models/gemini-pro-latest\",\n            \"models/gemini-2.0-flash-001\",\n            \"gemini-2.5-flash\",\n            \"gemini-2.5-pro\",\n            \"gemini-2.0-flash\",\n            \"gemini-flash-latest\",\n            \"gemini-pro-latest\"\n        ];\n        const possibleUrls = [];\n        // Generate URLs for different combinations\n        for (const model of modelsToTry){\n            possibleUrls.push(`${this.config.baseUrl}/v1beta/models/${model}:generateContent?key=${this.config.apiKey}`);\n            possibleUrls.push(`${this.config.baseUrl}/v1/models/${model}:generateContent?key=${this.config.apiKey}`);\n        }\n        const requestBody = {\n            contents: [\n                {\n                    parts: [\n                        {\n                            text: prompt\n                        }\n                    ]\n                }\n            ],\n            generationConfig: {\n                temperature: options.temperature || 0.7,\n                maxOutputTokens: options.maxTokens || 1000,\n                topP: options.topP || 0.9\n            }\n        };\n        console.log(\"\\uD83D\\uDD17 Trying Gemini API endpoints...\");\n        // Try each URL until one works\n        for(let i = 0; i < possibleUrls.length; i++){\n            const url = possibleUrls[i];\n            console.log(`🌐 Attempt ${i + 1}: ${url.replace(this.config.apiKey, \"API_KEY_HIDDEN\")}`);\n            try {\n                const response = await fetch(url, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(requestBody)\n                });\n                console.log(`📡 Response status: ${response.status} ${response.statusText}`);\n                if (response.ok) {\n                    const result = await response.json();\n                    console.log(\"✅ Successful API response received\");\n                    if (result.candidates && result.candidates[0] && result.candidates[0].content) {\n                        return result.candidates[0].content.parts[0].text;\n                    } else {\n                        console.warn(\"⚠️ Invalid response structure:\", result);\n                        throw new Error(\"Invalid response structure from Gemini API\");\n                    }\n                } else {\n                    const errorText = await response.text();\n                    console.warn(`❌ Attempt ${i + 1} failed:`, response.status, errorText);\n                    // If this is the last attempt, throw the error\n                    if (i === possibleUrls.length - 1) {\n                        throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorText}`);\n                    }\n                }\n            } catch (error) {\n                console.warn(`❌ Attempt ${i + 1} exception:`, error.message);\n                // If this is the last attempt, throw the error\n                if (i === possibleUrls.length - 1) {\n                    throw error;\n                }\n            }\n        }\n    }\n    async summarize(text, options = {}) {\n        const summaryType = options.type || \"key-points\";\n        const length = options.length || \"medium\";\n        const lengthInstructions = {\n            short: \"in 2-3 sentences\",\n            medium: \"in 4-6 sentences\",\n            long: \"in 7-10 sentences\"\n        };\n        const typeInstructions = {\n            \"key-points\": \"Extract and summarize the key points\",\n            \"tl-dr\": \"Create a TL;DR summary\",\n            \"teaser\": \"Write an engaging teaser summary\",\n            \"headline\": \"Create a headline-style summary\"\n        };\n        const prompt = `${typeInstructions[summaryType]} of the following text ${lengthInstructions[length]}:\n\n${text}\n\nSummary:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.3\n            });\n        } catch (error) {\n            console.error(\"Summarization failed:\", error);\n            // Fallback to simple truncation\n            return text.substring(0, 500) + \"...\";\n        }\n    }\n    async translate(text, options) {\n        const targetLang = this.getLanguageName(options.targetLanguage);\n        const prompt = `Translate the following text to ${targetLang}. Maintain the original meaning and tone:\n\n${text}\n\nTranslation:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.2\n            });\n        } catch (error) {\n            console.error(\"Translation failed:\", error);\n            // Return original text if translation fails\n            return text;\n        }\n    }\n    async prompt(prompt, options = {}) {\n        try {\n            return await this.makeGeminiRequest(prompt, options);\n        } catch (error) {\n            console.error(\"Prompt generation failed:\", error);\n            throw error;\n        }\n    }\n    async write(prompt, options = {}) {\n        const tone = options.tone || \"casual\";\n        const length = options.length || \"medium\";\n        const format = options.format || \"paragraph\";\n        const lengthInstructions = {\n            short: \"Keep it brief and concise\",\n            medium: \"Write a moderate length response\",\n            long: \"Provide a detailed and comprehensive response\"\n        };\n        const formatInstructions = {\n            paragraph: \"Write in paragraph form\",\n            \"bullet-points\": \"Format as bullet points\",\n            \"numbered-list\": \"Format as a numbered list\"\n        };\n        const enhancedPrompt = `${prompt}\n\nInstructions:\n- Tone: ${tone}\n- ${lengthInstructions[length]}\n- ${formatInstructions[format]}\n\nResponse:`;\n        try {\n            return await this.makeGeminiRequest(enhancedPrompt, {\n                temperature: 0.7\n            });\n        } catch (error) {\n            console.error(\"Writing failed:\", error);\n            throw error;\n        }\n    }\n    async rewrite(text, options = {}) {\n        const tone = options.tone || \"casual\";\n        const length = options.length || \"same\";\n        const audience = options.audience || \"general\";\n        const lengthInstructions = {\n            shorter: \"Make it more concise\",\n            longer: \"Expand and add more detail\",\n            same: \"Keep approximately the same length\"\n        };\n        const prompt = `Rewrite the following text with these requirements:\n- Tone: ${tone}\n- Audience: ${audience}\n- Length: ${lengthInstructions[length]}\n\nOriginal text:\n${text}\n\nRewritten text:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.5\n            });\n        } catch (error) {\n            console.error(\"Rewriting failed:\", error);\n            return text // Return original if rewriting fails\n            ;\n        }\n    }\n    async proofread(text, options = {}) {\n        const checkGrammar = options.checkGrammar !== false;\n        const checkSpelling = options.checkSpelling !== false;\n        const checkStyle = options.checkStyle !== false;\n        const checks = [];\n        if (checkGrammar) checks.push(\"grammar\");\n        if (checkSpelling) checks.push(\"spelling\");\n        if (checkStyle) checks.push(\"style and clarity\");\n        const prompt = `Proofread and correct the following text for ${checks.join(\", \")}. Return only the corrected text:\n\n${text}\n\nCorrected text:`;\n        try {\n            const correctedText = await this.makeGeminiRequest(prompt, {\n                temperature: 0.2\n            });\n            return {\n                corrected_text: correctedText,\n                suggestions: [],\n                errors: []\n            };\n        } catch (error) {\n            console.error(\"Proofreading failed:\", error);\n            return {\n                corrected_text: text,\n                suggestions: [],\n                errors: []\n            };\n        }\n    }\n    getLanguageName(code) {\n        const languageMap = {\n            es: \"Spanish\",\n            fr: \"French\",\n            de: \"German\",\n            it: \"Italian\",\n            pt: \"Portuguese\",\n            ja: \"Japanese\",\n            ko: \"Korean\",\n            zh: \"Chinese\",\n            en: \"English\"\n        };\n        return languageMap[code] || \"English\";\n    }\n}\n// Server-side only initialization\nconst createGoogleAIServerService = ()=>{\n    const apiKey = \"AIzaSyAkDCpwWTPKYftoc1Fdm77P6B00Lj89Lio\";\n    const baseUrl = \"https://generativelanguage.googleapis.com\" || 0;\n    if (!apiKey) {\n        console.warn(\"Google AI API key not found. Lesson generation will use fallback templates.\");\n        // Return a service that will always throw errors, triggering fallbacks\n        return new GoogleAIServerService({\n            apiKey: \"dummy\",\n            baseUrl\n        });\n    }\n    return new GoogleAIServerService({\n        apiKey,\n        baseUrl\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9nb29nbGUtYWktc2VydmVyLnRzPzUyZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2VydmVyLXNpZGUgR29vZ2xlIEFJIChHZW1pbmkpIEFQSXMgc2VydmljZSBsYXllclxuaW50ZXJmYWNlIEdvb2dsZUFJQ29uZmlnIHtcbiAgYXBpS2V5OiBzdHJpbmdcbiAgYmFzZVVybDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBTdW1tYXJpemVyT3B0aW9ucyB7XG4gIHR5cGU/OiBcImtleS1wb2ludHNcIiB8IFwidGwtZHJcIiB8IFwidGVhc2VyXCIgfCBcImhlYWRsaW5lXCJcbiAgbGVuZ3RoPzogXCJzaG9ydFwiIHwgXCJtZWRpdW1cIiB8IFwibG9uZ1wiXG4gIGZvcm1hdD86IFwibWFya2Rvd25cIiB8IFwicGxhaW4tdGV4dFwiXG59XG5cbmludGVyZmFjZSBUcmFuc2xhdG9yT3B0aW9ucyB7XG4gIHNvdXJjZUxhbmd1YWdlPzogc3RyaW5nXG4gIHRhcmdldExhbmd1YWdlOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFByb21wdE9wdGlvbnMge1xuICB0ZW1wZXJhdHVyZT86IG51bWJlclxuICBtYXhUb2tlbnM/OiBudW1iZXJcbiAgdG9wUD86IG51bWJlclxufVxuXG5pbnRlcmZhY2UgV3JpdGVyT3B0aW9ucyB7XG4gIHRvbmU/OiBcImZvcm1hbFwiIHwgXCJjYXN1YWxcIiB8IFwiYWNhZGVtaWNcIiB8IFwiY3JlYXRpdmVcIlxuICBsZW5ndGg/OiBcInNob3J0XCIgfCBcIm1lZGl1bVwiIHwgXCJsb25nXCJcbiAgZm9ybWF0PzogXCJwYXJhZ3JhcGhcIiB8IFwiYnVsbGV0LXBvaW50c1wiIHwgXCJudW1iZXJlZC1saXN0XCJcbn1cblxuaW50ZXJmYWNlIFJld3JpdGVyT3B0aW9ucyB7XG4gIHRvbmU/OiBcImZvcm1hbFwiIHwgXCJjYXN1YWxcIiB8IFwiYWNhZGVtaWNcIiB8IFwiY3JlYXRpdmVcIlxuICBsZW5ndGg/OiBcInNob3J0ZXJcIiB8IFwibG9uZ2VyXCIgfCBcInNhbWVcIlxuICBhdWRpZW5jZT86IFwiZ2VuZXJhbFwiIHwgXCJleHBlcnRcIiB8IFwiYmVnaW5uZXJcIlxufVxuXG5pbnRlcmZhY2UgUHJvb2ZyZWFkZXJPcHRpb25zIHtcbiAgY2hlY2tHcmFtbWFyPzogYm9vbGVhblxuICBjaGVja1NwZWxsaW5nPzogYm9vbGVhblxuICBjaGVja1N0eWxlPzogYm9vbGVhblxuICBzdWdnZXN0SW1wcm92ZW1lbnRzPzogYm9vbGVhblxufVxuXG5jbGFzcyBHb29nbGVBSVNlcnZlclNlcnZpY2Uge1xuICBwcml2YXRlIGNvbmZpZzogR29vZ2xlQUlDb25maWdcbiAgcHJpdmF0ZSBtb2RlbDogc3RyaW5nID0gXCJtb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaFwiIC8vIFVzZSBhY3R1YWwgYXZhaWxhYmxlIG1vZGVsXG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBHb29nbGVBSUNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG1ha2VHZW1pbmlSZXF1ZXN0KHByb21wdDogc3RyaW5nLCBvcHRpb25zOiBhbnkgPSB7fSkge1xuICAgIC8vIFRyeSBkaWZmZXJlbnQgbW9kZWwgbmFtZXMgYmFzZWQgb24gYWN0dWFsIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSBBUElcbiAgICBjb25zdCBtb2RlbHNUb1RyeSA9IFtcbiAgICAgICdtb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICAnbW9kZWxzL2dlbWluaS0yLjUtcHJvJywgXG4gICAgICAnbW9kZWxzL2dlbWluaS0yLjAtZmxhc2gnLFxuICAgICAgJ21vZGVscy9nZW1pbmktZmxhc2gtbGF0ZXN0JyxcbiAgICAgICdtb2RlbHMvZ2VtaW5pLXByby1sYXRlc3QnLFxuICAgICAgJ21vZGVscy9nZW1pbmktMi4wLWZsYXNoLTAwMScsXG4gICAgICAnZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICAnZ2VtaW5pLTIuNS1wcm8nLFxuICAgICAgJ2dlbWluaS0yLjAtZmxhc2gnLFxuICAgICAgJ2dlbWluaS1mbGFzaC1sYXRlc3QnLFxuICAgICAgJ2dlbWluaS1wcm8tbGF0ZXN0J1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBwb3NzaWJsZVVybHMgPSBbXVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIFVSTHMgZm9yIGRpZmZlcmVudCBjb21iaW5hdGlvbnNcbiAgICBmb3IgKGNvbnN0IG1vZGVsIG9mIG1vZGVsc1RvVHJ5KSB7XG4gICAgICBwb3NzaWJsZVVybHMucHVzaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS92MWJldGEvbW9kZWxzLyR7bW9kZWx9OmdlbmVyYXRlQ29udGVudD9rZXk9JHt0aGlzLmNvbmZpZy5hcGlLZXl9YClcbiAgICAgIHBvc3NpYmxlVXJscy5wdXNoKGAke3RoaXMuY29uZmlnLmJhc2VVcmx9L3YxL21vZGVscy8ke21vZGVsfTpnZW5lcmF0ZUNvbnRlbnQ/a2V5PSR7dGhpcy5jb25maWcuYXBpS2V5fWApXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgY29udGVudHM6IFt7XG4gICAgICAgIHBhcnRzOiBbe1xuICAgICAgICAgIHRleHQ6IHByb21wdFxuICAgICAgICB9XVxuICAgICAgfV0sXG4gICAgICBnZW5lcmF0aW9uQ29uZmlnOiB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiBvcHRpb25zLnRlbXBlcmF0dXJlIHx8IDAuNyxcbiAgICAgICAgbWF4T3V0cHV0VG9rZW5zOiBvcHRpb25zLm1heFRva2VucyB8fCAxMDAwLFxuICAgICAgICB0b3BQOiBvcHRpb25zLnRvcFAgfHwgMC45LFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi8J+UlyBUcnlpbmcgR2VtaW5pIEFQSSBlbmRwb2ludHMuLi5cIilcblxuICAgIC8vIFRyeSBlYWNoIFVSTCB1bnRpbCBvbmUgd29ya3NcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVXJscy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdXJsID0gcG9zc2libGVVcmxzW2ldXG4gICAgICBjb25zb2xlLmxvZyhg8J+MkCBBdHRlbXB0ICR7aSArIDF9OiAke3VybC5yZXBsYWNlKHRoaXMuY29uZmlnLmFwaUtleSwgJ0FQSV9LRVlfSElEREVOJyl9YClcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgICB9KVxuXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OhIFJlc3BvbnNlIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlIHJlY2VpdmVkXCIpXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHJlc3VsdC5jYW5kaWRhdGVzICYmIHJlc3VsdC5jYW5kaWRhdGVzWzBdICYmIHJlc3VsdC5jYW5kaWRhdGVzWzBdLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQuY2FuZGlkYXRlc1swXS5jb250ZW50LnBhcnRzWzBdLnRleHRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwi4pqg77iPIEludmFsaWQgcmVzcG9uc2Ugc3RydWN0dXJlOlwiLCByZXN1bHQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIHN0cnVjdHVyZSBmcm9tIEdlbWluaSBBUElcIilcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpXG4gICAgICAgICAgY29uc29sZS53YXJuKGDinYwgQXR0ZW1wdCAke2kgKyAxfSBmYWlsZWQ6YCwgcmVzcG9uc2Uuc3RhdHVzLCBlcnJvclRleHQpXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgbGFzdCBhdHRlbXB0LCB0aHJvdyB0aGUgZXJyb3JcbiAgICAgICAgICBpZiAoaSA9PT0gcG9zc2libGVVcmxzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR2VtaW5pIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH0gLSAke2Vycm9yVGV4dH1gKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDinYwgQXR0ZW1wdCAke2kgKyAxfSBleGNlcHRpb246YCwgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgXG4gICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGxhc3QgYXR0ZW1wdCwgdGhyb3cgdGhlIGVycm9yXG4gICAgICAgIGlmIChpID09PSBwb3NzaWJsZVVybHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBzdW1tYXJpemUodGV4dDogc3RyaW5nLCBvcHRpb25zOiBTdW1tYXJpemVyT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3Qgc3VtbWFyeVR5cGUgPSBvcHRpb25zLnR5cGUgfHwgXCJrZXktcG9pbnRzXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcIm1lZGl1bVwiXG4gICAgXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnQ6IFwiaW4gMi0zIHNlbnRlbmNlc1wiLFxuICAgICAgbWVkaXVtOiBcImluIDQtNiBzZW50ZW5jZXNcIiwgXG4gICAgICBsb25nOiBcImluIDctMTAgc2VudGVuY2VzXCJcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgXCJrZXktcG9pbnRzXCI6IFwiRXh0cmFjdCBhbmQgc3VtbWFyaXplIHRoZSBrZXkgcG9pbnRzXCIsXG4gICAgICBcInRsLWRyXCI6IFwiQ3JlYXRlIGEgVEw7RFIgc3VtbWFyeVwiLFxuICAgICAgXCJ0ZWFzZXJcIjogXCJXcml0ZSBhbiBlbmdhZ2luZyB0ZWFzZXIgc3VtbWFyeVwiLFxuICAgICAgXCJoZWFkbGluZVwiOiBcIkNyZWF0ZSBhIGhlYWRsaW5lLXN0eWxlIHN1bW1hcnlcIlxuICAgIH1cblxuICAgIGNvbnN0IHByb21wdCA9IGAke3R5cGVJbnN0cnVjdGlvbnNbc3VtbWFyeVR5cGVdfSBvZiB0aGUgZm9sbG93aW5nIHRleHQgJHtsZW5ndGhJbnN0cnVjdGlvbnNbbGVuZ3RoXX06XG5cbiR7dGV4dH1cblxuU3VtbWFyeTpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QocHJvbXB0LCB7IHRlbXBlcmF0dXJlOiAwLjMgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlN1bW1hcml6YXRpb24gZmFpbGVkOlwiLCBlcnJvcilcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSB0cnVuY2F0aW9uXG4gICAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoMCwgNTAwKSArIFwiLi4uXCJcbiAgICB9XG4gIH1cblxuICBhc3luYyB0cmFuc2xhdGUodGV4dDogc3RyaW5nLCBvcHRpb25zOiBUcmFuc2xhdG9yT3B0aW9ucykge1xuICAgIGNvbnN0IHRhcmdldExhbmcgPSB0aGlzLmdldExhbmd1YWdlTmFtZShvcHRpb25zLnRhcmdldExhbmd1YWdlKVxuICAgIFxuICAgIGNvbnN0IHByb21wdCA9IGBUcmFuc2xhdGUgdGhlIGZvbGxvd2luZyB0ZXh0IHRvICR7dGFyZ2V0TGFuZ30uIE1haW50YWluIHRoZSBvcmlnaW5hbCBtZWFuaW5nIGFuZCB0b25lOlxuXG4ke3RleHR9XG5cblRyYW5zbGF0aW9uOmBcblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5tYWtlR2VtaW5pUmVxdWVzdChwcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuMiB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNsYXRpb24gZmFpbGVkOlwiLCBlcnJvcilcbiAgICAgIC8vIFJldHVybiBvcmlnaW5hbCB0ZXh0IGlmIHRyYW5zbGF0aW9uIGZhaWxzXG4gICAgICByZXR1cm4gdGV4dFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb21wdChwcm9tcHQ6IHN0cmluZywgb3B0aW9uczogUHJvbXB0T3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLm1ha2VHZW1pbmlSZXF1ZXN0KHByb21wdCwgb3B0aW9ucylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlByb21wdCBnZW5lcmF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHdyaXRlKHByb21wdDogc3RyaW5nLCBvcHRpb25zOiBXcml0ZXJPcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB0b25lID0gb3B0aW9ucy50b25lIHx8IFwiY2FzdWFsXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcIm1lZGl1bVwiXG4gICAgY29uc3QgZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQgfHwgXCJwYXJhZ3JhcGhcIlxuXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnQ6IFwiS2VlcCBpdCBicmllZiBhbmQgY29uY2lzZVwiLFxuICAgICAgbWVkaXVtOiBcIldyaXRlIGEgbW9kZXJhdGUgbGVuZ3RoIHJlc3BvbnNlXCIsXG4gICAgICBsb25nOiBcIlByb3ZpZGUgYSBkZXRhaWxlZCBhbmQgY29tcHJlaGVuc2l2ZSByZXNwb25zZVwiXG4gICAgfVxuXG4gICAgY29uc3QgZm9ybWF0SW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgcGFyYWdyYXBoOiBcIldyaXRlIGluIHBhcmFncmFwaCBmb3JtXCIsXG4gICAgICBcImJ1bGxldC1wb2ludHNcIjogXCJGb3JtYXQgYXMgYnVsbGV0IHBvaW50c1wiLFxuICAgICAgXCJudW1iZXJlZC1saXN0XCI6IFwiRm9ybWF0IGFzIGEgbnVtYmVyZWQgbGlzdFwiXG4gICAgfVxuXG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgJHtwcm9tcHR9XG5cbkluc3RydWN0aW9uczpcbi0gVG9uZTogJHt0b25lfVxuLSAke2xlbmd0aEluc3RydWN0aW9uc1tsZW5ndGhdfVxuLSAke2Zvcm1hdEluc3RydWN0aW9uc1tmb3JtYXRdfVxuXG5SZXNwb25zZTpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QoZW5oYW5jZWRQcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuNyB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiV3JpdGluZyBmYWlsZWQ6XCIsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyByZXdyaXRlKHRleHQ6IHN0cmluZywgb3B0aW9uczogUmV3cml0ZXJPcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB0b25lID0gb3B0aW9ucy50b25lIHx8IFwiY2FzdWFsXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcInNhbWVcIlxuICAgIGNvbnN0IGF1ZGllbmNlID0gb3B0aW9ucy5hdWRpZW5jZSB8fCBcImdlbmVyYWxcIlxuXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnRlcjogXCJNYWtlIGl0IG1vcmUgY29uY2lzZVwiLFxuICAgICAgbG9uZ2VyOiBcIkV4cGFuZCBhbmQgYWRkIG1vcmUgZGV0YWlsXCIsXG4gICAgICBzYW1lOiBcIktlZXAgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBsZW5ndGhcIlxuICAgIH1cblxuICAgIGNvbnN0IHByb21wdCA9IGBSZXdyaXRlIHRoZSBmb2xsb3dpbmcgdGV4dCB3aXRoIHRoZXNlIHJlcXVpcmVtZW50czpcbi0gVG9uZTogJHt0b25lfVxuLSBBdWRpZW5jZTogJHthdWRpZW5jZX1cbi0gTGVuZ3RoOiAke2xlbmd0aEluc3RydWN0aW9uc1tsZW5ndGhdfVxuXG5PcmlnaW5hbCB0ZXh0OlxuJHt0ZXh0fVxuXG5SZXdyaXR0ZW4gdGV4dDpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QocHJvbXB0LCB7IHRlbXBlcmF0dXJlOiAwLjUgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlJld3JpdGluZyBmYWlsZWQ6XCIsIGVycm9yKVxuICAgICAgcmV0dXJuIHRleHQgLy8gUmV0dXJuIG9yaWdpbmFsIGlmIHJld3JpdGluZyBmYWlsc1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb29mcmVhZCh0ZXh0OiBzdHJpbmcsIG9wdGlvbnM6IFByb29mcmVhZGVyT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgY2hlY2tHcmFtbWFyID0gb3B0aW9ucy5jaGVja0dyYW1tYXIgIT09IGZhbHNlXG4gICAgY29uc3QgY2hlY2tTcGVsbGluZyA9IG9wdGlvbnMuY2hlY2tTcGVsbGluZyAhPT0gZmFsc2VcbiAgICBjb25zdCBjaGVja1N0eWxlID0gb3B0aW9ucy5jaGVja1N0eWxlICE9PSBmYWxzZVxuXG4gICAgY29uc3QgY2hlY2tzID0gW11cbiAgICBpZiAoY2hlY2tHcmFtbWFyKSBjaGVja3MucHVzaChcImdyYW1tYXJcIilcbiAgICBpZiAoY2hlY2tTcGVsbGluZykgY2hlY2tzLnB1c2goXCJzcGVsbGluZ1wiKVxuICAgIGlmIChjaGVja1N0eWxlKSBjaGVja3MucHVzaChcInN0eWxlIGFuZCBjbGFyaXR5XCIpXG5cbiAgICBjb25zdCBwcm9tcHQgPSBgUHJvb2ZyZWFkIGFuZCBjb3JyZWN0IHRoZSBmb2xsb3dpbmcgdGV4dCBmb3IgJHtjaGVja3Muam9pbihcIiwgXCIpfS4gUmV0dXJuIG9ubHkgdGhlIGNvcnJlY3RlZCB0ZXh0OlxuXG4ke3RleHR9XG5cbkNvcnJlY3RlZCB0ZXh0OmBcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb3JyZWN0ZWRUZXh0ID0gYXdhaXQgdGhpcy5tYWtlR2VtaW5pUmVxdWVzdChwcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuMiB9KVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29ycmVjdGVkX3RleHQ6IGNvcnJlY3RlZFRleHQsXG4gICAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcbiAgICAgICAgZXJyb3JzOiBbXVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiUHJvb2ZyZWFkaW5nIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb3JyZWN0ZWRfdGV4dDogdGV4dCxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxuICAgICAgICBlcnJvcnM6IFtdXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYW5ndWFnZU5hbWUoY29kZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBsYW5ndWFnZU1hcCA9IHtcbiAgICAgIGVzOiBcIlNwYW5pc2hcIixcbiAgICAgIGZyOiBcIkZyZW5jaFwiLCBcbiAgICAgIGRlOiBcIkdlcm1hblwiLFxuICAgICAgaXQ6IFwiSXRhbGlhblwiLFxuICAgICAgcHQ6IFwiUG9ydHVndWVzZVwiLFxuICAgICAgamE6IFwiSmFwYW5lc2VcIixcbiAgICAgIGtvOiBcIktvcmVhblwiLFxuICAgICAgemg6IFwiQ2hpbmVzZVwiLFxuICAgICAgZW46IFwiRW5nbGlzaFwiXG4gICAgfVxuICAgIHJldHVybiBsYW5ndWFnZU1hcFtjb2RlXSB8fCBcIkVuZ2xpc2hcIlxuICB9XG59XG5cbi8vIFNlcnZlci1zaWRlIG9ubHkgaW5pdGlhbGl6YXRpb25cbmV4cG9ydCBjb25zdCBjcmVhdGVHb29nbGVBSVNlcnZlclNlcnZpY2UgPSAoKSA9PiB7XG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0dPT0dMRV9BSV9BUElfS0VZXG4gIGNvbnN0IGJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19HT09HTEVfQUlfQkFTRV9VUkwgfHwgXCJodHRwczovL2dlbmVyYXRpdmVsYW5ndWFnZS5nb29nbGVhcGlzLmNvbVwiXG5cbiAgaWYgKCFhcGlLZXkpIHtcbiAgICBjb25zb2xlLndhcm4oXCJHb29nbGUgQUkgQVBJIGtleSBub3QgZm91bmQuIExlc3NvbiBnZW5lcmF0aW9uIHdpbGwgdXNlIGZhbGxiYWNrIHRlbXBsYXRlcy5cIilcbiAgICAvLyBSZXR1cm4gYSBzZXJ2aWNlIHRoYXQgd2lsbCBhbHdheXMgdGhyb3cgZXJyb3JzLCB0cmlnZ2VyaW5nIGZhbGxiYWNrc1xuICAgIHJldHVybiBuZXcgR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlKHsgYXBpS2V5OiBcImR1bW15XCIsIGJhc2VVcmwgfSlcbiAgfVxuXG4gIHJldHVybiBuZXcgR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlKHsgYXBpS2V5LCBiYXNlVXJsIH0pXG59XG5cbmV4cG9ydCB0eXBlIHsgU3VtbWFyaXplck9wdGlvbnMsIFRyYW5zbGF0b3JPcHRpb25zLCBQcm9tcHRPcHRpb25zLCBXcml0ZXJPcHRpb25zLCBSZXdyaXRlck9wdGlvbnMsIFByb29mcmVhZGVyT3B0aW9ucyB9XG4iXSwibmFtZXMiOlsiR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJtb2RlbCIsIm1ha2VHZW1pbmlSZXF1ZXN0IiwicHJvbXB0Iiwib3B0aW9ucyIsIm1vZGVsc1RvVHJ5IiwicG9zc2libGVVcmxzIiwicHVzaCIsImJhc2VVcmwiLCJhcGlLZXkiLCJyZXF1ZXN0Qm9keSIsImNvbnRlbnRzIiwicGFydHMiLCJ0ZXh0IiwiZ2VuZXJhdGlvbkNvbmZpZyIsInRlbXBlcmF0dXJlIiwibWF4T3V0cHV0VG9rZW5zIiwibWF4VG9rZW5zIiwidG9wUCIsImNvbnNvbGUiLCJsb2ciLCJpIiwibGVuZ3RoIiwidXJsIiwicmVwbGFjZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0dXMiLCJzdGF0dXNUZXh0Iiwib2siLCJyZXN1bHQiLCJqc29uIiwiY2FuZGlkYXRlcyIsImNvbnRlbnQiLCJ3YXJuIiwiRXJyb3IiLCJlcnJvclRleHQiLCJlcnJvciIsIm1lc3NhZ2UiLCJzdW1tYXJpemUiLCJzdW1tYXJ5VHlwZSIsInR5cGUiLCJsZW5ndGhJbnN0cnVjdGlvbnMiLCJzaG9ydCIsIm1lZGl1bSIsImxvbmciLCJ0eXBlSW5zdHJ1Y3Rpb25zIiwic3Vic3RyaW5nIiwidHJhbnNsYXRlIiwidGFyZ2V0TGFuZyIsImdldExhbmd1YWdlTmFtZSIsInRhcmdldExhbmd1YWdlIiwid3JpdGUiLCJ0b25lIiwiZm9ybWF0IiwiZm9ybWF0SW5zdHJ1Y3Rpb25zIiwicGFyYWdyYXBoIiwiZW5oYW5jZWRQcm9tcHQiLCJyZXdyaXRlIiwiYXVkaWVuY2UiLCJzaG9ydGVyIiwibG9uZ2VyIiwic2FtZSIsInByb29mcmVhZCIsImNoZWNrR3JhbW1hciIsImNoZWNrU3BlbGxpbmciLCJjaGVja1N0eWxlIiwiY2hlY2tzIiwiam9pbiIsImNvcnJlY3RlZFRleHQiLCJjb3JyZWN0ZWRfdGV4dCIsInN1Z2dlc3Rpb25zIiwiZXJyb3JzIiwiY29kZSIsImxhbmd1YWdlTWFwIiwiZXMiLCJmciIsImRlIiwiaXQiLCJwdCIsImphIiwia28iLCJ6aCIsImVuIiwiY3JlYXRlR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0dPT0dMRV9BSV9BUElfS0VZIiwiTkVYVF9QVUJMSUNfR09PR0xFX0FJX0JBU0VfVVJMIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/google-ai-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/lesson-ai-generator-server.ts":
/*!*******************************************!*\
  !*** ./lib/lesson-ai-generator-server.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LessonAIServerGenerator: () => (/* binding */ LessonAIServerGenerator),\n/* harmony export */   lessonAIServerGenerator: () => (/* binding */ lessonAIServerGenerator)\n/* harmony export */ });\n/* harmony import */ var _google_ai_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./google-ai-server */ \"(rsc)/./lib/google-ai-server.ts\");\n\nclass LessonAIServerGenerator {\n    getGoogleAI() {\n        if (!this.googleAI) {\n            this.googleAI = (0,_google_ai_server__WEBPACK_IMPORTED_MODULE_0__.createGoogleAIServerService)();\n        }\n        return this.googleAI;\n    }\n    async generateLesson(params) {\n        const { sourceText, lessonType, studentLevel, targetLanguage, sourceUrl, contentMetadata, structuredContent, wordCount, readingTime } = params;\n        console.log(\"\\uD83D\\uDE80 Starting AI lesson generation with params:\", {\n            textLength: sourceText.length,\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            hasMetadata: !!contentMetadata,\n            hasStructuredContent: !!structuredContent\n        });\n        try {\n            // Step 1: Analyze content context and complexity\n            console.log(\"\\uD83D\\uDCCA Step 1: Analyzing content context...\");\n            const contentAnalysis = await this.analyzeContentContext(sourceText, contentMetadata, structuredContent, studentLevel);\n            console.log(\"✅ Content analysis complete:\", contentAnalysis);\n            // Step 2: Create contextual summary based on lesson type and content analysis\n            console.log(\"\\uD83D\\uDCDD Step 2: Creating contextual summary...\");\n            const contextualSummary = await this.createContextualSummary(sourceText, contentAnalysis, lessonType, studentLevel);\n            console.log(\"✅ Contextual summary created, length:\", contextualSummary.length);\n            // Step 3: Translate if needed (for non-English target languages)\n            let translatedContent = contextualSummary;\n            if (targetLanguage !== \"english\") {\n                console.log(\"\\uD83C\\uDF10 Step 3: Translating to\", targetLanguage);\n                translatedContent = await this.getGoogleAI().translate(contextualSummary, {\n                    targetLanguage: this.getLanguageCode(targetLanguage)\n                });\n                console.log(\"✅ Translation complete, length:\", translatedContent.length);\n            } else {\n                console.log(\"⏭️ Step 3: Skipping translation (target is English)\");\n            }\n            // Step 4: Generate contextual lesson structure\n            console.log(\"\\uD83C\\uDFD7️ Step 4: Generating lesson structure...\");\n            const lessonStructure = await this.generateContextualLessonStructure(translatedContent, contentAnalysis, lessonType, studentLevel, targetLanguage, contentMetadata);\n            console.log(\"✅ Lesson structure generated:\", Object.keys(lessonStructure));\n            // Step 5: Generate detailed content for each section with context\n            console.log(\"\\uD83D\\uDD27 Step 5: Enhancing lesson content...\");\n            const detailedLesson = await this.generateDetailedContextualContent(lessonStructure, translatedContent, contentAnalysis, lessonType, studentLevel, targetLanguage, structuredContent);\n            console.log(\"✅ Detailed content generated\");\n            // Step 6: Proofread and polish the final lesson\n            console.log(\"✨ Step 6: Proofreading lesson...\");\n            const polishedLesson = await this.proofreadLesson(detailedLesson);\n            console.log(\"\\uD83C\\uDF89 AI lesson generation complete!\");\n            return polishedLesson;\n        } catch (error) {\n            console.error(\"❌ Error in AI lesson generation:\", error);\n            console.log(\"\\uD83D\\uDD04 Falling back to enhanced template generation...\");\n            // Fallback to enhanced template-based generation with context\n            return this.generateEnhancedFallbackLesson(params);\n        }\n    }\n    // New method: Analyze content context and complexity\n    async analyzeContentContext(sourceText, metadata, structuredContent, studentLevel) {\n        console.log(\"\\uD83D\\uDD0D Analyzing content context...\");\n        const analysis = {\n            contentType: metadata?.contentType || \"general\",\n            domain: metadata?.domain || \"\",\n            complexity: \"medium\",\n            topics: [],\n            keyVocabulary: [],\n            culturalContext: \"\",\n            learningObjectives: [],\n            difficulty: studentLevel || \"B1\",\n            title: metadata?.title || \"\",\n            sourceCountry: this.determineSourceCountry(metadata?.domain || \"\")\n        };\n        // Analyze content complexity based on text characteristics\n        const sentences = sourceText.split(/[.!?]+/).filter((s)=>s.trim().length > 10);\n        const avgSentenceLength = sentences.length > 0 ? sentences.reduce((sum, s)=>sum + s.split(\" \").length, 0) / sentences.length : 0;\n        const complexWords = sourceText.match(/\\b\\w{8,}\\b/g)?.length || 0;\n        const totalWords = sourceText.split(/\\s+/).length;\n        if (avgSentenceLength > 20 || complexWords / totalWords > 0.15) {\n            analysis.complexity = \"high\";\n        } else if (avgSentenceLength < 12 && complexWords / totalWords < 0.08) {\n            analysis.complexity = \"low\";\n        }\n        console.log(\"\\uD83D\\uDCC8 Text complexity analysis:\", {\n            avgSentenceLength,\n            complexWords,\n            totalWords,\n            complexity: analysis.complexity\n        });\n        // Extract key topics using AI\n        try {\n            console.log(\"\\uD83C\\uDFAF Extracting topics using AI...\");\n            const topicsPrompt = `Analyze this content and identify 3-5 main topics or themes. Return only the topics, one per line:\n\n\"${sourceText.substring(0, 1000)}\"\n\nTopics:`;\n            const topicsResponse = await this.getGoogleAI().prompt(topicsPrompt, {\n                temperature: 0.3,\n                maxTokens: 200\n            });\n            console.log(\"\\uD83E\\uDD16 AI topics response:\", topicsResponse);\n            analysis.topics = this.parseListFromText(topicsResponse).slice(0, 5);\n            console.log(\"✅ Extracted topics:\", analysis.topics);\n        } catch (error) {\n            console.warn(\"⚠️ AI topic extraction failed, using fallback:\", error.message);\n            // Fallback topic extraction\n            analysis.topics = this.extractTopicsFromHeadings(structuredContent?.headings || []);\n            console.log(\"\\uD83D\\uDD04 Fallback topics:\", analysis.topics);\n        }\n        // Extract key vocabulary for the target level\n        try {\n            console.log(\"\\uD83D\\uDCDA Extracting vocabulary using AI...\");\n            const vocabPrompt = `Extract 8-10 key vocabulary words from this content that would be appropriate for ${studentLevel} level language learners. Focus on useful, practical words. Return only the words, one per line:\n\n\"${sourceText.substring(0, 800)}\"\n\nVocabulary words:`;\n            const vocabResponse = await this.getGoogleAI().prompt(vocabPrompt, {\n                temperature: 0.2,\n                maxTokens: 300\n            });\n            console.log(\"\\uD83E\\uDD16 AI vocabulary response:\", vocabResponse);\n            analysis.keyVocabulary = this.parseListFromText(vocabResponse).slice(0, 10);\n            console.log(\"✅ Extracted vocabulary:\", analysis.keyVocabulary);\n        } catch (error) {\n            console.warn(\"⚠️ AI vocabulary extraction failed, using fallback:\", error.message);\n            // Fallback vocabulary extraction\n            analysis.keyVocabulary = this.extractVocabularyFromText(sourceText, studentLevel);\n            console.log(\"\\uD83D\\uDD04 Fallback vocabulary:\", analysis.keyVocabulary);\n        }\n        // Determine cultural context\n        if (metadata?.domain) {\n            analysis.culturalContext = this.determineCulturalContext(metadata.domain, sourceText);\n            console.log(\"\\uD83C\\uDF0D Cultural context:\", analysis.culturalContext);\n        }\n        // Generate learning objectives based on content type and lesson type\n        analysis.learningObjectives = this.generateLearningObjectives(analysis.contentType, analysis.topics, studentLevel);\n        console.log(\"\\uD83C\\uDFAF Learning objectives:\", analysis.learningObjectives);\n        return analysis;\n    }\n    // Enhanced contextual summary creation\n    async createContextualSummary(sourceText, contentAnalysis, lessonType, studentLevel) {\n        console.log(\"\\uD83D\\uDCDD Creating contextual summary...\");\n        const summaryPrompt = `Create a focused summary of this content for a ${lessonType} lesson at ${studentLevel} level.\n\nContent type: ${contentAnalysis.contentType}\nMain topics: ${contentAnalysis.topics.join(\", \")}\nComplexity: ${contentAnalysis.complexity}\n\nFocus on aspects most relevant for ${lessonType} learning objectives.\nKeep the summary appropriate for ${studentLevel} CEFR level students.\nWrite 4-6 sentences that capture the key information.\n\nContent: \"${sourceText.substring(0, 1500)}\"\n\nSummary:`;\n        try {\n            console.log(\"\\uD83E\\uDD16 Calling AI for contextual summary...\");\n            const summary = await this.getGoogleAI().prompt(summaryPrompt, {\n                temperature: 0.4,\n                maxTokens: 500\n            });\n            console.log(\"✅ AI contextual summary created:\", summary.substring(0, 100) + \"...\");\n            return summary;\n        } catch (error) {\n            console.warn(\"⚠️ AI contextual summary failed, trying basic summarization:\", error.message);\n            // Fallback to basic summarization\n            try {\n                const basicSummary = await this.getGoogleAI().summarize(sourceText, {\n                    type: \"key-points\",\n                    length: this.getSummaryLength(studentLevel),\n                    format: \"plain-text\"\n                });\n                console.log(\"✅ Basic AI summary created:\", basicSummary.substring(0, 100) + \"...\");\n                return basicSummary;\n            } catch (summaryError) {\n                console.warn(\"⚠️ All AI summarization failed, using text truncation:\", summaryError.message);\n                // Final fallback to simple truncation\n                return sourceText.substring(0, 800) + \"...\";\n            }\n        }\n    }\n    // Generate CEFR-adapted warm-up questions\n    async generateContextualWarmupQuestions(content, contentAnalysis, studentLevel, metadata) {\n        console.log(\"\\uD83D\\uDD25 Generating CEFR-adapted warm-up questions...\");\n        const levelInstructions = {\n            \"A1\": `\nCreate 3 warm-up questions for A1 (beginner) level:\n- Use simple present tense and basic vocabulary\n- Ask yes/no questions or simple choice questions\n- Focus on familiar, concrete concepts\n- Keep questions short and direct\n- Use vocabulary the student likely knows\nExample: \"Do you use [topic] in your daily life? Yes or No?\"`,\n            \"A2\": `\nCreate 3 warm-up questions for A2 (elementary) level:\n- Use simple past tense and personal experiences\n- Ask for short, simple answers\n- Include basic comparisons with \"different\" or \"same\"\n- Focus on personal experiences and familiar situations\n- Use simple connecting words like \"and\", \"but\"\nExample: \"Have you ever [experienced topic]? How was it?\"`,\n            \"B1\": `\nCreate 3 warm-up questions for B1 (intermediate) level:\n- Ask for opinions with \"What do you think...?\"\n- Include comparisons between countries/cultures\n- Ask students to explain reasons with \"because\" or \"why\"\n- Discuss advantages and disadvantages\n- Use more varied vocabulary but keep structure clear\nExample: \"What do you think about [topic]? How is it different in your country?\"`,\n            \"B2\": `\nCreate 3 warm-up questions for B2 (upper intermediate) level:\n- Ask students to analyze situations and predict outcomes\n- Include complex opinions and explanations\n- Discuss implications and consequences\n- Use conditional language (\"What would happen if...?\")\n- Encourage detailed responses with examples\nExample: \"What challenges do you think [specific group] face with [topic]?\"`,\n            \"C1\": `\nCreate 3 warm-up questions for C1 (advanced) level:\n- Ask students to evaluate arguments and consider multiple perspectives\n- Include abstract concepts and societal implications\n- Use sophisticated vocabulary and complex structures\n- Encourage critical thinking and nuanced discussion\n- Ask about broader cultural and social contexts\nExample: \"How do cultural attitudes toward [concept] influence [topic] in different societies?\"`\n        };\n        const warmupPrompt = `Generate 3 contextual warm-up questions for a ${studentLevel} level student learning English.\n\nCONTENT CONTEXT:\n- Title: ${metadata?.title || \"Content\"}\n- Source: ${contentAnalysis.sourceCountry} (${contentAnalysis.domain})\n- Content Type: ${contentAnalysis.contentType}\n- Main Topics: ${contentAnalysis.topics.slice(0, 3).join(\", \")}\n- Key Vocabulary: ${contentAnalysis.keyVocabulary.slice(0, 4).join(\", \")}\n- Cultural Context: ${contentAnalysis.culturalContext}\n\nLEVEL REQUIREMENTS:\n${levelInstructions[studentLevel] || levelInstructions[\"B1\"]}\n\nCONTENT PREVIEW: \"${content.substring(0, 500)}\"\n\nGenerate 3 warm-up questions that:\n1. Reference specific details from the content (title, topics, or key concepts)\n2. Connect to the student's personal experience and cultural background\n3. Are appropriate for ${studentLevel} level complexity\n4. Prepare students for the vocabulary and concepts they'll encounter\n5. Create curiosity about the specific material\n\nReturn only the 3 questions, one per line:`;\n        try {\n            console.log(\"\\uD83E\\uDD16 Calling AI for contextual warm-up questions...\");\n            const response = await this.getGoogleAI().prompt(warmupPrompt, {\n                temperature: 0.6,\n                maxTokens: 300\n            });\n            console.log(\"✅ AI warm-up questions generated\");\n            const questions = this.parseListFromText(response).slice(0, 3);\n            // Ensure we have 3 questions, add fallbacks if needed\n            while(questions.length < 3){\n                questions.push(this.getFallbackWarmupQuestion(studentLevel, contentAnalysis, questions.length));\n            }\n            return questions;\n        } catch (error) {\n            console.warn(\"⚠️ AI warm-up generation failed, using contextual fallbacks:\", error.message);\n            return this.getContextualWarmupFallback(studentLevel, contentAnalysis, metadata);\n        }\n    }\n    // Enhanced contextual lesson structure generation\n    async generateContextualLessonStructure(content, contentAnalysis, lessonType, studentLevel, targetLanguage, metadata) {\n        console.log(\"\\uD83C\\uDFD7️ Generating contextual lesson structure...\");\n        // Generate contextual warm-up questions first\n        const contextualWarmup = await this.generateContextualWarmupQuestions(content, contentAnalysis, studentLevel, metadata);\n        const prompt = `Create a highly contextual ${lessonType} lesson for ${studentLevel} level students learning ${targetLanguage}.\n\nCONTENT CONTEXT:\n- Content Type: ${contentAnalysis.contentType}\n- Source: ${metadata?.domain || \"web content\"}\n- Main Topics: ${contentAnalysis.topics.join(\", \")}\n- Complexity Level: ${contentAnalysis.complexity}\n- Key Vocabulary: ${contentAnalysis.keyVocabulary.slice(0, 5).join(\", \")}\n- Cultural Context: ${contentAnalysis.culturalContext}\n\nLESSON CONTENT: \"${content.substring(0, 1000)}\"\n\nCreate a JSON structure with these sections, making each section highly relevant to the source content:\n\n{\n  \"warmup\": ${JSON.stringify(contextualWarmup)},\n  \"vocabulary\": [\n    {\"word\": \"word1\", \"meaning\": \"definition\", \"example\": \"example sentence\"},\n    {\"word\": \"word2\", \"meaning\": \"definition\", \"example\": \"example sentence\"}\n  ],\n  \"reading\": \"adapted reading passage\",\n  \"comprehension\": [\"question 1\", \"question 2\", \"question 3\", \"question 4\"],\n  \"discussion\": [\"question 1\", \"question 2\", \"question 3\"],\n  \"grammar\": {\n    \"focus\": \"grammar topic\",\n    \"examples\": [\"example 1\", \"example 2\"],\n    \"exercise\": [\"exercise 1\", \"exercise 2\"]\n  },\n  \"pronunciation\": {\n    \"word\": \"challenging word\",\n    \"ipa\": \"/pronunciation/\",\n    \"practice\": \"practice sentence\"\n  },\n  \"wrapup\": [\"reflection 1\", \"reflection 2\", \"reflection 3\"]\n}\n\nIMPORTANT: \n- All content must be directly related to and derived from the source material\n- Vocabulary should come from the actual text, not generic word lists\n- Examples should reference the specific content, not generic scenarios\n- Questions should be about the actual topics discussed, not general themes\n\nReturn only valid JSON:`;\n        try {\n            console.log(\"\\uD83E\\uDD16 Calling AI for lesson structure...\");\n            const response = await this.getGoogleAI().prompt(prompt, {\n                temperature: 0.7,\n                maxTokens: 2000\n            });\n            console.log(\"\\uD83E\\uDD16 AI lesson structure response:\", response.substring(0, 200) + \"...\");\n            try {\n                const parsed = JSON.parse(response);\n                console.log(\"✅ Successfully parsed lesson structure JSON\");\n                return parsed;\n            } catch (parseError) {\n                console.warn(\"⚠️ Failed to parse JSON, attempting to clean response...\");\n                // Try to extract JSON from the response\n                const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n                if (jsonMatch) {\n                    try {\n                        const cleaned = JSON.parse(jsonMatch[0]);\n                        console.log(\"✅ Successfully parsed cleaned JSON\");\n                        return cleaned;\n                    } catch (cleanError) {\n                        console.warn(\"⚠️ Failed to parse cleaned JSON, using fallback\");\n                    }\n                }\n                // If JSON parsing fails, return a structured fallback\n                return this.createStructuredFallback(content, lessonType, studentLevel);\n            }\n        } catch (error) {\n            console.warn(\"⚠️ AI lesson structure generation failed, using fallback:\", error.message);\n            return this.createStructuredFallback(content, lessonType, studentLevel);\n        }\n    }\n    // Enhanced detailed content generation with context\n    async generateDetailedContextualContent(structure, content, contentAnalysis, lessonType, studentLevel, targetLanguage, structuredContent) {\n        // Use Writer API to expand each section with contextual, detailed content\n        const sections = {\n            ...structure\n        };\n        // Enhance vocabulary section with contextual examples\n        if (sections.vocabulary) {\n            for(let i = 0; i < sections.vocabulary.length; i++){\n                const vocab = sections.vocabulary[i];\n                try {\n                    const contextualExamplePrompt = `\nCreate a natural example sentence using the word \"${vocab.word}\" that relates to this content context:\nTopics: ${contentAnalysis.topics.join(\", \")}\nContent type: ${contentAnalysis.contentType}\nLevel: ${studentLevel}\n\nMake the example relevant to the source material and appropriate for ${studentLevel} level students.\n`;\n                    const enhancedExample = await this.getGoogleAI().write(contextualExamplePrompt, {\n                        tone: \"casual\",\n                        length: \"short\"\n                    });\n                    sections.vocabulary[i].example = enhancedExample;\n                    // Add contextual meaning based on source content\n                    const contextualMeaningPrompt = `\nExplain the meaning of \"${vocab.word}\" in the context of: ${contentAnalysis.topics[0] || contentAnalysis.contentType}\nKeep it simple for ${studentLevel} level students.\n`;\n                    const contextualMeaning = await this.getGoogleAI().write(contextualMeaningPrompt, {\n                        tone: \"casual\",\n                        length: \"short\"\n                    });\n                    sections.vocabulary[i].contextualMeaning = contextualMeaning;\n                } catch (error) {\n                    // Keep original if enhancement fails\n                    console.warn(`Failed to enhance vocabulary for ${vocab.word}:`, error);\n                }\n            }\n        }\n        // Enhance discussion questions with specific content references\n        if (sections.discussion) {\n            try {\n                const enhancedDiscussionPrompt = `\nEnhance these discussion questions for a ${lessonType} lesson about ${contentAnalysis.topics.join(\" and \")}:\n${sections.discussion.join(\"\\n\")}\n\nMake them more specific to the content, engaging for ${studentLevel} level students, and encourage deeper thinking about:\n- ${contentAnalysis.topics.slice(0, 3).join(\"\\n- \")}\n\nReturn 3-4 enhanced questions that reference specific aspects of the content.\n`;\n                const enhancedDiscussion = await this.getGoogleAI().write(enhancedDiscussionPrompt, {\n                    tone: \"casual\",\n                    length: \"medium\",\n                    format: \"bullet-points\"\n                });\n                sections.discussion = this.parseListFromText(enhancedDiscussion).slice(0, 4);\n            } catch (error) {\n                console.warn(\"Failed to enhance discussion questions:\", error);\n            }\n        }\n        // Enhance reading section with better structure\n        if (sections.reading && structuredContent?.headings?.length > 0) {\n            try {\n                const structuredReadingPrompt = `\nImprove this reading text by organizing it with clear structure based on these headings from the original:\n${structuredContent.headings.slice(0, 3).map((h)=>`- ${h.text}`).join(\"\\n\")}\n\nOriginal text: \"${sections.reading}\"\n\nCreate a well-structured, ${studentLevel}-appropriate reading passage that maintains the key information but improves readability.\n`;\n                const enhancedReading = await this.getGoogleAI().rewrite(sections.reading, {\n                    tone: \"casual\",\n                    length: \"same\",\n                    audience: this.getAudienceLevel(studentLevel)\n                });\n                sections.reading = enhancedReading;\n            } catch (error) {\n                console.warn(\"Failed to enhance reading section:\", error);\n            }\n        }\n        // Enhance grammar section with content-specific examples\n        if (sections.grammar && sections.grammar.focus) {\n            try {\n                const grammarExamplesPrompt = `\nCreate 3 grammar examples for \"${sections.grammar.focus}\" using vocabulary and concepts from this content:\nTopics: ${contentAnalysis.topics.join(\", \")}\nKey vocabulary: ${contentAnalysis.keyVocabulary.slice(0, 5).join(\", \")}\n\nMake examples relevant to the content and appropriate for ${studentLevel} level.\n`;\n                const contextualGrammarExamples = await this.getGoogleAI().write(grammarExamplesPrompt, {\n                    tone: \"casual\",\n                    length: \"short\",\n                    format: \"bullet-points\"\n                });\n                sections.grammar.contextualExamples = this.parseListFromText(contextualGrammarExamples);\n            } catch (error) {\n                console.warn(\"Failed to enhance grammar examples:\", error);\n            }\n        }\n        return sections;\n    }\n    async proofreadLesson(lesson) {\n        // Proofread key text sections\n        const sectionsToProofread = [\n            \"reading\",\n            \"grammar.examples\",\n            \"pronunciation.practice\"\n        ];\n        for (const sectionPath of sectionsToProofread){\n            const value = this.getNestedValue(lesson, sectionPath);\n            if (typeof value === \"string\") {\n                const proofread = await this.getGoogleAI().proofread(value, {\n                    checkGrammar: true,\n                    checkSpelling: true,\n                    checkStyle: true\n                });\n                this.setNestedValue(lesson, sectionPath, proofread.corrected_text);\n            }\n        }\n        return lesson;\n    }\n    generateFallbackLesson(params) {\n        // Template-based fallback when AI APIs fail\n        const { sourceText, lessonType, studentLevel, targetLanguage } = params;\n        return {\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sections: {\n                warmup: this.getTemplateWarmup(lessonType, studentLevel),\n                vocabulary: this.extractVocabulary(sourceText, studentLevel),\n                reading: this.simplifyText(sourceText, studentLevel),\n                comprehension: this.getTemplateComprehension(lessonType, studentLevel),\n                discussion: this.getTemplateDiscussion(lessonType, studentLevel),\n                grammar: this.getTemplateGrammar(studentLevel),\n                pronunciation: this.getTemplatePronunciation(sourceText),\n                wrapup: this.getTemplateWrapup(lessonType)\n            }\n        };\n    }\n    // Helper methods\n    getSummaryLength(level) {\n        const lengthMap = {\n            A1: \"short\",\n            A2: \"short\",\n            B1: \"medium\",\n            B2: \"medium\",\n            C1: \"long\"\n        };\n        return lengthMap[level] || \"medium\";\n    }\n    getLanguageCode(language) {\n        const languageMap = {\n            spanish: \"es\",\n            french: \"fr\",\n            german: \"de\",\n            italian: \"it\",\n            portuguese: \"pt\",\n            japanese: \"ja\",\n            korean: \"ko\",\n            chinese: \"zh\"\n        };\n        return languageMap[language] || \"en\";\n    }\n    parseListFromText(text) {\n        return text.split(\"\\n\").filter((line)=>line.trim()).map((line)=>line.replace(/^[-•*]\\s*/, \"\").trim()).filter((line)=>line.length > 0).slice(0, 4) // Limit to 4 items\n        ;\n    }\n    getNestedValue(obj, path) {\n        return path.split(\".\").reduce((current, key)=>current?.[key], obj);\n    }\n    setNestedValue(obj, path, value) {\n        const keys = path.split(\".\");\n        const lastKey = keys.pop();\n        const target = keys.reduce((current, key)=>current[key], obj);\n        target[lastKey] = value;\n    }\n    createStructuredFallback(content, lessonType, studentLevel) {\n        console.log(\"\\uD83D\\uDD04 Creating structured fallback lesson...\");\n        // Extract some basic information from content for better fallback\n        const words = content.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ].slice(0, 6);\n        const fallback = {\n            warmup: this.getTemplateWarmup(lessonType, studentLevel),\n            vocabulary: uniqueWords.map((word)=>({\n                    word: word,\n                    meaning: `Definition of ${word}`,\n                    example: `Example sentence with ${word}.`\n                })),\n            reading: this.simplifyText(content, studentLevel),\n            comprehension: this.getTemplateComprehension(lessonType, studentLevel),\n            discussion: this.getTemplateDiscussion(lessonType, studentLevel),\n            grammar: this.getTemplateGrammar(studentLevel),\n            pronunciation: this.getTemplatePronunciation(content),\n            wrapup: this.getTemplateWrapup(lessonType)\n        };\n        console.log(\"✅ Structured fallback created\");\n        return fallback;\n    }\n    getTemplateWarmup(lessonType, studentLevel) {\n        const templates = {\n            discussion: [\n                \"What do you already know about this topic?\",\n                \"Have you had similar experiences?\",\n                \"What would you like to learn more about?\"\n            ],\n            grammar: [\n                \"What grammar patterns do you notice?\",\n                \"Which sentences seem most complex?\",\n                \"What grammar rules do you remember?\"\n            ],\n            travel: [\n                \"Where would you like to travel next?\",\n                \"What travel experiences have you had?\",\n                \"What travel vocabulary do you know?\"\n            ],\n            business: [\n                \"What business situations are you familiar with?\",\n                \"How do you communicate professionally?\",\n                \"What business terms are challenging?\"\n            ],\n            pronunciation: [\n                \"Which sounds are difficult to pronounce?\",\n                \"How do you practice pronunciation?\",\n                \"What pronunciation goals do you have?\"\n            ]\n        };\n        return templates[lessonType] || templates.discussion;\n    }\n    extractVocabulary(text, studentLevel) {\n        // Simple vocabulary extraction based on word frequency and complexity\n        const words = text.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ];\n        const selectedWords = uniqueWords.slice(0, 6);\n        return selectedWords.map((word)=>({\n                word: word,\n                meaning: `Definition of ${word}`,\n                example: `Example sentence with ${word}.`\n            }));\n    }\n    simplifyText(text, studentLevel) {\n        // Basic text simplification based on level\n        const maxLength = {\n            A1: 200,\n            A2: 300,\n            B1: 400,\n            B2: 500,\n            C1: 600\n        };\n        const limit = maxLength[studentLevel] || 400;\n        return text.substring(0, limit) + (text.length > limit ? \"...\" : \"\");\n    }\n    getTemplateComprehension(lessonType, studentLevel) {\n        return [\n            \"What is the main idea of this text?\",\n            \"What supporting details can you identify?\",\n            \"How does this relate to your experience?\",\n            \"What conclusions can you draw?\"\n        ];\n    }\n    getTemplateDiscussion(lessonType, studentLevel) {\n        const templates = {\n            discussion: [\n                \"What is your opinion on this topic?\",\n                \"How would you handle this situation?\",\n                \"What alternative approaches exist?\"\n            ],\n            business: [\n                \"How would you apply this professionally?\",\n                \"What business challenges does this address?\",\n                \"How would you present this to colleagues?\"\n            ],\n            travel: [\n                \"How would this help while traveling?\",\n                \"What preparations would you make?\",\n                \"How would you share this experience?\"\n            ]\n        };\n        return templates[lessonType] || templates.discussion;\n    }\n    getTemplateGrammar(studentLevel) {\n        const grammarFoci = {\n            A1: \"Present Simple Tense\",\n            A2: \"Past Simple Tense\",\n            B1: \"Present Perfect Tense\",\n            B2: \"Conditional Sentences\",\n            C1: \"Advanced Grammar Structures\"\n        };\n        return {\n            focus: grammarFoci[studentLevel] || \"Present Perfect Tense\",\n            examples: [\n                \"I have learned many new things.\",\n                \"She has improved her skills.\",\n                \"We have discussed this topic.\"\n            ],\n            exercise: [\n                \"I _____ (learn) a lot today.\",\n                \"They _____ (complete) the project.\",\n                \"She _____ (improve) significantly.\"\n            ]\n        };\n    }\n    getTemplatePronunciation(text) {\n        // Extract a challenging word from the text\n        const words = text.match(/\\b[a-z]{6,}\\b/gi) || [\n            \"communication\"\n        ];\n        const selectedWord = words[0] || \"communication\";\n        return {\n            word: selectedWord.toLowerCase(),\n            ipa: \"/kəˌmjuːnɪˈkeɪʃən/\",\n            practice: `Practice saying: \"${selectedWord}\" in a sentence.`\n        };\n    }\n    getTemplateWrapup(lessonType) {\n        return [\n            \"What new vocabulary did you learn?\",\n            \"Which concepts need more practice?\",\n            \"How will you use this knowledge?\",\n            \"What questions do you still have?\"\n        ];\n    }\n    // New helper methods for enhanced contextual analysis\n    extractTopicsFromHeadings(headings) {\n        return headings.filter((h)=>h.level <= 3) // Focus on main headings\n        .map((h)=>h.text).slice(0, 5);\n    }\n    extractVocabularyFromText(text, level) {\n        // Extract words based on complexity appropriate for the level\n        const words = text.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ];\n        // Filter by complexity based on level\n        const complexityThreshold = {\n            \"A1\": 6,\n            \"A2\": 7,\n            \"B1\": 8,\n            \"B2\": 10,\n            \"C1\": 12\n        };\n        const maxLength = complexityThreshold[level] || 8;\n        return uniqueWords.filter((word)=>word.length <= maxLength && word.length >= 4).slice(0, 8);\n    }\n    determineCulturalContext(domain, text) {\n        // Determine cultural context based on domain and content\n        const culturalIndicators = {\n            \"bbc.com\": \"British English, UK culture\",\n            \"cnn.com\": \"American English, US culture\",\n            \"wikipedia.org\": \"International, encyclopedic\",\n            \"nytimes.com\": \"American English, US perspective\",\n            \"theguardian.com\": \"British English, UK perspective\"\n        };\n        if (culturalIndicators[domain]) {\n            return culturalIndicators[domain];\n        }\n        // Analyze text for cultural markers\n        const americanMarkers = [\n            \"dollar\",\n            \"president\",\n            \"congress\",\n            \"state\",\n            \"federal\"\n        ];\n        const britishMarkers = [\n            \"pound\",\n            \"minister\",\n            \"parliament\",\n            \"council\",\n            \"government\"\n        ];\n        const americanCount = americanMarkers.filter((marker)=>text.toLowerCase().includes(marker)).length;\n        const britishCount = britishMarkers.filter((marker)=>text.toLowerCase().includes(marker)).length;\n        if (americanCount > britishCount) {\n            return \"American English context\";\n        } else if (britishCount > americanCount) {\n            return \"British English context\";\n        }\n        return \"International context\";\n    }\n    generateLearningObjectives(contentType, topics, level) {\n        const objectives = [];\n        // Base objectives on content type\n        switch(contentType){\n            case \"news\":\n                objectives.push(\"Understand current events vocabulary\");\n                objectives.push(\"Practice reading news articles\");\n                break;\n            case \"blog\":\n                objectives.push(\"Learn informal writing style\");\n                objectives.push(\"Understand personal opinions and experiences\");\n                break;\n            case \"tutorial\":\n                objectives.push(\"Follow step-by-step instructions\");\n                objectives.push(\"Learn technical vocabulary\");\n                break;\n            case \"encyclopedia\":\n                objectives.push(\"Understand factual information\");\n                objectives.push(\"Learn academic vocabulary\");\n                break;\n            default:\n                objectives.push(\"Improve reading comprehension\");\n                objectives.push(\"Expand vocabulary knowledge\");\n        }\n        // Add topic-specific objectives\n        topics.slice(0, 2).forEach((topic)=>{\n            objectives.push(`Discuss topics related to ${topic.toLowerCase()}`);\n        });\n        return objectives.slice(0, 4);\n    }\n    getAudienceLevel(cefrLevel) {\n        const levelMap = {\n            \"A1\": \"beginner\",\n            \"A2\": \"beginner\",\n            \"B1\": \"general\",\n            \"B2\": \"general\",\n            \"C1\": \"expert\"\n        };\n        return levelMap[cefrLevel] || \"general\";\n    }\n    // Enhanced fallback lesson generation with context\n    generateEnhancedFallbackLesson(params) {\n        const { sourceText, lessonType, studentLevel, targetLanguage, contentMetadata, structuredContent } = params;\n        // Use available context even in fallback\n        const topics = structuredContent?.headings?.map((h)=>h.text).slice(0, 3) || [];\n        const contentType = contentMetadata?.contentType || \"general\";\n        return {\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sections: {\n                warmup: this.getContextualWarmup(lessonType, studentLevel, topics, contentType),\n                vocabulary: this.extractContextualVocabulary(sourceText, studentLevel, topics),\n                reading: this.simplifyText(sourceText, studentLevel),\n                comprehension: this.getContextualComprehension(lessonType, studentLevel, topics),\n                discussion: this.getContextualDiscussion(lessonType, studentLevel, topics),\n                grammar: this.getTemplateGrammar(studentLevel),\n                pronunciation: this.getTemplatePronunciation(sourceText),\n                wrapup: this.getContextualWrapup(lessonType, topics)\n            }\n        };\n    }\n    getContextualWarmup(lessonType, studentLevel, topics, contentType) {\n        // Use the same contextual fallback logic\n        const mockAnalysis = {\n            topics: topics,\n            contentType: contentType,\n            sourceCountry: \"International\"\n        };\n        return this.getContextualWarmupFallback(studentLevel, mockAnalysis, {\n            title: topics[0] || \"Content\"\n        });\n    }\n    extractContextualVocabulary(text, studentLevel, topics) {\n        const vocabulary = this.extractVocabulary(text, studentLevel);\n        // Enhance with topic context if available\n        if (topics.length > 0) {\n            return vocabulary.map((vocab, index)=>({\n                    ...vocab,\n                    context: index < topics.length ? `Related to ${topics[index].toLowerCase()}` : vocab.meaning\n                }));\n        }\n        return vocabulary;\n    }\n    getContextualComprehension(lessonType, studentLevel, topics) {\n        const baseQuestions = this.getTemplateComprehension(lessonType, studentLevel);\n        if (topics.length > 0) {\n            return [\n                `What is the main point about ${topics[0]?.toLowerCase()}?`,\n                `How does the text explain ${topics[1]?.toLowerCase() || \"the topic\"}?`,\n                \"What supporting details can you identify?\",\n                \"What conclusions can you draw from this information?\"\n            ];\n        }\n        return baseQuestions;\n    }\n    getContextualDiscussion(lessonType, studentLevel, topics) {\n        const baseQuestions = this.getTemplateDiscussion(lessonType, studentLevel);\n        if (topics.length > 0) {\n            return [\n                `What is your opinion about ${topics[0]?.toLowerCase()}?`,\n                `How would you apply this information about ${topics[1]?.toLowerCase() || \"this topic\"}?`,\n                `What are the implications of what you learned about ${topics[0]?.toLowerCase()}?`\n            ];\n        }\n        return baseQuestions;\n    }\n    getContextualWrapup(lessonType, topics) {\n        if (topics.length > 0) {\n            return [\n                `What new vocabulary did you learn about ${topics[0]?.toLowerCase()}?`,\n                `Which concepts about ${topics[1]?.toLowerCase() || \"this topic\"} need more practice?`,\n                \"How will you use this knowledge in real situations?\",\n                \"What questions do you still have about this content?\"\n            ];\n        }\n        return this.getTemplateWrapup(lessonType);\n    }\n    // Helper method to determine source country from domain\n    determineSourceCountry(domain) {\n        const countryMap = {\n            \"bbc.com\": \"United Kingdom\",\n            \"bbc.co.uk\": \"United Kingdom\",\n            \"cnn.com\": \"United States\",\n            \"nytimes.com\": \"United States\",\n            \"theguardian.com\": \"United Kingdom\",\n            \"washingtonpost.com\": \"United States\",\n            \"reuters.com\": \"International\",\n            \"ap.org\": \"United States\",\n            \"npr.org\": \"United States\",\n            \"abc.net.au\": \"Australia\",\n            \"cbc.ca\": \"Canada\"\n        };\n        for (const [domainKey, country] of Object.entries(countryMap)){\n            if (domain.includes(domainKey)) {\n                return country;\n            }\n        }\n        return \"International\";\n    }\n    // Fallback warm-up question generator\n    getFallbackWarmupQuestion(level, contentAnalysis, questionIndex) {\n        const topic = contentAnalysis.topics[0] || \"this topic\";\n        const contentType = contentAnalysis.contentType;\n        const fallbackQuestions = {\n            \"A1\": [\n                `Do you know about ${topic.toLowerCase()}?`,\n                `Is ${topic.toLowerCase()} important in your country?`,\n                `Do you like to read about ${topic.toLowerCase()}?`\n            ],\n            \"A2\": [\n                `Have you heard about ${topic.toLowerCase()} before?`,\n                `What do you know about ${topic.toLowerCase()}?`,\n                `Is ${topic.toLowerCase()} different in your country?`\n            ],\n            \"B1\": [\n                `What do you think about ${topic.toLowerCase()}?`,\n                `How is ${topic.toLowerCase()} important in your daily life?`,\n                `What would you like to know about ${topic.toLowerCase()}?`\n            ],\n            \"B2\": [\n                `What are your thoughts on ${topic.toLowerCase()}?`,\n                `How might ${topic.toLowerCase()} affect people in different countries?`,\n                `What questions would you ask about ${topic.toLowerCase()}?`\n            ],\n            \"C1\": [\n                `How do cultural perspectives influence attitudes toward ${topic.toLowerCase()}?`,\n                `What are the broader implications of ${topic.toLowerCase()} in modern society?`,\n                `How might ${topic.toLowerCase()} evolve in the coming years?`\n            ]\n        };\n        const levelQuestions = fallbackQuestions[level] || fallbackQuestions[\"B1\"];\n        return levelQuestions[questionIndex] || levelQuestions[0];\n    }\n    // Contextual warm-up fallback when AI fails\n    getContextualWarmupFallback(level, contentAnalysis, metadata) {\n        const topic = contentAnalysis.topics[0] || \"this topic\";\n        const sourceCountry = contentAnalysis.sourceCountry || \"this country\";\n        const title = metadata?.title || \"this content\";\n        const fallbackSets = {\n            \"A1\": [\n                `Do you know about ${topic.toLowerCase()}?`,\n                `Is this topic common in your country?`,\n                `Do you want to learn about ${topic.toLowerCase()}?`\n            ],\n            \"A2\": [\n                `Have you experienced ${topic.toLowerCase()} before?`,\n                `What is ${topic.toLowerCase()} like in your country?`,\n                `Why is ${topic.toLowerCase()} interesting to you?`\n            ],\n            \"B1\": [\n                `What do you think about ${topic.toLowerCase()}?`,\n                `How is ${topic.toLowerCase()} different in your country compared to ${sourceCountry}?`,\n                `What would you expect to learn from this ${contentAnalysis.contentType}?`\n            ],\n            \"B2\": [\n                `What are your thoughts on how ${topic.toLowerCase()} is presented in ${sourceCountry} media?`,\n                `What challenges do you think people face with ${topic.toLowerCase()}?`,\n                `How might your perspective on ${topic.toLowerCase()} differ from the author's?`\n            ],\n            \"C1\": [\n                `How do cultural attitudes toward ${topic.toLowerCase()} vary between ${sourceCountry} and your country?`,\n                `What are the broader societal implications of ${topic.toLowerCase()}?`,\n                `How might the perspective in this ${contentAnalysis.contentType} reflect ${sourceCountry} values?`\n            ]\n        };\n        return fallbackSets[level] || fallbackSets[\"B1\"];\n    }\n    constructor(){\n        this.googleAI = null;\n    }\n}\nconst lessonAIServerGenerator = new LessonAIServerGenerator();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUF5QiIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvbGVzc29uLWFpLWdlbmVyYXRvci1zZXJ2ZXIudHM/MGJiMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVHb29nbGVBSVNlcnZlclNlcnZpY2UgfSBmcm9tIFwiLi9nb29nbGUtYWktc2VydmVyXCJcblxuaW50ZXJmYWNlIExlc3NvbkdlbmVyYXRpb25QYXJhbXMge1xuICBzb3VyY2VUZXh0OiBzdHJpbmdcbiAgbGVzc29uVHlwZTogc3RyaW5nXG4gIHN0dWRlbnRMZXZlbDogc3RyaW5nXG4gIHRhcmdldExhbmd1YWdlOiBzdHJpbmdcbiAgc291cmNlVXJsPzogc3RyaW5nXG4gIGNvbnRlbnRNZXRhZGF0YT86IHtcbiAgICB0aXRsZT86IHN0cmluZ1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gICAgYXV0aG9yPzogc3RyaW5nXG4gICAgcHVibGlzaERhdGU/OiBzdHJpbmdcbiAgICBjb250ZW50VHlwZT86IHN0cmluZ1xuICAgIGRvbWFpbj86IHN0cmluZ1xuICAgIGxhbmd1YWdlPzogc3RyaW5nXG4gICAga2V5d29yZHM/OiBzdHJpbmdbXVxuICB9XG4gIHN0cnVjdHVyZWRDb250ZW50Pzoge1xuICAgIGhlYWRpbmdzPzogQXJyYXk8eyBsZXZlbDogbnVtYmVyOyB0ZXh0OiBzdHJpbmcgfT5cbiAgICBwYXJhZ3JhcGhzPzogc3RyaW5nW11cbiAgICBsaXN0cz86IEFycmF5PHsgdHlwZTogc3RyaW5nOyBpdGVtczogc3RyaW5nW10gfT5cbiAgICBxdW90ZXM/OiBzdHJpbmdbXVxuICAgIGltYWdlcz86IEFycmF5PHsgYWx0OiBzdHJpbmc7IHNyYzogc3RyaW5nIH0+XG4gICAgbGlua3M/OiBBcnJheTx7IHRleHQ6IHN0cmluZzsgdXJsOiBzdHJpbmcgfT5cbiAgfVxuICB3b3JkQ291bnQ/OiBudW1iZXJcbiAgcmVhZGluZ1RpbWU/OiBudW1iZXJcbn1cblxuaW50ZXJmYWNlIEdlbmVyYXRlZExlc3NvbiB7XG4gIGxlc3NvblR5cGU6IHN0cmluZ1xuICBzdHVkZW50TGV2ZWw6IHN0cmluZ1xuICB0YXJnZXRMYW5ndWFnZTogc3RyaW5nXG4gIHNlY3Rpb25zOiB7XG4gICAgd2FybXVwOiBzdHJpbmdbXVxuICAgIHZvY2FidWxhcnk6IEFycmF5PHsgd29yZDogc3RyaW5nOyBtZWFuaW5nOiBzdHJpbmc7IGV4YW1wbGU6IHN0cmluZyB9PlxuICAgIHJlYWRpbmc6IHN0cmluZ1xuICAgIGNvbXByZWhlbnNpb246IHN0cmluZ1tdXG4gICAgZGlzY3Vzc2lvbjogc3RyaW5nW11cbiAgICBncmFtbWFyOiB7XG4gICAgICBmb2N1czogc3RyaW5nXG4gICAgICBleGFtcGxlczogc3RyaW5nW11cbiAgICAgIGV4ZXJjaXNlOiBzdHJpbmdbXVxuICAgIH1cbiAgICBwcm9udW5jaWF0aW9uOiB7XG4gICAgICB3b3JkOiBzdHJpbmdcbiAgICAgIGlwYTogc3RyaW5nXG4gICAgICBwcmFjdGljZTogc3RyaW5nXG4gICAgfVxuICAgIHdyYXB1cDogc3RyaW5nW11cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTGVzc29uQUlTZXJ2ZXJHZW5lcmF0b3Ige1xuICBwcml2YXRlIGdvb2dsZUFJOiBSZXR1cm5UeXBlPHR5cGVvZiBjcmVhdGVHb29nbGVBSVNlcnZlclNlcnZpY2U+IHwgbnVsbCA9IG51bGxcblxuICBwcml2YXRlIGdldEdvb2dsZUFJKCkge1xuICAgIGlmICghdGhpcy5nb29nbGVBSSkge1xuICAgICAgdGhpcy5nb29nbGVBSSA9IGNyZWF0ZUdvb2dsZUFJU2VydmVyU2VydmljZSgpXG4gICAgfVxuICAgIHJldHVybiB0aGlzLmdvb2dsZUFJXG4gIH1cblxuICBhc3luYyBnZW5lcmF0ZUxlc3NvbihwYXJhbXM6IExlc3NvbkdlbmVyYXRpb25QYXJhbXMpOiBQcm9taXNlPEdlbmVyYXRlZExlc3Nvbj4ge1xuICAgIGNvbnN0IHsgXG4gICAgICBzb3VyY2VUZXh0LCBcbiAgICAgIGxlc3NvblR5cGUsIFxuICAgICAgc3R1ZGVudExldmVsLCBcbiAgICAgIHRhcmdldExhbmd1YWdlLCBcbiAgICAgIHNvdXJjZVVybCxcbiAgICAgIGNvbnRlbnRNZXRhZGF0YSxcbiAgICAgIHN0cnVjdHVyZWRDb250ZW50LFxuICAgICAgd29yZENvdW50LFxuICAgICAgcmVhZGluZ1RpbWVcbiAgICB9ID0gcGFyYW1zXG5cbiAgICBjb25zb2xlLmxvZyhcIvCfmoAgU3RhcnRpbmcgQUkgbGVzc29uIGdlbmVyYXRpb24gd2l0aCBwYXJhbXM6XCIsIHtcbiAgICAgIHRleHRMZW5ndGg6IHNvdXJjZVRleHQubGVuZ3RoLFxuICAgICAgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgaGFzTWV0YWRhdGE6ICEhY29udGVudE1ldGFkYXRhLFxuICAgICAgaGFzU3RydWN0dXJlZENvbnRlbnQ6ICEhc3RydWN0dXJlZENvbnRlbnRcbiAgICB9KVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogQW5hbHl6ZSBjb250ZW50IGNvbnRleHQgYW5kIGNvbXBsZXhpdHlcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+TiiBTdGVwIDE6IEFuYWx5emluZyBjb250ZW50IGNvbnRleHQuLi5cIilcbiAgICAgIGNvbnN0IGNvbnRlbnRBbmFseXNpcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZUNvbnRlbnRDb250ZXh0KFxuICAgICAgICBzb3VyY2VUZXh0LFxuICAgICAgICBjb250ZW50TWV0YWRhdGEsXG4gICAgICAgIHN0cnVjdHVyZWRDb250ZW50LFxuICAgICAgICBzdHVkZW50TGV2ZWxcbiAgICAgIClcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIENvbnRlbnQgYW5hbHlzaXMgY29tcGxldGU6XCIsIGNvbnRlbnRBbmFseXNpcylcblxuICAgICAgLy8gU3RlcCAyOiBDcmVhdGUgY29udGV4dHVhbCBzdW1tYXJ5IGJhc2VkIG9uIGxlc3NvbiB0eXBlIGFuZCBjb250ZW50IGFuYWx5c2lzXG4gICAgICBjb25zb2xlLmxvZyhcIvCfk50gU3RlcCAyOiBDcmVhdGluZyBjb250ZXh0dWFsIHN1bW1hcnkuLi5cIilcbiAgICAgIGNvbnN0IGNvbnRleHR1YWxTdW1tYXJ5ID0gYXdhaXQgdGhpcy5jcmVhdGVDb250ZXh0dWFsU3VtbWFyeShcbiAgICAgICAgc291cmNlVGV4dCxcbiAgICAgICAgY29udGVudEFuYWx5c2lzLFxuICAgICAgICBsZXNzb25UeXBlLFxuICAgICAgICBzdHVkZW50TGV2ZWxcbiAgICAgIClcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIENvbnRleHR1YWwgc3VtbWFyeSBjcmVhdGVkLCBsZW5ndGg6XCIsIGNvbnRleHR1YWxTdW1tYXJ5Lmxlbmd0aClcblxuICAgICAgLy8gU3RlcCAzOiBUcmFuc2xhdGUgaWYgbmVlZGVkIChmb3Igbm9uLUVuZ2xpc2ggdGFyZ2V0IGxhbmd1YWdlcylcbiAgICAgIGxldCB0cmFuc2xhdGVkQ29udGVudCA9IGNvbnRleHR1YWxTdW1tYXJ5XG4gICAgICBpZiAodGFyZ2V0TGFuZ3VhZ2UgIT09IFwiZW5nbGlzaFwiKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi8J+MkCBTdGVwIDM6IFRyYW5zbGF0aW5nIHRvXCIsIHRhcmdldExhbmd1YWdlKVxuICAgICAgICB0cmFuc2xhdGVkQ29udGVudCA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS50cmFuc2xhdGUoY29udGV4dHVhbFN1bW1hcnksIHtcbiAgICAgICAgICB0YXJnZXRMYW5ndWFnZTogdGhpcy5nZXRMYW5ndWFnZUNvZGUodGFyZ2V0TGFuZ3VhZ2UpLFxuICAgICAgICB9KVxuICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBUcmFuc2xhdGlvbiBjb21wbGV0ZSwgbGVuZ3RoOlwiLCB0cmFuc2xhdGVkQ29udGVudC5sZW5ndGgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcIuKPre+4jyBTdGVwIDM6IFNraXBwaW5nIHRyYW5zbGF0aW9uICh0YXJnZXQgaXMgRW5nbGlzaClcIilcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBHZW5lcmF0ZSBjb250ZXh0dWFsIGxlc3NvbiBzdHJ1Y3R1cmVcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+Pl++4jyBTdGVwIDQ6IEdlbmVyYXRpbmcgbGVzc29uIHN0cnVjdHVyZS4uLlwiKVxuICAgICAgY29uc3QgbGVzc29uU3RydWN0dXJlID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUNvbnRleHR1YWxMZXNzb25TdHJ1Y3R1cmUoXG4gICAgICAgIHRyYW5zbGF0ZWRDb250ZW50LFxuICAgICAgICBjb250ZW50QW5hbHlzaXMsXG4gICAgICAgIGxlc3NvblR5cGUsXG4gICAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgICAgdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICAgIGNvbnRlbnRNZXRhZGF0YVxuICAgICAgKVxuICAgICAgY29uc29sZS5sb2coXCLinIUgTGVzc29uIHN0cnVjdHVyZSBnZW5lcmF0ZWQ6XCIsIE9iamVjdC5rZXlzKGxlc3NvblN0cnVjdHVyZSkpXG5cbiAgICAgIC8vIFN0ZXAgNTogR2VuZXJhdGUgZGV0YWlsZWQgY29udGVudCBmb3IgZWFjaCBzZWN0aW9uIHdpdGggY29udGV4dFxuICAgICAgY29uc29sZS5sb2coXCLwn5SnIFN0ZXAgNTogRW5oYW5jaW5nIGxlc3NvbiBjb250ZW50Li4uXCIpXG4gICAgICBjb25zdCBkZXRhaWxlZExlc3NvbiA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVEZXRhaWxlZENvbnRleHR1YWxDb250ZW50KFxuICAgICAgICBsZXNzb25TdHJ1Y3R1cmUsXG4gICAgICAgIHRyYW5zbGF0ZWRDb250ZW50LFxuICAgICAgICBjb250ZW50QW5hbHlzaXMsXG4gICAgICAgIGxlc3NvblR5cGUsXG4gICAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgICAgdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICAgIHN0cnVjdHVyZWRDb250ZW50XG4gICAgICApXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBEZXRhaWxlZCBjb250ZW50IGdlbmVyYXRlZFwiKVxuXG4gICAgICAvLyBTdGVwIDY6IFByb29mcmVhZCBhbmQgcG9saXNoIHRoZSBmaW5hbCBsZXNzb25cbiAgICAgIGNvbnNvbGUubG9nKFwi4pyoIFN0ZXAgNjogUHJvb2ZyZWFkaW5nIGxlc3Nvbi4uLlwiKVxuICAgICAgY29uc3QgcG9saXNoZWRMZXNzb24gPSBhd2FpdCB0aGlzLnByb29mcmVhZExlc3NvbihkZXRhaWxlZExlc3NvbilcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+OiSBBSSBsZXNzb24gZ2VuZXJhdGlvbiBjb21wbGV0ZSFcIilcblxuICAgICAgcmV0dXJuIHBvbGlzaGVkTGVzc29uXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgaW4gQUkgbGVzc29uIGdlbmVyYXRpb246XCIsIGVycm9yKVxuICAgICAgY29uc29sZS5sb2coXCLwn5SEIEZhbGxpbmcgYmFjayB0byBlbmhhbmNlZCB0ZW1wbGF0ZSBnZW5lcmF0aW9uLi4uXCIpXG4gICAgICAvLyBGYWxsYmFjayB0byBlbmhhbmNlZCB0ZW1wbGF0ZS1iYXNlZCBnZW5lcmF0aW9uIHdpdGggY29udGV4dFxuICAgICAgcmV0dXJuIHRoaXMuZ2VuZXJhdGVFbmhhbmNlZEZhbGxiYWNrTGVzc29uKHBhcmFtcylcbiAgICB9XG4gIH1cblxuICAvLyBOZXcgbWV0aG9kOiBBbmFseXplIGNvbnRlbnQgY29udGV4dCBhbmQgY29tcGxleGl0eVxuICBwcml2YXRlIGFzeW5jIGFuYWx5emVDb250ZW50Q29udGV4dChcbiAgICBzb3VyY2VUZXh0OiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBhbnksXG4gICAgc3RydWN0dXJlZENvbnRlbnQ/OiBhbnksXG4gICAgc3R1ZGVudExldmVsPzogc3RyaW5nXG4gICkge1xuICAgIGNvbnNvbGUubG9nKFwi8J+UjSBBbmFseXppbmcgY29udGVudCBjb250ZXh0Li4uXCIpXG4gICAgXG4gICAgY29uc3QgYW5hbHlzaXMgPSB7XG4gICAgICBjb250ZW50VHlwZTogbWV0YWRhdGE/LmNvbnRlbnRUeXBlIHx8ICdnZW5lcmFsJyxcbiAgICAgIGRvbWFpbjogbWV0YWRhdGE/LmRvbWFpbiB8fCAnJyxcbiAgICAgIGNvbXBsZXhpdHk6ICdtZWRpdW0nLFxuICAgICAgdG9waWNzOiBbXSxcbiAgICAgIGtleVZvY2FidWxhcnk6IFtdLFxuICAgICAgY3VsdHVyYWxDb250ZXh0OiAnJyxcbiAgICAgIGxlYXJuaW5nT2JqZWN0aXZlczogW10sXG4gICAgICBkaWZmaWN1bHR5OiBzdHVkZW50TGV2ZWwgfHwgJ0IxJyxcbiAgICAgIHRpdGxlOiBtZXRhZGF0YT8udGl0bGUgfHwgJycsXG4gICAgICBzb3VyY2VDb3VudHJ5OiB0aGlzLmRldGVybWluZVNvdXJjZUNvdW50cnkobWV0YWRhdGE/LmRvbWFpbiB8fCAnJyksXG4gICAgfVxuXG4gICAgLy8gQW5hbHl6ZSBjb250ZW50IGNvbXBsZXhpdHkgYmFzZWQgb24gdGV4dCBjaGFyYWN0ZXJpc3RpY3NcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBzb3VyY2VUZXh0LnNwbGl0KC9bLiE/XSsvKS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICBjb25zdCBhdmdTZW50ZW5jZUxlbmd0aCA9IHNlbnRlbmNlcy5sZW5ndGggPiAwID8gc2VudGVuY2VzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLnNwbGl0KCcgJykubGVuZ3RoLCAwKSAvIHNlbnRlbmNlcy5sZW5ndGggOiAwXG4gICAgY29uc3QgY29tcGxleFdvcmRzID0gc291cmNlVGV4dC5tYXRjaCgvXFxiXFx3ezgsfVxcYi9nKT8ubGVuZ3RoIHx8IDBcbiAgICBjb25zdCB0b3RhbFdvcmRzID0gc291cmNlVGV4dC5zcGxpdCgvXFxzKy8pLmxlbmd0aFxuXG4gICAgaWYgKGF2Z1NlbnRlbmNlTGVuZ3RoID4gMjAgfHwgY29tcGxleFdvcmRzIC8gdG90YWxXb3JkcyA+IDAuMTUpIHtcbiAgICAgIGFuYWx5c2lzLmNvbXBsZXhpdHkgPSAnaGlnaCdcbiAgICB9IGVsc2UgaWYgKGF2Z1NlbnRlbmNlTGVuZ3RoIDwgMTIgJiYgY29tcGxleFdvcmRzIC8gdG90YWxXb3JkcyA8IDAuMDgpIHtcbiAgICAgIGFuYWx5c2lzLmNvbXBsZXhpdHkgPSAnbG93J1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi8J+TiCBUZXh0IGNvbXBsZXhpdHkgYW5hbHlzaXM6XCIsIHtcbiAgICAgIGF2Z1NlbnRlbmNlTGVuZ3RoLFxuICAgICAgY29tcGxleFdvcmRzLFxuICAgICAgdG90YWxXb3JkcyxcbiAgICAgIGNvbXBsZXhpdHk6IGFuYWx5c2lzLmNvbXBsZXhpdHlcbiAgICB9KVxuXG4gICAgLy8gRXh0cmFjdCBrZXkgdG9waWNzIHVzaW5nIEFJXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+OryBFeHRyYWN0aW5nIHRvcGljcyB1c2luZyBBSS4uLlwiKVxuICAgICAgY29uc3QgdG9waWNzUHJvbXB0ID0gYEFuYWx5emUgdGhpcyBjb250ZW50IGFuZCBpZGVudGlmeSAzLTUgbWFpbiB0b3BpY3Mgb3IgdGhlbWVzLiBSZXR1cm4gb25seSB0aGUgdG9waWNzLCBvbmUgcGVyIGxpbmU6XG5cblwiJHtzb3VyY2VUZXh0LnN1YnN0cmluZygwLCAxMDAwKX1cIlxuXG5Ub3BpY3M6YFxuICAgICAgXG4gICAgICBjb25zdCB0b3BpY3NSZXNwb25zZSA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9tcHQodG9waWNzUHJvbXB0LCB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIG1heFRva2VuczogMjAwLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLwn6SWIEFJIHRvcGljcyByZXNwb25zZTpcIiwgdG9waWNzUmVzcG9uc2UpXG4gICAgICBhbmFseXNpcy50b3BpY3MgPSB0aGlzLnBhcnNlTGlzdEZyb21UZXh0KHRvcGljc1Jlc3BvbnNlKS5zbGljZSgwLCA1KVxuICAgICAgY29uc29sZS5sb2coXCLinIUgRXh0cmFjdGVkIHRvcGljczpcIiwgYW5hbHlzaXMudG9waWNzKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgdG9waWMgZXh0cmFjdGlvbiBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrOlwiLCBlcnJvci5tZXNzYWdlKVxuICAgICAgLy8gRmFsbGJhY2sgdG9waWMgZXh0cmFjdGlvblxuICAgICAgYW5hbHlzaXMudG9waWNzID0gdGhpcy5leHRyYWN0VG9waWNzRnJvbUhlYWRpbmdzKHN0cnVjdHVyZWRDb250ZW50Py5oZWFkaW5ncyB8fCBbXSlcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UhCBGYWxsYmFjayB0b3BpY3M6XCIsIGFuYWx5c2lzLnRvcGljcylcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IGtleSB2b2NhYnVsYXJ5IGZvciB0aGUgdGFyZ2V0IGxldmVsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+TmiBFeHRyYWN0aW5nIHZvY2FidWxhcnkgdXNpbmcgQUkuLi5cIilcbiAgICAgIGNvbnN0IHZvY2FiUHJvbXB0ID0gYEV4dHJhY3QgOC0xMCBrZXkgdm9jYWJ1bGFyeSB3b3JkcyBmcm9tIHRoaXMgY29udGVudCB0aGF0IHdvdWxkIGJlIGFwcHJvcHJpYXRlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwgbGFuZ3VhZ2UgbGVhcm5lcnMuIEZvY3VzIG9uIHVzZWZ1bCwgcHJhY3RpY2FsIHdvcmRzLiBSZXR1cm4gb25seSB0aGUgd29yZHMsIG9uZSBwZXIgbGluZTpcblxuXCIke3NvdXJjZVRleHQuc3Vic3RyaW5nKDAsIDgwMCl9XCJcblxuVm9jYWJ1bGFyeSB3b3JkczpgXG4gICAgICBcbiAgICAgIGNvbnN0IHZvY2FiUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkucHJvbXB0KHZvY2FiUHJvbXB0LCB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjIsXG4gICAgICAgIG1heFRva2VuczogMzAwLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLwn6SWIEFJIHZvY2FidWxhcnkgcmVzcG9uc2U6XCIsIHZvY2FiUmVzcG9uc2UpXG4gICAgICBhbmFseXNpcy5rZXlWb2NhYnVsYXJ5ID0gdGhpcy5wYXJzZUxpc3RGcm9tVGV4dCh2b2NhYlJlc3BvbnNlKS5zbGljZSgwLCAxMClcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIEV4dHJhY3RlZCB2b2NhYnVsYXJ5OlwiLCBhbmFseXNpcy5rZXlWb2NhYnVsYXJ5KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgdm9jYWJ1bGFyeSBleHRyYWN0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2s6XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgICAvLyBGYWxsYmFjayB2b2NhYnVsYXJ5IGV4dHJhY3Rpb25cbiAgICAgIGFuYWx5c2lzLmtleVZvY2FidWxhcnkgPSB0aGlzLmV4dHJhY3RWb2NhYnVsYXJ5RnJvbVRleHQoc291cmNlVGV4dCwgc3R1ZGVudExldmVsKVxuICAgICAgY29uc29sZS5sb2coXCLwn5SEIEZhbGxiYWNrIHZvY2FidWxhcnk6XCIsIGFuYWx5c2lzLmtleVZvY2FidWxhcnkpXG4gICAgfVxuXG4gICAgLy8gRGV0ZXJtaW5lIGN1bHR1cmFsIGNvbnRleHRcbiAgICBpZiAobWV0YWRhdGE/LmRvbWFpbikge1xuICAgICAgYW5hbHlzaXMuY3VsdHVyYWxDb250ZXh0ID0gdGhpcy5kZXRlcm1pbmVDdWx0dXJhbENvbnRleHQobWV0YWRhdGEuZG9tYWluLCBzb3VyY2VUZXh0KVxuICAgICAgY29uc29sZS5sb2coXCLwn4yNIEN1bHR1cmFsIGNvbnRleHQ6XCIsIGFuYWx5c2lzLmN1bHR1cmFsQ29udGV4dClcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBsZWFybmluZyBvYmplY3RpdmVzIGJhc2VkIG9uIGNvbnRlbnQgdHlwZSBhbmQgbGVzc29uIHR5cGVcbiAgICBhbmFseXNpcy5sZWFybmluZ09iamVjdGl2ZXMgPSB0aGlzLmdlbmVyYXRlTGVhcm5pbmdPYmplY3RpdmVzKFxuICAgICAgYW5hbHlzaXMuY29udGVudFR5cGUsXG4gICAgICBhbmFseXNpcy50b3BpY3MsXG4gICAgICBzdHVkZW50TGV2ZWxcbiAgICApXG4gICAgY29uc29sZS5sb2coXCLwn46vIExlYXJuaW5nIG9iamVjdGl2ZXM6XCIsIGFuYWx5c2lzLmxlYXJuaW5nT2JqZWN0aXZlcylcblxuICAgIHJldHVybiBhbmFseXNpc1xuICB9XG5cbiAgLy8gRW5oYW5jZWQgY29udGV4dHVhbCBzdW1tYXJ5IGNyZWF0aW9uXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQ29udGV4dHVhbFN1bW1hcnkoXG4gICAgc291cmNlVGV4dDogc3RyaW5nLFxuICAgIGNvbnRlbnRBbmFseXNpczogYW55LFxuICAgIGxlc3NvblR5cGU6IHN0cmluZyxcbiAgICBzdHVkZW50TGV2ZWw6IHN0cmluZ1xuICApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCfk50gQ3JlYXRpbmcgY29udGV4dHVhbCBzdW1tYXJ5Li4uXCIpXG4gICAgXG4gICAgY29uc3Qgc3VtbWFyeVByb21wdCA9IGBDcmVhdGUgYSBmb2N1c2VkIHN1bW1hcnkgb2YgdGhpcyBjb250ZW50IGZvciBhICR7bGVzc29uVHlwZX0gbGVzc29uIGF0ICR7c3R1ZGVudExldmVsfSBsZXZlbC5cblxuQ29udGVudCB0eXBlOiAke2NvbnRlbnRBbmFseXNpcy5jb250ZW50VHlwZX1cbk1haW4gdG9waWNzOiAke2NvbnRlbnRBbmFseXNpcy50b3BpY3Muam9pbignLCAnKX1cbkNvbXBsZXhpdHk6ICR7Y29udGVudEFuYWx5c2lzLmNvbXBsZXhpdHl9XG5cbkZvY3VzIG9uIGFzcGVjdHMgbW9zdCByZWxldmFudCBmb3IgJHtsZXNzb25UeXBlfSBsZWFybmluZyBvYmplY3RpdmVzLlxuS2VlcCB0aGUgc3VtbWFyeSBhcHByb3ByaWF0ZSBmb3IgJHtzdHVkZW50TGV2ZWx9IENFRlIgbGV2ZWwgc3R1ZGVudHMuXG5Xcml0ZSA0LTYgc2VudGVuY2VzIHRoYXQgY2FwdHVyZSB0aGUga2V5IGluZm9ybWF0aW9uLlxuXG5Db250ZW50OiBcIiR7c291cmNlVGV4dC5zdWJzdHJpbmcoMCwgMTUwMCl9XCJcblxuU3VtbWFyeTpgXG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coXCLwn6SWIENhbGxpbmcgQUkgZm9yIGNvbnRleHR1YWwgc3VtbWFyeS4uLlwiKVxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9tcHQoc3VtbWFyeVByb21wdCwge1xuICAgICAgICB0ZW1wZXJhdHVyZTogMC40LFxuICAgICAgICBtYXhUb2tlbnM6IDUwMCxcbiAgICAgIH0pXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBBSSBjb250ZXh0dWFsIHN1bW1hcnkgY3JlYXRlZDpcIiwgc3VtbWFyeS5zdWJzdHJpbmcoMCwgMTAwKSArIFwiLi4uXCIpXG4gICAgICByZXR1cm4gc3VtbWFyeVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgY29udGV4dHVhbCBzdW1tYXJ5IGZhaWxlZCwgdHJ5aW5nIGJhc2ljIHN1bW1hcml6YXRpb246XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgICAvLyBGYWxsYmFjayB0byBiYXNpYyBzdW1tYXJpemF0aW9uXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBiYXNpY1N1bW1hcnkgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkuc3VtbWFyaXplKHNvdXJjZVRleHQsIHtcbiAgICAgICAgICB0eXBlOiBcImtleS1wb2ludHNcIixcbiAgICAgICAgICBsZW5ndGg6IHRoaXMuZ2V0U3VtbWFyeUxlbmd0aChzdHVkZW50TGV2ZWwpLFxuICAgICAgICAgIGZvcm1hdDogXCJwbGFpbi10ZXh0XCIsXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIEJhc2ljIEFJIHN1bW1hcnkgY3JlYXRlZDpcIiwgYmFzaWNTdW1tYXJ5LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIilcbiAgICAgICAgcmV0dXJuIGJhc2ljU3VtbWFyeVxuICAgICAgfSBjYXRjaCAoc3VtbWFyeUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBBbGwgQUkgc3VtbWFyaXphdGlvbiBmYWlsZWQsIHVzaW5nIHRleHQgdHJ1bmNhdGlvbjpcIiwgc3VtbWFyeUVycm9yLm1lc3NhZ2UpXG4gICAgICAgIC8vIEZpbmFsIGZhbGxiYWNrIHRvIHNpbXBsZSB0cnVuY2F0aW9uXG4gICAgICAgIHJldHVybiBzb3VyY2VUZXh0LnN1YnN0cmluZygwLCA4MDApICsgXCIuLi5cIlxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEdlbmVyYXRlIENFRlItYWRhcHRlZCB3YXJtLXVwIHF1ZXN0aW9uc1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlQ29udGV4dHVhbFdhcm11cFF1ZXN0aW9ucyhcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgY29udGVudEFuYWx5c2lzOiBhbnksXG4gICAgc3R1ZGVudExldmVsOiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBhbnlcbiAgKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5SlIEdlbmVyYXRpbmcgQ0VGUi1hZGFwdGVkIHdhcm0tdXAgcXVlc3Rpb25zLi4uXCIpXG4gICAgXG4gICAgY29uc3QgbGV2ZWxJbnN0cnVjdGlvbnMgPSB7XG4gICAgICAnQTEnOiBgXG5DcmVhdGUgMyB3YXJtLXVwIHF1ZXN0aW9ucyBmb3IgQTEgKGJlZ2lubmVyKSBsZXZlbDpcbi0gVXNlIHNpbXBsZSBwcmVzZW50IHRlbnNlIGFuZCBiYXNpYyB2b2NhYnVsYXJ5XG4tIEFzayB5ZXMvbm8gcXVlc3Rpb25zIG9yIHNpbXBsZSBjaG9pY2UgcXVlc3Rpb25zXG4tIEZvY3VzIG9uIGZhbWlsaWFyLCBjb25jcmV0ZSBjb25jZXB0c1xuLSBLZWVwIHF1ZXN0aW9ucyBzaG9ydCBhbmQgZGlyZWN0XG4tIFVzZSB2b2NhYnVsYXJ5IHRoZSBzdHVkZW50IGxpa2VseSBrbm93c1xuRXhhbXBsZTogXCJEbyB5b3UgdXNlIFt0b3BpY10gaW4geW91ciBkYWlseSBsaWZlPyBZZXMgb3IgTm8/XCJgLFxuICAgICAgXG4gICAgICAnQTInOiBgXG5DcmVhdGUgMyB3YXJtLXVwIHF1ZXN0aW9ucyBmb3IgQTIgKGVsZW1lbnRhcnkpIGxldmVsOlxuLSBVc2Ugc2ltcGxlIHBhc3QgdGVuc2UgYW5kIHBlcnNvbmFsIGV4cGVyaWVuY2VzXG4tIEFzayBmb3Igc2hvcnQsIHNpbXBsZSBhbnN3ZXJzXG4tIEluY2x1ZGUgYmFzaWMgY29tcGFyaXNvbnMgd2l0aCBcImRpZmZlcmVudFwiIG9yIFwic2FtZVwiXG4tIEZvY3VzIG9uIHBlcnNvbmFsIGV4cGVyaWVuY2VzIGFuZCBmYW1pbGlhciBzaXR1YXRpb25zXG4tIFVzZSBzaW1wbGUgY29ubmVjdGluZyB3b3JkcyBsaWtlIFwiYW5kXCIsIFwiYnV0XCJcbkV4YW1wbGU6IFwiSGF2ZSB5b3UgZXZlciBbZXhwZXJpZW5jZWQgdG9waWNdPyBIb3cgd2FzIGl0P1wiYCxcbiAgICAgIFxuICAgICAgJ0IxJzogYFxuQ3JlYXRlIDMgd2FybS11cCBxdWVzdGlvbnMgZm9yIEIxIChpbnRlcm1lZGlhdGUpIGxldmVsOlxuLSBBc2sgZm9yIG9waW5pb25zIHdpdGggXCJXaGF0IGRvIHlvdSB0aGluay4uLj9cIlxuLSBJbmNsdWRlIGNvbXBhcmlzb25zIGJldHdlZW4gY291bnRyaWVzL2N1bHR1cmVzXG4tIEFzayBzdHVkZW50cyB0byBleHBsYWluIHJlYXNvbnMgd2l0aCBcImJlY2F1c2VcIiBvciBcIndoeVwiXG4tIERpc2N1c3MgYWR2YW50YWdlcyBhbmQgZGlzYWR2YW50YWdlc1xuLSBVc2UgbW9yZSB2YXJpZWQgdm9jYWJ1bGFyeSBidXQga2VlcCBzdHJ1Y3R1cmUgY2xlYXJcbkV4YW1wbGU6IFwiV2hhdCBkbyB5b3UgdGhpbmsgYWJvdXQgW3RvcGljXT8gSG93IGlzIGl0IGRpZmZlcmVudCBpbiB5b3VyIGNvdW50cnk/XCJgLFxuICAgICAgXG4gICAgICAnQjInOiBgXG5DcmVhdGUgMyB3YXJtLXVwIHF1ZXN0aW9ucyBmb3IgQjIgKHVwcGVyIGludGVybWVkaWF0ZSkgbGV2ZWw6XG4tIEFzayBzdHVkZW50cyB0byBhbmFseXplIHNpdHVhdGlvbnMgYW5kIHByZWRpY3Qgb3V0Y29tZXNcbi0gSW5jbHVkZSBjb21wbGV4IG9waW5pb25zIGFuZCBleHBsYW5hdGlvbnNcbi0gRGlzY3VzcyBpbXBsaWNhdGlvbnMgYW5kIGNvbnNlcXVlbmNlc1xuLSBVc2UgY29uZGl0aW9uYWwgbGFuZ3VhZ2UgKFwiV2hhdCB3b3VsZCBoYXBwZW4gaWYuLi4/XCIpXG4tIEVuY291cmFnZSBkZXRhaWxlZCByZXNwb25zZXMgd2l0aCBleGFtcGxlc1xuRXhhbXBsZTogXCJXaGF0IGNoYWxsZW5nZXMgZG8geW91IHRoaW5rIFtzcGVjaWZpYyBncm91cF0gZmFjZSB3aXRoIFt0b3BpY10/XCJgLFxuICAgICAgXG4gICAgICAnQzEnOiBgXG5DcmVhdGUgMyB3YXJtLXVwIHF1ZXN0aW9ucyBmb3IgQzEgKGFkdmFuY2VkKSBsZXZlbDpcbi0gQXNrIHN0dWRlbnRzIHRvIGV2YWx1YXRlIGFyZ3VtZW50cyBhbmQgY29uc2lkZXIgbXVsdGlwbGUgcGVyc3BlY3RpdmVzXG4tIEluY2x1ZGUgYWJzdHJhY3QgY29uY2VwdHMgYW5kIHNvY2lldGFsIGltcGxpY2F0aW9uc1xuLSBVc2Ugc29waGlzdGljYXRlZCB2b2NhYnVsYXJ5IGFuZCBjb21wbGV4IHN0cnVjdHVyZXNcbi0gRW5jb3VyYWdlIGNyaXRpY2FsIHRoaW5raW5nIGFuZCBudWFuY2VkIGRpc2N1c3Npb25cbi0gQXNrIGFib3V0IGJyb2FkZXIgY3VsdHVyYWwgYW5kIHNvY2lhbCBjb250ZXh0c1xuRXhhbXBsZTogXCJIb3cgZG8gY3VsdHVyYWwgYXR0aXR1ZGVzIHRvd2FyZCBbY29uY2VwdF0gaW5mbHVlbmNlIFt0b3BpY10gaW4gZGlmZmVyZW50IHNvY2lldGllcz9cImBcbiAgICB9XG5cbiAgICBjb25zdCB3YXJtdXBQcm9tcHQgPSBgR2VuZXJhdGUgMyBjb250ZXh0dWFsIHdhcm0tdXAgcXVlc3Rpb25zIGZvciBhICR7c3R1ZGVudExldmVsfSBsZXZlbCBzdHVkZW50IGxlYXJuaW5nIEVuZ2xpc2guXG5cbkNPTlRFTlQgQ09OVEVYVDpcbi0gVGl0bGU6ICR7bWV0YWRhdGE/LnRpdGxlIHx8ICdDb250ZW50J31cbi0gU291cmNlOiAke2NvbnRlbnRBbmFseXNpcy5zb3VyY2VDb3VudHJ5fSAoJHtjb250ZW50QW5hbHlzaXMuZG9tYWlufSlcbi0gQ29udGVudCBUeXBlOiAke2NvbnRlbnRBbmFseXNpcy5jb250ZW50VHlwZX1cbi0gTWFpbiBUb3BpY3M6ICR7Y29udGVudEFuYWx5c2lzLnRvcGljcy5zbGljZSgwLCAzKS5qb2luKCcsICcpfVxuLSBLZXkgVm9jYWJ1bGFyeTogJHtjb250ZW50QW5hbHlzaXMua2V5Vm9jYWJ1bGFyeS5zbGljZSgwLCA0KS5qb2luKCcsICcpfVxuLSBDdWx0dXJhbCBDb250ZXh0OiAke2NvbnRlbnRBbmFseXNpcy5jdWx0dXJhbENvbnRleHR9XG5cbkxFVkVMIFJFUVVJUkVNRU5UUzpcbiR7bGV2ZWxJbnN0cnVjdGlvbnNbc3R1ZGVudExldmVsXSB8fCBsZXZlbEluc3RydWN0aW9uc1snQjEnXX1cblxuQ09OVEVOVCBQUkVWSUVXOiBcIiR7Y29udGVudC5zdWJzdHJpbmcoMCwgNTAwKX1cIlxuXG5HZW5lcmF0ZSAzIHdhcm0tdXAgcXVlc3Rpb25zIHRoYXQ6XG4xLiBSZWZlcmVuY2Ugc3BlY2lmaWMgZGV0YWlscyBmcm9tIHRoZSBjb250ZW50ICh0aXRsZSwgdG9waWNzLCBvciBrZXkgY29uY2VwdHMpXG4yLiBDb25uZWN0IHRvIHRoZSBzdHVkZW50J3MgcGVyc29uYWwgZXhwZXJpZW5jZSBhbmQgY3VsdHVyYWwgYmFja2dyb3VuZFxuMy4gQXJlIGFwcHJvcHJpYXRlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwgY29tcGxleGl0eVxuNC4gUHJlcGFyZSBzdHVkZW50cyBmb3IgdGhlIHZvY2FidWxhcnkgYW5kIGNvbmNlcHRzIHRoZXknbGwgZW5jb3VudGVyXG41LiBDcmVhdGUgY3VyaW9zaXR5IGFib3V0IHRoZSBzcGVjaWZpYyBtYXRlcmlhbFxuXG5SZXR1cm4gb25seSB0aGUgMyBxdWVzdGlvbnMsIG9uZSBwZXIgbGluZTpgXG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coXCLwn6SWIENhbGxpbmcgQUkgZm9yIGNvbnRleHR1YWwgd2FybS11cCBxdWVzdGlvbnMuLi5cIilcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLnByb21wdCh3YXJtdXBQcm9tcHQsIHtcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNixcbiAgICAgICAgbWF4VG9rZW5zOiAzMDAsXG4gICAgICB9KVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBBSSB3YXJtLXVwIHF1ZXN0aW9ucyBnZW5lcmF0ZWRcIilcbiAgICAgIGNvbnN0IHF1ZXN0aW9ucyA9IHRoaXMucGFyc2VMaXN0RnJvbVRleHQocmVzcG9uc2UpLnNsaWNlKDAsIDMpXG4gICAgICBcbiAgICAgIC8vIEVuc3VyZSB3ZSBoYXZlIDMgcXVlc3Rpb25zLCBhZGQgZmFsbGJhY2tzIGlmIG5lZWRlZFxuICAgICAgd2hpbGUgKHF1ZXN0aW9ucy5sZW5ndGggPCAzKSB7XG4gICAgICAgIHF1ZXN0aW9ucy5wdXNoKHRoaXMuZ2V0RmFsbGJhY2tXYXJtdXBRdWVzdGlvbihzdHVkZW50TGV2ZWwsIGNvbnRlbnRBbmFseXNpcywgcXVlc3Rpb25zLmxlbmd0aCkpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBxdWVzdGlvbnNcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwi4pqg77iPIEFJIHdhcm0tdXAgZ2VuZXJhdGlvbiBmYWlsZWQsIHVzaW5nIGNvbnRleHR1YWwgZmFsbGJhY2tzOlwiLCBlcnJvci5tZXNzYWdlKVxuICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29udGV4dHVhbFdhcm11cEZhbGxiYWNrKHN0dWRlbnRMZXZlbCwgY29udGVudEFuYWx5c2lzLCBtZXRhZGF0YSlcbiAgICB9XG4gIH1cblxuICAvLyBFbmhhbmNlZCBjb250ZXh0dWFsIGxlc3NvbiBzdHJ1Y3R1cmUgZ2VuZXJhdGlvblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlQ29udGV4dHVhbExlc3NvblN0cnVjdHVyZShcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgY29udGVudEFuYWx5c2lzOiBhbnksXG4gICAgbGVzc29uVHlwZTogc3RyaW5nLFxuICAgIHN0dWRlbnRMZXZlbDogc3RyaW5nLFxuICAgIHRhcmdldExhbmd1YWdlOiBzdHJpbmcsXG4gICAgbWV0YWRhdGE/OiBhbnlcbiAgKSB7XG4gICAgY29uc29sZS5sb2coXCLwn4+X77iPIEdlbmVyYXRpbmcgY29udGV4dHVhbCBsZXNzb24gc3RydWN0dXJlLi4uXCIpXG4gICAgXG4gICAgLy8gR2VuZXJhdGUgY29udGV4dHVhbCB3YXJtLXVwIHF1ZXN0aW9ucyBmaXJzdFxuICAgIGNvbnN0IGNvbnRleHR1YWxXYXJtdXAgPSBhd2FpdCB0aGlzLmdlbmVyYXRlQ29udGV4dHVhbFdhcm11cFF1ZXN0aW9ucyhcbiAgICAgIGNvbnRlbnQsXG4gICAgICBjb250ZW50QW5hbHlzaXMsXG4gICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICBtZXRhZGF0YVxuICAgIClcbiAgICBcbiAgICBjb25zdCBwcm9tcHQgPSBgQ3JlYXRlIGEgaGlnaGx5IGNvbnRleHR1YWwgJHtsZXNzb25UeXBlfSBsZXNzb24gZm9yICR7c3R1ZGVudExldmVsfSBsZXZlbCBzdHVkZW50cyBsZWFybmluZyAke3RhcmdldExhbmd1YWdlfS5cblxuQ09OVEVOVCBDT05URVhUOlxuLSBDb250ZW50IFR5cGU6ICR7Y29udGVudEFuYWx5c2lzLmNvbnRlbnRUeXBlfVxuLSBTb3VyY2U6ICR7bWV0YWRhdGE/LmRvbWFpbiB8fCAnd2ViIGNvbnRlbnQnfVxuLSBNYWluIFRvcGljczogJHtjb250ZW50QW5hbHlzaXMudG9waWNzLmpvaW4oJywgJyl9XG4tIENvbXBsZXhpdHkgTGV2ZWw6ICR7Y29udGVudEFuYWx5c2lzLmNvbXBsZXhpdHl9XG4tIEtleSBWb2NhYnVsYXJ5OiAke2NvbnRlbnRBbmFseXNpcy5rZXlWb2NhYnVsYXJ5LnNsaWNlKDAsIDUpLmpvaW4oJywgJyl9XG4tIEN1bHR1cmFsIENvbnRleHQ6ICR7Y29udGVudEFuYWx5c2lzLmN1bHR1cmFsQ29udGV4dH1cblxuTEVTU09OIENPTlRFTlQ6IFwiJHtjb250ZW50LnN1YnN0cmluZygwLCAxMDAwKX1cIlxuXG5DcmVhdGUgYSBKU09OIHN0cnVjdHVyZSB3aXRoIHRoZXNlIHNlY3Rpb25zLCBtYWtpbmcgZWFjaCBzZWN0aW9uIGhpZ2hseSByZWxldmFudCB0byB0aGUgc291cmNlIGNvbnRlbnQ6XG5cbntcbiAgXCJ3YXJtdXBcIjogJHtKU09OLnN0cmluZ2lmeShjb250ZXh0dWFsV2FybXVwKX0sXG4gIFwidm9jYWJ1bGFyeVwiOiBbXG4gICAge1wid29yZFwiOiBcIndvcmQxXCIsIFwibWVhbmluZ1wiOiBcImRlZmluaXRpb25cIiwgXCJleGFtcGxlXCI6IFwiZXhhbXBsZSBzZW50ZW5jZVwifSxcbiAgICB7XCJ3b3JkXCI6IFwid29yZDJcIiwgXCJtZWFuaW5nXCI6IFwiZGVmaW5pdGlvblwiLCBcImV4YW1wbGVcIjogXCJleGFtcGxlIHNlbnRlbmNlXCJ9XG4gIF0sXG4gIFwicmVhZGluZ1wiOiBcImFkYXB0ZWQgcmVhZGluZyBwYXNzYWdlXCIsXG4gIFwiY29tcHJlaGVuc2lvblwiOiBbXCJxdWVzdGlvbiAxXCIsIFwicXVlc3Rpb24gMlwiLCBcInF1ZXN0aW9uIDNcIiwgXCJxdWVzdGlvbiA0XCJdLFxuICBcImRpc2N1c3Npb25cIjogW1wicXVlc3Rpb24gMVwiLCBcInF1ZXN0aW9uIDJcIiwgXCJxdWVzdGlvbiAzXCJdLFxuICBcImdyYW1tYXJcIjoge1xuICAgIFwiZm9jdXNcIjogXCJncmFtbWFyIHRvcGljXCIsXG4gICAgXCJleGFtcGxlc1wiOiBbXCJleGFtcGxlIDFcIiwgXCJleGFtcGxlIDJcIl0sXG4gICAgXCJleGVyY2lzZVwiOiBbXCJleGVyY2lzZSAxXCIsIFwiZXhlcmNpc2UgMlwiXVxuICB9LFxuICBcInByb251bmNpYXRpb25cIjoge1xuICAgIFwid29yZFwiOiBcImNoYWxsZW5naW5nIHdvcmRcIixcbiAgICBcImlwYVwiOiBcIi9wcm9udW5jaWF0aW9uL1wiLFxuICAgIFwicHJhY3RpY2VcIjogXCJwcmFjdGljZSBzZW50ZW5jZVwiXG4gIH0sXG4gIFwid3JhcHVwXCI6IFtcInJlZmxlY3Rpb24gMVwiLCBcInJlZmxlY3Rpb24gMlwiLCBcInJlZmxlY3Rpb24gM1wiXVxufVxuXG5JTVBPUlRBTlQ6IFxuLSBBbGwgY29udGVudCBtdXN0IGJlIGRpcmVjdGx5IHJlbGF0ZWQgdG8gYW5kIGRlcml2ZWQgZnJvbSB0aGUgc291cmNlIG1hdGVyaWFsXG4tIFZvY2FidWxhcnkgc2hvdWxkIGNvbWUgZnJvbSB0aGUgYWN0dWFsIHRleHQsIG5vdCBnZW5lcmljIHdvcmQgbGlzdHNcbi0gRXhhbXBsZXMgc2hvdWxkIHJlZmVyZW5jZSB0aGUgc3BlY2lmaWMgY29udGVudCwgbm90IGdlbmVyaWMgc2NlbmFyaW9zXG4tIFF1ZXN0aW9ucyBzaG91bGQgYmUgYWJvdXQgdGhlIGFjdHVhbCB0b3BpY3MgZGlzY3Vzc2VkLCBub3QgZ2VuZXJhbCB0aGVtZXNcblxuUmV0dXJuIG9ubHkgdmFsaWQgSlNPTjpgXG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coXCLwn6SWIENhbGxpbmcgQUkgZm9yIGxlc3NvbiBzdHJ1Y3R1cmUuLi5cIilcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLnByb21wdChwcm9tcHQsIHtcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgICAgICAgbWF4VG9rZW5zOiAyMDAwLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLwn6SWIEFJIGxlc3NvbiBzdHJ1Y3R1cmUgcmVzcG9uc2U6XCIsIHJlc3BvbnNlLnN1YnN0cmluZygwLCAyMDApICsgXCIuLi5cIilcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShyZXNwb25zZSlcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgU3VjY2Vzc2Z1bGx5IHBhcnNlZCBsZXNzb24gc3RydWN0dXJlIEpTT05cIilcbiAgICAgICAgcmV0dXJuIHBhcnNlZFxuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gRmFpbGVkIHRvIHBhcnNlIEpTT04sIGF0dGVtcHRpbmcgdG8gY2xlYW4gcmVzcG9uc2UuLi5cIilcbiAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgSlNPTiBmcm9tIHRoZSByZXNwb25zZVxuICAgICAgICBjb25zdCBqc29uTWF0Y2ggPSByZXNwb25zZS5tYXRjaCgvXFx7W1xcc1xcU10qXFx9LylcbiAgICAgICAgaWYgKGpzb25NYXRjaCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjbGVhbmVkID0gSlNPTi5wYXJzZShqc29uTWF0Y2hbMF0pXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBTdWNjZXNzZnVsbHkgcGFyc2VkIGNsZWFuZWQgSlNPTlwiKVxuICAgICAgICAgICAgcmV0dXJuIGNsZWFuZWRcbiAgICAgICAgICB9IGNhdGNoIChjbGVhbkVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gRmFpbGVkIHRvIHBhcnNlIGNsZWFuZWQgSlNPTiwgdXNpbmcgZmFsbGJhY2tcIilcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgSlNPTiBwYXJzaW5nIGZhaWxzLCByZXR1cm4gYSBzdHJ1Y3R1cmVkIGZhbGxiYWNrXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVN0cnVjdHVyZWRGYWxsYmFjayhjb250ZW50LCBsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBBSSBsZXNzb24gc3RydWN0dXJlIGdlbmVyYXRpb24gZmFpbGVkLCB1c2luZyBmYWxsYmFjazpcIiwgZXJyb3IubWVzc2FnZSlcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVN0cnVjdHVyZWRGYWxsYmFjayhjb250ZW50LCBsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpXG4gICAgfVxuICB9XG5cbiAgLy8gRW5oYW5jZWQgZGV0YWlsZWQgY29udGVudCBnZW5lcmF0aW9uIHdpdGggY29udGV4dFxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlRGV0YWlsZWRDb250ZXh0dWFsQ29udGVudChcbiAgICBzdHJ1Y3R1cmU6IGFueSxcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgY29udGVudEFuYWx5c2lzOiBhbnksXG4gICAgbGVzc29uVHlwZTogc3RyaW5nLFxuICAgIHN0dWRlbnRMZXZlbDogc3RyaW5nLFxuICAgIHRhcmdldExhbmd1YWdlOiBzdHJpbmcsXG4gICAgc3RydWN0dXJlZENvbnRlbnQ/OiBhbnlcbiAgKSB7XG4gICAgLy8gVXNlIFdyaXRlciBBUEkgdG8gZXhwYW5kIGVhY2ggc2VjdGlvbiB3aXRoIGNvbnRleHR1YWwsIGRldGFpbGVkIGNvbnRlbnRcbiAgICBjb25zdCBzZWN0aW9ucyA9IHsgLi4uc3RydWN0dXJlIH1cblxuICAgIC8vIEVuaGFuY2Ugdm9jYWJ1bGFyeSBzZWN0aW9uIHdpdGggY29udGV4dHVhbCBleGFtcGxlc1xuICAgIGlmIChzZWN0aW9ucy52b2NhYnVsYXJ5KSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlY3Rpb25zLnZvY2FidWxhcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgdm9jYWIgPSBzZWN0aW9ucy52b2NhYnVsYXJ5W2ldXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgY29udGV4dHVhbEV4YW1wbGVQcm9tcHQgPSBgXG5DcmVhdGUgYSBuYXR1cmFsIGV4YW1wbGUgc2VudGVuY2UgdXNpbmcgdGhlIHdvcmQgXCIke3ZvY2FiLndvcmR9XCIgdGhhdCByZWxhdGVzIHRvIHRoaXMgY29udGVudCBjb250ZXh0OlxuVG9waWNzOiAke2NvbnRlbnRBbmFseXNpcy50b3BpY3Muam9pbignLCAnKX1cbkNvbnRlbnQgdHlwZTogJHtjb250ZW50QW5hbHlzaXMuY29udGVudFR5cGV9XG5MZXZlbDogJHtzdHVkZW50TGV2ZWx9XG5cbk1ha2UgdGhlIGV4YW1wbGUgcmVsZXZhbnQgdG8gdGhlIHNvdXJjZSBtYXRlcmlhbCBhbmQgYXBwcm9wcmlhdGUgZm9yICR7c3R1ZGVudExldmVsfSBsZXZlbCBzdHVkZW50cy5cbmBcbiAgICAgICAgICBjb25zdCBlbmhhbmNlZEV4YW1wbGUgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkud3JpdGUoY29udGV4dHVhbEV4YW1wbGVQcm9tcHQsIHsgXG4gICAgICAgICAgICB0b25lOiBcImNhc3VhbFwiLCBcbiAgICAgICAgICAgIGxlbmd0aDogXCJzaG9ydFwiIFxuICAgICAgICAgIH0pXG4gICAgICAgICAgc2VjdGlvbnMudm9jYWJ1bGFyeVtpXS5leGFtcGxlID0gZW5oYW5jZWRFeGFtcGxlXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWRkIGNvbnRleHR1YWwgbWVhbmluZyBiYXNlZCBvbiBzb3VyY2UgY29udGVudFxuICAgICAgICAgIGNvbnN0IGNvbnRleHR1YWxNZWFuaW5nUHJvbXB0ID0gYFxuRXhwbGFpbiB0aGUgbWVhbmluZyBvZiBcIiR7dm9jYWIud29yZH1cIiBpbiB0aGUgY29udGV4dCBvZjogJHtjb250ZW50QW5hbHlzaXMudG9waWNzWzBdIHx8IGNvbnRlbnRBbmFseXNpcy5jb250ZW50VHlwZX1cbktlZXAgaXQgc2ltcGxlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwgc3R1ZGVudHMuXG5gXG4gICAgICAgICAgY29uc3QgY29udGV4dHVhbE1lYW5pbmcgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkud3JpdGUoY29udGV4dHVhbE1lYW5pbmdQcm9tcHQsIHsgXG4gICAgICAgICAgICB0b25lOiBcImNhc3VhbFwiLCBcbiAgICAgICAgICAgIGxlbmd0aDogXCJzaG9ydFwiIFxuICAgICAgICAgIH0pXG4gICAgICAgICAgc2VjdGlvbnMudm9jYWJ1bGFyeVtpXS5jb250ZXh0dWFsTWVhbmluZyA9IGNvbnRleHR1YWxNZWFuaW5nXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgLy8gS2VlcCBvcmlnaW5hbCBpZiBlbmhhbmNlbWVudCBmYWlsc1xuICAgICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGVuaGFuY2Ugdm9jYWJ1bGFyeSBmb3IgJHt2b2NhYi53b3JkfTpgLCBlcnJvcilcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVuaGFuY2UgZGlzY3Vzc2lvbiBxdWVzdGlvbnMgd2l0aCBzcGVjaWZpYyBjb250ZW50IHJlZmVyZW5jZXNcbiAgICBpZiAoc2VjdGlvbnMuZGlzY3Vzc2lvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZW5oYW5jZWREaXNjdXNzaW9uUHJvbXB0ID0gYFxuRW5oYW5jZSB0aGVzZSBkaXNjdXNzaW9uIHF1ZXN0aW9ucyBmb3IgYSAke2xlc3NvblR5cGV9IGxlc3NvbiBhYm91dCAke2NvbnRlbnRBbmFseXNpcy50b3BpY3Muam9pbignIGFuZCAnKX06XG4ke3NlY3Rpb25zLmRpc2N1c3Npb24uam9pbignXFxuJyl9XG5cbk1ha2UgdGhlbSBtb3JlIHNwZWNpZmljIHRvIHRoZSBjb250ZW50LCBlbmdhZ2luZyBmb3IgJHtzdHVkZW50TGV2ZWx9IGxldmVsIHN0dWRlbnRzLCBhbmQgZW5jb3VyYWdlIGRlZXBlciB0aGlua2luZyBhYm91dDpcbi0gJHtjb250ZW50QW5hbHlzaXMudG9waWNzLnNsaWNlKDAsIDMpLmpvaW4oJ1xcbi0gJyl9XG5cblJldHVybiAzLTQgZW5oYW5jZWQgcXVlc3Rpb25zIHRoYXQgcmVmZXJlbmNlIHNwZWNpZmljIGFzcGVjdHMgb2YgdGhlIGNvbnRlbnQuXG5gXG4gICAgICAgIGNvbnN0IGVuaGFuY2VkRGlzY3Vzc2lvbiA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS53cml0ZShlbmhhbmNlZERpc2N1c3Npb25Qcm9tcHQsIHtcbiAgICAgICAgICB0b25lOiBcImNhc3VhbFwiLCBcbiAgICAgICAgICBsZW5ndGg6IFwibWVkaXVtXCIsIFxuICAgICAgICAgIGZvcm1hdDogXCJidWxsZXQtcG9pbnRzXCIgXG4gICAgICAgIH0pXG4gICAgICAgIHNlY3Rpb25zLmRpc2N1c3Npb24gPSB0aGlzLnBhcnNlTGlzdEZyb21UZXh0KGVuaGFuY2VkRGlzY3Vzc2lvbikuc2xpY2UoMCwgNClcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBlbmhhbmNlIGRpc2N1c3Npb24gcXVlc3Rpb25zOlwiLCBlcnJvcilcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBFbmhhbmNlIHJlYWRpbmcgc2VjdGlvbiB3aXRoIGJldHRlciBzdHJ1Y3R1cmVcbiAgICBpZiAoc2VjdGlvbnMucmVhZGluZyAmJiBzdHJ1Y3R1cmVkQ29udGVudD8uaGVhZGluZ3M/Lmxlbmd0aCA+IDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN0cnVjdHVyZWRSZWFkaW5nUHJvbXB0ID0gYFxuSW1wcm92ZSB0aGlzIHJlYWRpbmcgdGV4dCBieSBvcmdhbml6aW5nIGl0IHdpdGggY2xlYXIgc3RydWN0dXJlIGJhc2VkIG9uIHRoZXNlIGhlYWRpbmdzIGZyb20gdGhlIG9yaWdpbmFsOlxuJHtzdHJ1Y3R1cmVkQ29udGVudC5oZWFkaW5ncy5zbGljZSgwLCAzKS5tYXAoaCA9PiBgLSAke2gudGV4dH1gKS5qb2luKCdcXG4nKX1cblxuT3JpZ2luYWwgdGV4dDogXCIke3NlY3Rpb25zLnJlYWRpbmd9XCJcblxuQ3JlYXRlIGEgd2VsbC1zdHJ1Y3R1cmVkLCAke3N0dWRlbnRMZXZlbH0tYXBwcm9wcmlhdGUgcmVhZGluZyBwYXNzYWdlIHRoYXQgbWFpbnRhaW5zIHRoZSBrZXkgaW5mb3JtYXRpb24gYnV0IGltcHJvdmVzIHJlYWRhYmlsaXR5LlxuYFxuICAgICAgICBjb25zdCBlbmhhbmNlZFJlYWRpbmcgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkucmV3cml0ZShzZWN0aW9ucy5yZWFkaW5nLCB7XG4gICAgICAgICAgdG9uZTogXCJjYXN1YWxcIixcbiAgICAgICAgICBsZW5ndGg6IFwic2FtZVwiLFxuICAgICAgICAgIGF1ZGllbmNlOiB0aGlzLmdldEF1ZGllbmNlTGV2ZWwoc3R1ZGVudExldmVsKVxuICAgICAgICB9KVxuICAgICAgICBzZWN0aW9ucy5yZWFkaW5nID0gZW5oYW5jZWRSZWFkaW5nXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gZW5oYW5jZSByZWFkaW5nIHNlY3Rpb246XCIsIGVycm9yKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEVuaGFuY2UgZ3JhbW1hciBzZWN0aW9uIHdpdGggY29udGVudC1zcGVjaWZpYyBleGFtcGxlc1xuICAgIGlmIChzZWN0aW9ucy5ncmFtbWFyICYmIHNlY3Rpb25zLmdyYW1tYXIuZm9jdXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGdyYW1tYXJFeGFtcGxlc1Byb21wdCA9IGBcbkNyZWF0ZSAzIGdyYW1tYXIgZXhhbXBsZXMgZm9yIFwiJHtzZWN0aW9ucy5ncmFtbWFyLmZvY3VzfVwiIHVzaW5nIHZvY2FidWxhcnkgYW5kIGNvbmNlcHRzIGZyb20gdGhpcyBjb250ZW50OlxuVG9waWNzOiAke2NvbnRlbnRBbmFseXNpcy50b3BpY3Muam9pbignLCAnKX1cbktleSB2b2NhYnVsYXJ5OiAke2NvbnRlbnRBbmFseXNpcy5rZXlWb2NhYnVsYXJ5LnNsaWNlKDAsIDUpLmpvaW4oJywgJyl9XG5cbk1ha2UgZXhhbXBsZXMgcmVsZXZhbnQgdG8gdGhlIGNvbnRlbnQgYW5kIGFwcHJvcHJpYXRlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwuXG5gXG4gICAgICAgIGNvbnN0IGNvbnRleHR1YWxHcmFtbWFyRXhhbXBsZXMgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkud3JpdGUoZ3JhbW1hckV4YW1wbGVzUHJvbXB0LCB7XG4gICAgICAgICAgdG9uZTogXCJjYXN1YWxcIixcbiAgICAgICAgICBsZW5ndGg6IFwic2hvcnRcIixcbiAgICAgICAgICBmb3JtYXQ6IFwiYnVsbGV0LXBvaW50c1wiXG4gICAgICAgIH0pXG4gICAgICAgIHNlY3Rpb25zLmdyYW1tYXIuY29udGV4dHVhbEV4YW1wbGVzID0gdGhpcy5wYXJzZUxpc3RGcm9tVGV4dChjb250ZXh0dWFsR3JhbW1hckV4YW1wbGVzKVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGVuaGFuY2UgZ3JhbW1hciBleGFtcGxlczpcIiwgZXJyb3IpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlY3Rpb25zXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByb29mcmVhZExlc3NvbihsZXNzb246IGFueSkge1xuICAgIC8vIFByb29mcmVhZCBrZXkgdGV4dCBzZWN0aW9uc1xuICAgIGNvbnN0IHNlY3Rpb25zVG9Qcm9vZnJlYWQgPSBbXCJyZWFkaW5nXCIsIFwiZ3JhbW1hci5leGFtcGxlc1wiLCBcInByb251bmNpYXRpb24ucHJhY3RpY2VcIl1cblxuICAgIGZvciAoY29uc3Qgc2VjdGlvblBhdGggb2Ygc2VjdGlvbnNUb1Byb29mcmVhZCkge1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldE5lc3RlZFZhbHVlKGxlc3Nvbiwgc2VjdGlvblBhdGgpXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGNvbnN0IHByb29mcmVhZCA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9vZnJlYWQodmFsdWUsIHtcbiAgICAgICAgICBjaGVja0dyYW1tYXI6IHRydWUsXG4gICAgICAgICAgY2hlY2tTcGVsbGluZzogdHJ1ZSxcbiAgICAgICAgICBjaGVja1N0eWxlOiB0cnVlLFxuICAgICAgICB9KVxuICAgICAgICB0aGlzLnNldE5lc3RlZFZhbHVlKGxlc3Nvbiwgc2VjdGlvblBhdGgsIHByb29mcmVhZC5jb3JyZWN0ZWRfdGV4dClcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbGVzc29uXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlRmFsbGJhY2tMZXNzb24ocGFyYW1zOiBMZXNzb25HZW5lcmF0aW9uUGFyYW1zKTogR2VuZXJhdGVkTGVzc29uIHtcbiAgICAvLyBUZW1wbGF0ZS1iYXNlZCBmYWxsYmFjayB3aGVuIEFJIEFQSXMgZmFpbFxuICAgIGNvbnN0IHsgc291cmNlVGV4dCwgbGVzc29uVHlwZSwgc3R1ZGVudExldmVsLCB0YXJnZXRMYW5ndWFnZSB9ID0gcGFyYW1zXG5cbiAgICByZXR1cm4ge1xuICAgICAgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgd2FybXVwOiB0aGlzLmdldFRlbXBsYXRlV2FybXVwKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIHZvY2FidWxhcnk6IHRoaXMuZXh0cmFjdFZvY2FidWxhcnkoc291cmNlVGV4dCwgc3R1ZGVudExldmVsKSxcbiAgICAgICAgcmVhZGluZzogdGhpcy5zaW1wbGlmeVRleHQoc291cmNlVGV4dCwgc3R1ZGVudExldmVsKSxcbiAgICAgICAgY29tcHJlaGVuc2lvbjogdGhpcy5nZXRUZW1wbGF0ZUNvbXByZWhlbnNpb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsKSxcbiAgICAgICAgZGlzY3Vzc2lvbjogdGhpcy5nZXRUZW1wbGF0ZURpc2N1c3Npb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsKSxcbiAgICAgICAgZ3JhbW1hcjogdGhpcy5nZXRUZW1wbGF0ZUdyYW1tYXIoc3R1ZGVudExldmVsKSxcbiAgICAgICAgcHJvbnVuY2lhdGlvbjogdGhpcy5nZXRUZW1wbGF0ZVByb251bmNpYXRpb24oc291cmNlVGV4dCksXG4gICAgICAgIHdyYXB1cDogdGhpcy5nZXRUZW1wbGF0ZVdyYXB1cChsZXNzb25UeXBlKSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgLy8gSGVscGVyIG1ldGhvZHNcbiAgcHJpdmF0ZSBnZXRTdW1tYXJ5TGVuZ3RoKGxldmVsOiBzdHJpbmcpOiBcInNob3J0XCIgfCBcIm1lZGl1bVwiIHwgXCJsb25nXCIge1xuICAgIGNvbnN0IGxlbmd0aE1hcCA9IHtcbiAgICAgIEExOiBcInNob3J0XCIgYXMgY29uc3QsXG4gICAgICBBMjogXCJzaG9ydFwiIGFzIGNvbnN0LFxuICAgICAgQjE6IFwibWVkaXVtXCIgYXMgY29uc3QsXG4gICAgICBCMjogXCJtZWRpdW1cIiBhcyBjb25zdCxcbiAgICAgIEMxOiBcImxvbmdcIiBhcyBjb25zdCxcbiAgICB9XG4gICAgcmV0dXJuIGxlbmd0aE1hcFtsZXZlbF0gfHwgXCJtZWRpdW1cIlxuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYW5ndWFnZUNvZGUobGFuZ3VhZ2U6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbGFuZ3VhZ2VNYXAgPSB7XG4gICAgICBzcGFuaXNoOiBcImVzXCIsXG4gICAgICBmcmVuY2g6IFwiZnJcIixcbiAgICAgIGdlcm1hbjogXCJkZVwiLFxuICAgICAgaXRhbGlhbjogXCJpdFwiLFxuICAgICAgcG9ydHVndWVzZTogXCJwdFwiLFxuICAgICAgamFwYW5lc2U6IFwiamFcIixcbiAgICAgIGtvcmVhbjogXCJrb1wiLFxuICAgICAgY2hpbmVzZTogXCJ6aFwiLFxuICAgIH1cbiAgICByZXR1cm4gbGFuZ3VhZ2VNYXBbbGFuZ3VhZ2VdIHx8IFwiZW5cIlxuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZUxpc3RGcm9tVGV4dCh0ZXh0OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHRleHRcbiAgICAgIC5zcGxpdChcIlxcblwiKVxuICAgICAgLmZpbHRlcigobGluZSkgPT4gbGluZS50cmltKCkpXG4gICAgICAubWFwKChsaW5lKSA9PiBsaW5lLnJlcGxhY2UoL15bLeKAoipdXFxzKi8sIFwiXCIpLnRyaW0oKSlcbiAgICAgIC5maWx0ZXIoKGxpbmUpID0+IGxpbmUubGVuZ3RoID4gMClcbiAgICAgIC5zbGljZSgwLCA0KSAvLyBMaW1pdCB0byA0IGl0ZW1zXG4gIH1cblxuICBwcml2YXRlIGdldE5lc3RlZFZhbHVlKG9iajogYW55LCBwYXRoOiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiBwYXRoLnNwbGl0KFwiLlwiKS5yZWR1Y2UoKGN1cnJlbnQsIGtleSkgPT4gY3VycmVudD8uW2tleV0sIG9iailcbiAgfVxuXG4gIHByaXZhdGUgc2V0TmVzdGVkVmFsdWUob2JqOiBhbnksIHBhdGg6IHN0cmluZywgdmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IGtleXMgPSBwYXRoLnNwbGl0KFwiLlwiKVxuICAgIGNvbnN0IGxhc3RLZXkgPSBrZXlzLnBvcCgpIVxuICAgIGNvbnN0IHRhcmdldCA9IGtleXMucmVkdWNlKChjdXJyZW50LCBrZXkpID0+IGN1cnJlbnRba2V5XSwgb2JqKVxuICAgIHRhcmdldFtsYXN0S2V5XSA9IHZhbHVlXG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVN0cnVjdHVyZWRGYWxsYmFjayhjb250ZW50OiBzdHJpbmcsIGxlc3NvblR5cGU6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcpIHtcbiAgICBjb25zb2xlLmxvZyhcIvCflIQgQ3JlYXRpbmcgc3RydWN0dXJlZCBmYWxsYmFjayBsZXNzb24uLi5cIilcbiAgICBcbiAgICAvLyBFeHRyYWN0IHNvbWUgYmFzaWMgaW5mb3JtYXRpb24gZnJvbSBjb250ZW50IGZvciBiZXR0ZXIgZmFsbGJhY2tcbiAgICBjb25zdCB3b3JkcyA9IGNvbnRlbnQudG9Mb3dlckNhc2UoKS5tYXRjaCgvXFxiW2Etel17NCx9XFxiL2cpIHx8IFtdXG4gICAgY29uc3QgdW5pcXVlV29yZHMgPSBbLi4ubmV3IFNldCh3b3JkcyldLnNsaWNlKDAsIDYpXG4gICAgXG4gICAgY29uc3QgZmFsbGJhY2sgPSB7XG4gICAgICB3YXJtdXA6IHRoaXMuZ2V0VGVtcGxhdGVXYXJtdXAobGVzc29uVHlwZSwgc3R1ZGVudExldmVsKSxcbiAgICAgIHZvY2FidWxhcnk6IHVuaXF1ZVdvcmRzLm1hcCh3b3JkID0+ICh7XG4gICAgICAgIHdvcmQ6IHdvcmQsXG4gICAgICAgIG1lYW5pbmc6IGBEZWZpbml0aW9uIG9mICR7d29yZH1gLFxuICAgICAgICBleGFtcGxlOiBgRXhhbXBsZSBzZW50ZW5jZSB3aXRoICR7d29yZH0uYFxuICAgICAgfSkpLFxuICAgICAgcmVhZGluZzogdGhpcy5zaW1wbGlmeVRleHQoY29udGVudCwgc3R1ZGVudExldmVsKSxcbiAgICAgIGNvbXByZWhlbnNpb246IHRoaXMuZ2V0VGVtcGxhdGVDb21wcmVoZW5zaW9uKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCksXG4gICAgICBkaXNjdXNzaW9uOiB0aGlzLmdldFRlbXBsYXRlRGlzY3Vzc2lvbihsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpLFxuICAgICAgZ3JhbW1hcjogdGhpcy5nZXRUZW1wbGF0ZUdyYW1tYXIoc3R1ZGVudExldmVsKSxcbiAgICAgIHByb251bmNpYXRpb246IHRoaXMuZ2V0VGVtcGxhdGVQcm9udW5jaWF0aW9uKGNvbnRlbnQpLFxuICAgICAgd3JhcHVwOiB0aGlzLmdldFRlbXBsYXRlV3JhcHVwKGxlc3NvblR5cGUpLFxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIuKchSBTdHJ1Y3R1cmVkIGZhbGxiYWNrIGNyZWF0ZWRcIilcbiAgICByZXR1cm4gZmFsbGJhY2tcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGVtcGxhdGVXYXJtdXAobGVzc29uVHlwZTogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCB0ZW1wbGF0ZXMgPSB7XG4gICAgICBkaXNjdXNzaW9uOiBbXG4gICAgICAgIFwiV2hhdCBkbyB5b3UgYWxyZWFkeSBrbm93IGFib3V0IHRoaXMgdG9waWM/XCIsXG4gICAgICAgIFwiSGF2ZSB5b3UgaGFkIHNpbWlsYXIgZXhwZXJpZW5jZXM/XCIsXG4gICAgICAgIFwiV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBsZWFybiBtb3JlIGFib3V0P1wiLFxuICAgICAgXSxcbiAgICAgIGdyYW1tYXI6IFtcbiAgICAgICAgXCJXaGF0IGdyYW1tYXIgcGF0dGVybnMgZG8geW91IG5vdGljZT9cIixcbiAgICAgICAgXCJXaGljaCBzZW50ZW5jZXMgc2VlbSBtb3N0IGNvbXBsZXg/XCIsXG4gICAgICAgIFwiV2hhdCBncmFtbWFyIHJ1bGVzIGRvIHlvdSByZW1lbWJlcj9cIixcbiAgICAgIF0sXG4gICAgICB0cmF2ZWw6IFtcbiAgICAgICAgXCJXaGVyZSB3b3VsZCB5b3UgbGlrZSB0byB0cmF2ZWwgbmV4dD9cIixcbiAgICAgICAgXCJXaGF0IHRyYXZlbCBleHBlcmllbmNlcyBoYXZlIHlvdSBoYWQ/XCIsXG4gICAgICAgIFwiV2hhdCB0cmF2ZWwgdm9jYWJ1bGFyeSBkbyB5b3Uga25vdz9cIixcbiAgICAgIF0sXG4gICAgICBidXNpbmVzczogW1xuICAgICAgICBcIldoYXQgYnVzaW5lc3Mgc2l0dWF0aW9ucyBhcmUgeW91IGZhbWlsaWFyIHdpdGg/XCIsXG4gICAgICAgIFwiSG93IGRvIHlvdSBjb21tdW5pY2F0ZSBwcm9mZXNzaW9uYWxseT9cIixcbiAgICAgICAgXCJXaGF0IGJ1c2luZXNzIHRlcm1zIGFyZSBjaGFsbGVuZ2luZz9cIixcbiAgICAgIF0sXG4gICAgICBwcm9udW5jaWF0aW9uOiBbXG4gICAgICAgIFwiV2hpY2ggc291bmRzIGFyZSBkaWZmaWN1bHQgdG8gcHJvbm91bmNlP1wiLFxuICAgICAgICBcIkhvdyBkbyB5b3UgcHJhY3RpY2UgcHJvbnVuY2lhdGlvbj9cIixcbiAgICAgICAgXCJXaGF0IHByb251bmNpYXRpb24gZ29hbHMgZG8geW91IGhhdmU/XCIsXG4gICAgICBdLFxuICAgIH1cbiAgICByZXR1cm4gdGVtcGxhdGVzW2xlc3NvblR5cGVdIHx8IHRlbXBsYXRlcy5kaXNjdXNzaW9uXG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RWb2NhYnVsYXJ5KHRleHQ6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcpIHtcbiAgICAvLyBTaW1wbGUgdm9jYWJ1bGFyeSBleHRyYWN0aW9uIGJhc2VkIG9uIHdvcmQgZnJlcXVlbmN5IGFuZCBjb21wbGV4aXR5XG4gICAgY29uc3Qgd29yZHMgPSB0ZXh0LnRvTG93ZXJDYXNlKCkubWF0Y2goL1xcYlthLXpdezQsfVxcYi9nKSB8fCBbXVxuICAgIGNvbnN0IHVuaXF1ZVdvcmRzID0gWy4uLm5ldyBTZXQod29yZHMpXVxuICAgIGNvbnN0IHNlbGVjdGVkV29yZHMgPSB1bmlxdWVXb3Jkcy5zbGljZSgwLCA2KVxuXG4gICAgcmV0dXJuIHNlbGVjdGVkV29yZHMubWFwKCh3b3JkKSA9PiAoe1xuICAgICAgd29yZDogd29yZCxcbiAgICAgIG1lYW5pbmc6IGBEZWZpbml0aW9uIG9mICR7d29yZH1gLFxuICAgICAgZXhhbXBsZTogYEV4YW1wbGUgc2VudGVuY2Ugd2l0aCAke3dvcmR9LmAsXG4gICAgfSkpXG4gIH1cblxuICBwcml2YXRlIHNpbXBsaWZ5VGV4dCh0ZXh0OiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBCYXNpYyB0ZXh0IHNpbXBsaWZpY2F0aW9uIGJhc2VkIG9uIGxldmVsXG4gICAgY29uc3QgbWF4TGVuZ3RoID0ge1xuICAgICAgQTE6IDIwMCxcbiAgICAgIEEyOiAzMDAsXG4gICAgICBCMTogNDAwLFxuICAgICAgQjI6IDUwMCxcbiAgICAgIEMxOiA2MDAsXG4gICAgfVxuXG4gICAgY29uc3QgbGltaXQgPSBtYXhMZW5ndGhbc3R1ZGVudExldmVsXSB8fCA0MDBcbiAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoMCwgbGltaXQpICsgKHRleHQubGVuZ3RoID4gbGltaXQgPyBcIi4uLlwiIDogXCJcIilcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGVtcGxhdGVDb21wcmVoZW5zaW9uKGxlc3NvblR5cGU6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIFwiV2hhdCBpcyB0aGUgbWFpbiBpZGVhIG9mIHRoaXMgdGV4dD9cIixcbiAgICAgIFwiV2hhdCBzdXBwb3J0aW5nIGRldGFpbHMgY2FuIHlvdSBpZGVudGlmeT9cIixcbiAgICAgIFwiSG93IGRvZXMgdGhpcyByZWxhdGUgdG8geW91ciBleHBlcmllbmNlP1wiLFxuICAgICAgXCJXaGF0IGNvbmNsdXNpb25zIGNhbiB5b3UgZHJhdz9cIixcbiAgICBdXG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlRGlzY3Vzc2lvbihsZXNzb25UeXBlOiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHRlbXBsYXRlcyA9IHtcbiAgICAgIGRpc2N1c3Npb246IFtcbiAgICAgICAgXCJXaGF0IGlzIHlvdXIgb3BpbmlvbiBvbiB0aGlzIHRvcGljP1wiLFxuICAgICAgICBcIkhvdyB3b3VsZCB5b3UgaGFuZGxlIHRoaXMgc2l0dWF0aW9uP1wiLFxuICAgICAgICBcIldoYXQgYWx0ZXJuYXRpdmUgYXBwcm9hY2hlcyBleGlzdD9cIixcbiAgICAgIF0sXG4gICAgICBidXNpbmVzczogW1xuICAgICAgICBcIkhvdyB3b3VsZCB5b3UgYXBwbHkgdGhpcyBwcm9mZXNzaW9uYWxseT9cIixcbiAgICAgICAgXCJXaGF0IGJ1c2luZXNzIGNoYWxsZW5nZXMgZG9lcyB0aGlzIGFkZHJlc3M/XCIsXG4gICAgICAgIFwiSG93IHdvdWxkIHlvdSBwcmVzZW50IHRoaXMgdG8gY29sbGVhZ3Vlcz9cIixcbiAgICAgIF0sXG4gICAgICB0cmF2ZWw6IFtcbiAgICAgICAgXCJIb3cgd291bGQgdGhpcyBoZWxwIHdoaWxlIHRyYXZlbGluZz9cIixcbiAgICAgICAgXCJXaGF0IHByZXBhcmF0aW9ucyB3b3VsZCB5b3UgbWFrZT9cIixcbiAgICAgICAgXCJIb3cgd291bGQgeW91IHNoYXJlIHRoaXMgZXhwZXJpZW5jZT9cIixcbiAgICAgIF0sXG4gICAgfVxuICAgIHJldHVybiB0ZW1wbGF0ZXNbbGVzc29uVHlwZV0gfHwgdGVtcGxhdGVzLmRpc2N1c3Npb25cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGVtcGxhdGVHcmFtbWFyKHN0dWRlbnRMZXZlbDogc3RyaW5nKSB7XG4gICAgY29uc3QgZ3JhbW1hckZvY2kgPSB7XG4gICAgICBBMTogXCJQcmVzZW50IFNpbXBsZSBUZW5zZVwiLFxuICAgICAgQTI6IFwiUGFzdCBTaW1wbGUgVGVuc2VcIixcbiAgICAgIEIxOiBcIlByZXNlbnQgUGVyZmVjdCBUZW5zZVwiLFxuICAgICAgQjI6IFwiQ29uZGl0aW9uYWwgU2VudGVuY2VzXCIsXG4gICAgICBDMTogXCJBZHZhbmNlZCBHcmFtbWFyIFN0cnVjdHVyZXNcIixcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZm9jdXM6IGdyYW1tYXJGb2NpW3N0dWRlbnRMZXZlbF0gfHwgXCJQcmVzZW50IFBlcmZlY3QgVGVuc2VcIixcbiAgICAgIGV4YW1wbGVzOiBbXCJJIGhhdmUgbGVhcm5lZCBtYW55IG5ldyB0aGluZ3MuXCIsIFwiU2hlIGhhcyBpbXByb3ZlZCBoZXIgc2tpbGxzLlwiLCBcIldlIGhhdmUgZGlzY3Vzc2VkIHRoaXMgdG9waWMuXCJdLFxuICAgICAgZXhlcmNpc2U6IFtcbiAgICAgICAgXCJJIF9fX19fIChsZWFybikgYSBsb3QgdG9kYXkuXCIsXG4gICAgICAgIFwiVGhleSBfX19fXyAoY29tcGxldGUpIHRoZSBwcm9qZWN0LlwiLFxuICAgICAgICBcIlNoZSBfX19fXyAoaW1wcm92ZSkgc2lnbmlmaWNhbnRseS5cIixcbiAgICAgIF0sXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRUZW1wbGF0ZVByb251bmNpYXRpb24odGV4dDogc3RyaW5nKSB7XG4gICAgLy8gRXh0cmFjdCBhIGNoYWxsZW5naW5nIHdvcmQgZnJvbSB0aGUgdGV4dFxuICAgIGNvbnN0IHdvcmRzID0gdGV4dC5tYXRjaCgvXFxiW2Etel17Nix9XFxiL2dpKSB8fCBbXCJjb21tdW5pY2F0aW9uXCJdXG4gICAgY29uc3Qgc2VsZWN0ZWRXb3JkID0gd29yZHNbMF0gfHwgXCJjb21tdW5pY2F0aW9uXCJcblxuICAgIHJldHVybiB7XG4gICAgICB3b3JkOiBzZWxlY3RlZFdvcmQudG9Mb3dlckNhc2UoKSxcbiAgICAgIGlwYTogXCIva8mZy4xtanXLkG7JqsuIa2XJqsqDyZluL1wiLFxuICAgICAgcHJhY3RpY2U6IGBQcmFjdGljZSBzYXlpbmc6IFwiJHtzZWxlY3RlZFdvcmR9XCIgaW4gYSBzZW50ZW5jZS5gLFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGVtcGxhdGVXcmFwdXAobGVzc29uVHlwZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXG4gICAgICBcIldoYXQgbmV3IHZvY2FidWxhcnkgZGlkIHlvdSBsZWFybj9cIixcbiAgICAgIFwiV2hpY2ggY29uY2VwdHMgbmVlZCBtb3JlIHByYWN0aWNlP1wiLFxuICAgICAgXCJIb3cgd2lsbCB5b3UgdXNlIHRoaXMga25vd2xlZGdlP1wiLFxuICAgICAgXCJXaGF0IHF1ZXN0aW9ucyBkbyB5b3Ugc3RpbGwgaGF2ZT9cIixcbiAgICBdXG4gIH1cblxuICAvLyBOZXcgaGVscGVyIG1ldGhvZHMgZm9yIGVuaGFuY2VkIGNvbnRleHR1YWwgYW5hbHlzaXNcblxuICBwcml2YXRlIGV4dHJhY3RUb3BpY3NGcm9tSGVhZGluZ3MoaGVhZGluZ3M6IEFycmF5PHsgbGV2ZWw6IG51bWJlcjsgdGV4dDogc3RyaW5nIH0+KTogc3RyaW5nW10ge1xuICAgIHJldHVybiBoZWFkaW5nc1xuICAgICAgLmZpbHRlcihoID0+IGgubGV2ZWwgPD0gMykgLy8gRm9jdXMgb24gbWFpbiBoZWFkaW5nc1xuICAgICAgLm1hcChoID0+IGgudGV4dClcbiAgICAgIC5zbGljZSgwLCA1KVxuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0Vm9jYWJ1bGFyeUZyb21UZXh0KHRleHQ6IHN0cmluZywgbGV2ZWw6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICAvLyBFeHRyYWN0IHdvcmRzIGJhc2VkIG9uIGNvbXBsZXhpdHkgYXBwcm9wcmlhdGUgZm9yIHRoZSBsZXZlbFxuICAgIGNvbnN0IHdvcmRzID0gdGV4dC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9cXGJbYS16XXs0LH1cXGIvZykgfHwgW11cbiAgICBjb25zdCB1bmlxdWVXb3JkcyA9IFsuLi5uZXcgU2V0KHdvcmRzKV1cbiAgICBcbiAgICAvLyBGaWx0ZXIgYnkgY29tcGxleGl0eSBiYXNlZCBvbiBsZXZlbFxuICAgIGNvbnN0IGNvbXBsZXhpdHlUaHJlc2hvbGQgPSB7XG4gICAgICAnQTEnOiA2LFxuICAgICAgJ0EyJzogNyxcbiAgICAgICdCMSc6IDgsXG4gICAgICAnQjInOiAxMCxcbiAgICAgICdDMSc6IDEyXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IG1heExlbmd0aCA9IGNvbXBsZXhpdHlUaHJlc2hvbGRbbGV2ZWxdIHx8IDhcbiAgICByZXR1cm4gdW5pcXVlV29yZHNcbiAgICAgIC5maWx0ZXIod29yZCA9PiB3b3JkLmxlbmd0aCA8PSBtYXhMZW5ndGggJiYgd29yZC5sZW5ndGggPj0gNClcbiAgICAgIC5zbGljZSgwLCA4KVxuICB9XG5cbiAgcHJpdmF0ZSBkZXRlcm1pbmVDdWx0dXJhbENvbnRleHQoZG9tYWluOiBzdHJpbmcsIHRleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gRGV0ZXJtaW5lIGN1bHR1cmFsIGNvbnRleHQgYmFzZWQgb24gZG9tYWluIGFuZCBjb250ZW50XG4gICAgY29uc3QgY3VsdHVyYWxJbmRpY2F0b3JzID0ge1xuICAgICAgJ2JiYy5jb20nOiAnQnJpdGlzaCBFbmdsaXNoLCBVSyBjdWx0dXJlJyxcbiAgICAgICdjbm4uY29tJzogJ0FtZXJpY2FuIEVuZ2xpc2gsIFVTIGN1bHR1cmUnLFxuICAgICAgJ3dpa2lwZWRpYS5vcmcnOiAnSW50ZXJuYXRpb25hbCwgZW5jeWNsb3BlZGljJyxcbiAgICAgICdueXRpbWVzLmNvbSc6ICdBbWVyaWNhbiBFbmdsaXNoLCBVUyBwZXJzcGVjdGl2ZScsXG4gICAgICAndGhlZ3VhcmRpYW4uY29tJzogJ0JyaXRpc2ggRW5nbGlzaCwgVUsgcGVyc3BlY3RpdmUnLFxuICAgIH1cblxuICAgIGlmIChjdWx0dXJhbEluZGljYXRvcnNbZG9tYWluXSkge1xuICAgICAgcmV0dXJuIGN1bHR1cmFsSW5kaWNhdG9yc1tkb21haW5dXG4gICAgfVxuXG4gICAgLy8gQW5hbHl6ZSB0ZXh0IGZvciBjdWx0dXJhbCBtYXJrZXJzXG4gICAgY29uc3QgYW1lcmljYW5NYXJrZXJzID0gWydkb2xsYXInLCAncHJlc2lkZW50JywgJ2NvbmdyZXNzJywgJ3N0YXRlJywgJ2ZlZGVyYWwnXVxuICAgIGNvbnN0IGJyaXRpc2hNYXJrZXJzID0gWydwb3VuZCcsICdtaW5pc3RlcicsICdwYXJsaWFtZW50JywgJ2NvdW5jaWwnLCAnZ292ZXJubWVudCddXG4gICAgXG4gICAgY29uc3QgYW1lcmljYW5Db3VudCA9IGFtZXJpY2FuTWFya2Vycy5maWx0ZXIobWFya2VyID0+IFxuICAgICAgdGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG1hcmtlcilcbiAgICApLmxlbmd0aFxuICAgIFxuICAgIGNvbnN0IGJyaXRpc2hDb3VudCA9IGJyaXRpc2hNYXJrZXJzLmZpbHRlcihtYXJrZXIgPT4gXG4gICAgICB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobWFya2VyKVxuICAgICkubGVuZ3RoXG5cbiAgICBpZiAoYW1lcmljYW5Db3VudCA+IGJyaXRpc2hDb3VudCkge1xuICAgICAgcmV0dXJuICdBbWVyaWNhbiBFbmdsaXNoIGNvbnRleHQnXG4gICAgfSBlbHNlIGlmIChicml0aXNoQ291bnQgPiBhbWVyaWNhbkNvdW50KSB7XG4gICAgICByZXR1cm4gJ0JyaXRpc2ggRW5nbGlzaCBjb250ZXh0J1xuICAgIH1cblxuICAgIHJldHVybiAnSW50ZXJuYXRpb25hbCBjb250ZXh0J1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUxlYXJuaW5nT2JqZWN0aXZlcyhjb250ZW50VHlwZTogc3RyaW5nLCB0b3BpY3M6IHN0cmluZ1tdLCBsZXZlbDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IG9iamVjdGl2ZXMgPSBbXVxuICAgIFxuICAgIC8vIEJhc2Ugb2JqZWN0aXZlcyBvbiBjb250ZW50IHR5cGVcbiAgICBzd2l0Y2ggKGNvbnRlbnRUeXBlKSB7XG4gICAgICBjYXNlICduZXdzJzpcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdVbmRlcnN0YW5kIGN1cnJlbnQgZXZlbnRzIHZvY2FidWxhcnknKVxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ1ByYWN0aWNlIHJlYWRpbmcgbmV3cyBhcnRpY2xlcycpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdibG9nJzpcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdMZWFybiBpbmZvcm1hbCB3cml0aW5nIHN0eWxlJylcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdVbmRlcnN0YW5kIHBlcnNvbmFsIG9waW5pb25zIGFuZCBleHBlcmllbmNlcycpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd0dXRvcmlhbCc6XG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnRm9sbG93IHN0ZXAtYnktc3RlcCBpbnN0cnVjdGlvbnMnKVxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ0xlYXJuIHRlY2huaWNhbCB2b2NhYnVsYXJ5JylcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ2VuY3ljbG9wZWRpYSc6XG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnVW5kZXJzdGFuZCBmYWN0dWFsIGluZm9ybWF0aW9uJylcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdMZWFybiBhY2FkZW1pYyB2b2NhYnVsYXJ5JylcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnSW1wcm92ZSByZWFkaW5nIGNvbXByZWhlbnNpb24nKVxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ0V4cGFuZCB2b2NhYnVsYXJ5IGtub3dsZWRnZScpXG4gICAgfVxuXG4gICAgLy8gQWRkIHRvcGljLXNwZWNpZmljIG9iamVjdGl2ZXNcbiAgICB0b3BpY3Muc2xpY2UoMCwgMikuZm9yRWFjaCh0b3BpYyA9PiB7XG4gICAgICBvYmplY3RpdmVzLnB1c2goYERpc2N1c3MgdG9waWNzIHJlbGF0ZWQgdG8gJHt0b3BpYy50b0xvd2VyQ2FzZSgpfWApXG4gICAgfSlcblxuICAgIHJldHVybiBvYmplY3RpdmVzLnNsaWNlKDAsIDQpXG4gIH1cblxuICBwcml2YXRlIGdldEF1ZGllbmNlTGV2ZWwoY2VmckxldmVsOiBzdHJpbmcpOiBcImdlbmVyYWxcIiB8IFwiZXhwZXJ0XCIgfCBcImJlZ2lubmVyXCIge1xuICAgIGNvbnN0IGxldmVsTWFwID0ge1xuICAgICAgJ0ExJzogJ2JlZ2lubmVyJyBhcyBjb25zdCxcbiAgICAgICdBMic6ICdiZWdpbm5lcicgYXMgY29uc3QsXG4gICAgICAnQjEnOiAnZ2VuZXJhbCcgYXMgY29uc3QsXG4gICAgICAnQjInOiAnZ2VuZXJhbCcgYXMgY29uc3QsXG4gICAgICAnQzEnOiAnZXhwZXJ0JyBhcyBjb25zdCxcbiAgICB9XG4gICAgcmV0dXJuIGxldmVsTWFwW2NlZnJMZXZlbF0gfHwgJ2dlbmVyYWwnXG4gIH1cblxuICAvLyBFbmhhbmNlZCBmYWxsYmFjayBsZXNzb24gZ2VuZXJhdGlvbiB3aXRoIGNvbnRleHRcbiAgcHJpdmF0ZSBnZW5lcmF0ZUVuaGFuY2VkRmFsbGJhY2tMZXNzb24ocGFyYW1zOiBMZXNzb25HZW5lcmF0aW9uUGFyYW1zKTogR2VuZXJhdGVkTGVzc29uIHtcbiAgICBjb25zdCB7IFxuICAgICAgc291cmNlVGV4dCwgXG4gICAgICBsZXNzb25UeXBlLCBcbiAgICAgIHN0dWRlbnRMZXZlbCwgXG4gICAgICB0YXJnZXRMYW5ndWFnZSxcbiAgICAgIGNvbnRlbnRNZXRhZGF0YSxcbiAgICAgIHN0cnVjdHVyZWRDb250ZW50IFxuICAgIH0gPSBwYXJhbXNcblxuICAgIC8vIFVzZSBhdmFpbGFibGUgY29udGV4dCBldmVuIGluIGZhbGxiYWNrXG4gICAgY29uc3QgdG9waWNzID0gc3RydWN0dXJlZENvbnRlbnQ/LmhlYWRpbmdzPy5tYXAoaCA9PiBoLnRleHQpLnNsaWNlKDAsIDMpIHx8IFtdXG4gICAgY29uc3QgY29udGVudFR5cGUgPSBjb250ZW50TWV0YWRhdGE/LmNvbnRlbnRUeXBlIHx8ICdnZW5lcmFsJ1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxlc3NvblR5cGUsXG4gICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICB0YXJnZXRMYW5ndWFnZSxcbiAgICAgIHNlY3Rpb25zOiB7XG4gICAgICAgIHdhcm11cDogdGhpcy5nZXRDb250ZXh0dWFsV2FybXVwKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCwgdG9waWNzLCBjb250ZW50VHlwZSksXG4gICAgICAgIHZvY2FidWxhcnk6IHRoaXMuZXh0cmFjdENvbnRleHR1YWxWb2NhYnVsYXJ5KHNvdXJjZVRleHQsIHN0dWRlbnRMZXZlbCwgdG9waWNzKSxcbiAgICAgICAgcmVhZGluZzogdGhpcy5zaW1wbGlmeVRleHQoc291cmNlVGV4dCwgc3R1ZGVudExldmVsKSxcbiAgICAgICAgY29tcHJlaGVuc2lvbjogdGhpcy5nZXRDb250ZXh0dWFsQ29tcHJlaGVuc2lvbihsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwsIHRvcGljcyksXG4gICAgICAgIGRpc2N1c3Npb246IHRoaXMuZ2V0Q29udGV4dHVhbERpc2N1c3Npb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsLCB0b3BpY3MpLFxuICAgICAgICBncmFtbWFyOiB0aGlzLmdldFRlbXBsYXRlR3JhbW1hcihzdHVkZW50TGV2ZWwpLFxuICAgICAgICBwcm9udW5jaWF0aW9uOiB0aGlzLmdldFRlbXBsYXRlUHJvbnVuY2lhdGlvbihzb3VyY2VUZXh0KSxcbiAgICAgICAgd3JhcHVwOiB0aGlzLmdldENvbnRleHR1YWxXcmFwdXAobGVzc29uVHlwZSwgdG9waWNzKSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb250ZXh0dWFsV2FybXVwKGxlc3NvblR5cGU6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcsIHRvcGljczogc3RyaW5nW10sIGNvbnRlbnRUeXBlOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgLy8gVXNlIHRoZSBzYW1lIGNvbnRleHR1YWwgZmFsbGJhY2sgbG9naWNcbiAgICBjb25zdCBtb2NrQW5hbHlzaXMgPSB7XG4gICAgICB0b3BpY3M6IHRvcGljcyxcbiAgICAgIGNvbnRlbnRUeXBlOiBjb250ZW50VHlwZSxcbiAgICAgIHNvdXJjZUNvdW50cnk6ICdJbnRlcm5hdGlvbmFsJ1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdGhpcy5nZXRDb250ZXh0dWFsV2FybXVwRmFsbGJhY2soc3R1ZGVudExldmVsLCBtb2NrQW5hbHlzaXMsIHsgdGl0bGU6IHRvcGljc1swXSB8fCAnQ29udGVudCcgfSlcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdENvbnRleHR1YWxWb2NhYnVsYXJ5KHRleHQ6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcsIHRvcGljczogc3RyaW5nW10pIHtcbiAgICBjb25zdCB2b2NhYnVsYXJ5ID0gdGhpcy5leHRyYWN0Vm9jYWJ1bGFyeSh0ZXh0LCBzdHVkZW50TGV2ZWwpXG4gICAgXG4gICAgLy8gRW5oYW5jZSB3aXRoIHRvcGljIGNvbnRleHQgaWYgYXZhaWxhYmxlXG4gICAgaWYgKHRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gdm9jYWJ1bGFyeS5tYXAoKHZvY2FiLCBpbmRleCkgPT4gKHtcbiAgICAgICAgLi4udm9jYWIsXG4gICAgICAgIGNvbnRleHQ6IGluZGV4IDwgdG9waWNzLmxlbmd0aCA/IGBSZWxhdGVkIHRvICR7dG9waWNzW2luZGV4XS50b0xvd2VyQ2FzZSgpfWAgOiB2b2NhYi5tZWFuaW5nLFxuICAgICAgfSkpXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB2b2NhYnVsYXJ5XG4gIH1cblxuICBwcml2YXRlIGdldENvbnRleHR1YWxDb21wcmVoZW5zaW9uKGxlc3NvblR5cGU6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcsIHRvcGljczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYmFzZVF1ZXN0aW9ucyA9IHRoaXMuZ2V0VGVtcGxhdGVDb21wcmVoZW5zaW9uKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbClcbiAgICBcbiAgICBpZiAodG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIGBXaGF0IGlzIHRoZSBtYWluIHBvaW50IGFib3V0ICR7dG9waWNzWzBdPy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgSG93IGRvZXMgdGhlIHRleHQgZXhwbGFpbiAke3RvcGljc1sxXT8udG9Mb3dlckNhc2UoKSB8fCAndGhlIHRvcGljJ30/YCxcbiAgICAgICAgXCJXaGF0IHN1cHBvcnRpbmcgZGV0YWlscyBjYW4geW91IGlkZW50aWZ5P1wiLFxuICAgICAgICBcIldoYXQgY29uY2x1c2lvbnMgY2FuIHlvdSBkcmF3IGZyb20gdGhpcyBpbmZvcm1hdGlvbj9cIixcbiAgICAgIF1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGJhc2VRdWVzdGlvbnNcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGV4dHVhbERpc2N1c3Npb24obGVzc29uVHlwZTogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZywgdG9waWNzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBiYXNlUXVlc3Rpb25zID0gdGhpcy5nZXRUZW1wbGF0ZURpc2N1c3Npb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsKVxuICAgIFxuICAgIGlmICh0b3BpY3MubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgYFdoYXQgaXMgeW91ciBvcGluaW9uIGFib3V0ICR7dG9waWNzWzBdPy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgSG93IHdvdWxkIHlvdSBhcHBseSB0aGlzIGluZm9ybWF0aW9uIGFib3V0ICR7dG9waWNzWzFdPy50b0xvd2VyQ2FzZSgpIHx8ICd0aGlzIHRvcGljJ30/YCxcbiAgICAgICAgYFdoYXQgYXJlIHRoZSBpbXBsaWNhdGlvbnMgb2Ygd2hhdCB5b3UgbGVhcm5lZCBhYm91dCAke3RvcGljc1swXT8udG9Mb3dlckNhc2UoKX0/YCxcbiAgICAgIF1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGJhc2VRdWVzdGlvbnNcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGV4dHVhbFdyYXB1cChsZXNzb25UeXBlOiBzdHJpbmcsIHRvcGljczogc3RyaW5nW10pOiBzdHJpbmdbXSB7XG4gICAgaWYgKHRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBgV2hhdCBuZXcgdm9jYWJ1bGFyeSBkaWQgeW91IGxlYXJuIGFib3V0ICR7dG9waWNzWzBdPy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgV2hpY2ggY29uY2VwdHMgYWJvdXQgJHt0b3BpY3NbMV0/LnRvTG93ZXJDYXNlKCkgfHwgJ3RoaXMgdG9waWMnfSBuZWVkIG1vcmUgcHJhY3RpY2U/YCxcbiAgICAgICAgXCJIb3cgd2lsbCB5b3UgdXNlIHRoaXMga25vd2xlZGdlIGluIHJlYWwgc2l0dWF0aW9ucz9cIixcbiAgICAgICAgXCJXaGF0IHF1ZXN0aW9ucyBkbyB5b3Ugc3RpbGwgaGF2ZSBhYm91dCB0aGlzIGNvbnRlbnQ/XCIsXG4gICAgICBdXG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzLmdldFRlbXBsYXRlV3JhcHVwKGxlc3NvblR5cGUpXG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kIHRvIGRldGVybWluZSBzb3VyY2UgY291bnRyeSBmcm9tIGRvbWFpblxuICBwcml2YXRlIGRldGVybWluZVNvdXJjZUNvdW50cnkoZG9tYWluOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvdW50cnlNYXAgPSB7XG4gICAgICAnYmJjLmNvbSc6ICdVbml0ZWQgS2luZ2RvbScsXG4gICAgICAnYmJjLmNvLnVrJzogJ1VuaXRlZCBLaW5nZG9tJywgXG4gICAgICAnY25uLmNvbSc6ICdVbml0ZWQgU3RhdGVzJyxcbiAgICAgICdueXRpbWVzLmNvbSc6ICdVbml0ZWQgU3RhdGVzJyxcbiAgICAgICd0aGVndWFyZGlhbi5jb20nOiAnVW5pdGVkIEtpbmdkb20nLFxuICAgICAgJ3dhc2hpbmd0b25wb3N0LmNvbSc6ICdVbml0ZWQgU3RhdGVzJyxcbiAgICAgICdyZXV0ZXJzLmNvbSc6ICdJbnRlcm5hdGlvbmFsJyxcbiAgICAgICdhcC5vcmcnOiAnVW5pdGVkIFN0YXRlcycsXG4gICAgICAnbnByLm9yZyc6ICdVbml0ZWQgU3RhdGVzJyxcbiAgICAgICdhYmMubmV0LmF1JzogJ0F1c3RyYWxpYScsXG4gICAgICAnY2JjLmNhJzogJ0NhbmFkYScsXG4gICAgfVxuICAgIFxuICAgIGZvciAoY29uc3QgW2RvbWFpbktleSwgY291bnRyeV0gb2YgT2JqZWN0LmVudHJpZXMoY291bnRyeU1hcCkpIHtcbiAgICAgIGlmIChkb21haW4uaW5jbHVkZXMoZG9tYWluS2V5KSkge1xuICAgICAgICByZXR1cm4gY291bnRyeVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gJ0ludGVybmF0aW9uYWwnXG4gIH1cblxuICAvLyBGYWxsYmFjayB3YXJtLXVwIHF1ZXN0aW9uIGdlbmVyYXRvclxuICBwcml2YXRlIGdldEZhbGxiYWNrV2FybXVwUXVlc3Rpb24obGV2ZWw6IHN0cmluZywgY29udGVudEFuYWx5c2lzOiBhbnksIHF1ZXN0aW9uSW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgY29uc3QgdG9waWMgPSBjb250ZW50QW5hbHlzaXMudG9waWNzWzBdIHx8ICd0aGlzIHRvcGljJ1xuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gY29udGVudEFuYWx5c2lzLmNvbnRlbnRUeXBlXG4gICAgXG4gICAgY29uc3QgZmFsbGJhY2tRdWVzdGlvbnMgPSB7XG4gICAgICAnQTEnOiBbXG4gICAgICAgIGBEbyB5b3Uga25vdyBhYm91dCAke3RvcGljLnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBJcyAke3RvcGljLnRvTG93ZXJDYXNlKCl9IGltcG9ydGFudCBpbiB5b3VyIGNvdW50cnk/YCxcbiAgICAgICAgYERvIHlvdSBsaWtlIHRvIHJlYWQgYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gXG4gICAgICBdLFxuICAgICAgJ0EyJzogW1xuICAgICAgICBgSGF2ZSB5b3UgaGVhcmQgYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBiZWZvcmU/YCxcbiAgICAgICAgYFdoYXQgZG8geW91IGtub3cgYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgSXMgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBkaWZmZXJlbnQgaW4geW91ciBjb3VudHJ5P2BcbiAgICAgIF0sXG4gICAgICAnQjEnOiBbXG4gICAgICAgIGBXaGF0IGRvIHlvdSB0aGluayBhYm91dCAke3RvcGljLnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBIb3cgaXMgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBpbXBvcnRhbnQgaW4geW91ciBkYWlseSBsaWZlP2AsXG4gICAgICAgIGBXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGtub3cgYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gXG4gICAgICBdLFxuICAgICAgJ0IyJzogW1xuICAgICAgICBgV2hhdCBhcmUgeW91ciB0aG91Z2h0cyBvbiAke3RvcGljLnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBIb3cgbWlnaHQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBhZmZlY3QgcGVvcGxlIGluIGRpZmZlcmVudCBjb3VudHJpZXM/YCxcbiAgICAgICAgYFdoYXQgcXVlc3Rpb25zIHdvdWxkIHlvdSBhc2sgYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gXG4gICAgICBdLFxuICAgICAgJ0MxJzogW1xuICAgICAgICBgSG93IGRvIGN1bHR1cmFsIHBlcnNwZWN0aXZlcyBpbmZsdWVuY2UgYXR0aXR1ZGVzIHRvd2FyZCAke3RvcGljLnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBXaGF0IGFyZSB0aGUgYnJvYWRlciBpbXBsaWNhdGlvbnMgb2YgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBpbiBtb2Rlcm4gc29jaWV0eT9gLFxuICAgICAgICBgSG93IG1pZ2h0ICR7dG9waWMudG9Mb3dlckNhc2UoKX0gZXZvbHZlIGluIHRoZSBjb21pbmcgeWVhcnM/YFxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICBjb25zdCBsZXZlbFF1ZXN0aW9ucyA9IGZhbGxiYWNrUXVlc3Rpb25zW2xldmVsXSB8fCBmYWxsYmFja1F1ZXN0aW9uc1snQjEnXVxuICAgIHJldHVybiBsZXZlbFF1ZXN0aW9uc1txdWVzdGlvbkluZGV4XSB8fCBsZXZlbFF1ZXN0aW9uc1swXVxuICB9XG5cbiAgLy8gQ29udGV4dHVhbCB3YXJtLXVwIGZhbGxiYWNrIHdoZW4gQUkgZmFpbHNcbiAgcHJpdmF0ZSBnZXRDb250ZXh0dWFsV2FybXVwRmFsbGJhY2sobGV2ZWw6IHN0cmluZywgY29udGVudEFuYWx5c2lzOiBhbnksIG1ldGFkYXRhPzogYW55KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHRvcGljID0gY29udGVudEFuYWx5c2lzLnRvcGljc1swXSB8fCAndGhpcyB0b3BpYydcbiAgICBjb25zdCBzb3VyY2VDb3VudHJ5ID0gY29udGVudEFuYWx5c2lzLnNvdXJjZUNvdW50cnkgfHwgJ3RoaXMgY291bnRyeSdcbiAgICBjb25zdCB0aXRsZSA9IG1ldGFkYXRhPy50aXRsZSB8fCAndGhpcyBjb250ZW50J1xuICAgIFxuICAgIGNvbnN0IGZhbGxiYWNrU2V0cyA9IHtcbiAgICAgICdBMSc6IFtcbiAgICAgICAgYERvIHlvdSBrbm93IGFib3V0ICR7dG9waWMudG9Mb3dlckNhc2UoKX0/YCxcbiAgICAgICAgYElzIHRoaXMgdG9waWMgY29tbW9uIGluIHlvdXIgY291bnRyeT9gLFxuICAgICAgICBgRG8geW91IHdhbnQgdG8gbGVhcm4gYWJvdXQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gXG4gICAgICBdLFxuICAgICAgJ0EyJzogW1xuICAgICAgICBgSGF2ZSB5b3UgZXhwZXJpZW5jZWQgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBiZWZvcmU/YCxcbiAgICAgICAgYFdoYXQgaXMgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBsaWtlIGluIHlvdXIgY291bnRyeT9gLFxuICAgICAgICBgV2h5IGlzICR7dG9waWMudG9Mb3dlckNhc2UoKX0gaW50ZXJlc3RpbmcgdG8geW91P2BcbiAgICAgIF0sXG4gICAgICAnQjEnOiBbXG4gICAgICAgIGBXaGF0IGRvIHlvdSB0aGluayBhYm91dCAke3RvcGljLnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBIb3cgaXMgJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBkaWZmZXJlbnQgaW4geW91ciBjb3VudHJ5IGNvbXBhcmVkIHRvICR7c291cmNlQ291bnRyeX0/YCxcbiAgICAgICAgYFdoYXQgd291bGQgeW91IGV4cGVjdCB0byBsZWFybiBmcm9tIHRoaXMgJHtjb250ZW50QW5hbHlzaXMuY29udGVudFR5cGV9P2BcbiAgICAgIF0sXG4gICAgICAnQjInOiBbXG4gICAgICAgIGBXaGF0IGFyZSB5b3VyIHRob3VnaHRzIG9uIGhvdyAke3RvcGljLnRvTG93ZXJDYXNlKCl9IGlzIHByZXNlbnRlZCBpbiAke3NvdXJjZUNvdW50cnl9IG1lZGlhP2AsXG4gICAgICAgIGBXaGF0IGNoYWxsZW5nZXMgZG8geW91IHRoaW5rIHBlb3BsZSBmYWNlIHdpdGggJHt0b3BpYy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgSG93IG1pZ2h0IHlvdXIgcGVyc3BlY3RpdmUgb24gJHt0b3BpYy50b0xvd2VyQ2FzZSgpfSBkaWZmZXIgZnJvbSB0aGUgYXV0aG9yJ3M/YFxuICAgICAgXSxcbiAgICAgICdDMSc6IFtcbiAgICAgICAgYEhvdyBkbyBjdWx0dXJhbCBhdHRpdHVkZXMgdG93YXJkICR7dG9waWMudG9Mb3dlckNhc2UoKX0gdmFyeSBiZXR3ZWVuICR7c291cmNlQ291bnRyeX0gYW5kIHlvdXIgY291bnRyeT9gLFxuICAgICAgICBgV2hhdCBhcmUgdGhlIGJyb2FkZXIgc29jaWV0YWwgaW1wbGljYXRpb25zIG9mICR7dG9waWMudG9Mb3dlckNhc2UoKX0/YCxcbiAgICAgICAgYEhvdyBtaWdodCB0aGUgcGVyc3BlY3RpdmUgaW4gdGhpcyAke2NvbnRlbnRBbmFseXNpcy5jb250ZW50VHlwZX0gcmVmbGVjdCAke3NvdXJjZUNvdW50cnl9IHZhbHVlcz9gXG4gICAgICBdXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxsYmFja1NldHNbbGV2ZWxdIHx8IGZhbGxiYWNrU2V0c1snQjEnXVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBsZXNzb25BSVNlcnZlckdlbmVyYXRvciA9IG5ldyBMZXNzb25BSVNlcnZlckdlbmVyYXRvcigpXG4iXSwibmFtZXMiOlsiY3JlYXRlR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIiwiTGVzc29uQUlTZXJ2ZXJHZW5lcmF0b3IiLCJnZXRHb29nbGVBSSIsImdvb2dsZUFJIiwiZ2VuZXJhdGVMZXNzb24iLCJwYXJhbXMiLCJzb3VyY2VUZXh0IiwibGVzc29uVHlwZSIsInN0dWRlbnRMZXZlbCIsInRhcmdldExhbmd1YWdlIiwic291cmNlVXJsIiwiY29udGVudE1ldGFkYXRhIiwic3RydWN0dXJlZENvbnRlbnQiLCJ3b3JkQ291bnQiLCJyZWFkaW5nVGltZSIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0TGVuZ3RoIiwibGVuZ3RoIiwiaGFzTWV0YWRhdGEiLCJoYXNTdHJ1Y3R1cmVkQ29udGVudCIsImNvbnRlbnRBbmFseXNpcyIsImFuYWx5emVDb250ZW50Q29udGV4dCIsImNvbnRleHR1YWxTdW1tYXJ5IiwiY3JlYXRlQ29udGV4dHVhbFN1bW1hcnkiLCJ0cmFuc2xhdGVkQ29udGVudCIsInRyYW5zbGF0ZSIsImdldExhbmd1YWdlQ29kZSIsImxlc3NvblN0cnVjdHVyZSIsImdlbmVyYXRlQ29udGV4dHVhbExlc3NvblN0cnVjdHVyZSIsIk9iamVjdCIsImtleXMiLCJkZXRhaWxlZExlc3NvbiIsImdlbmVyYXRlRGV0YWlsZWRDb250ZXh0dWFsQ29udGVudCIsInBvbGlzaGVkTGVzc29uIiwicHJvb2ZyZWFkTGVzc29uIiwiZXJyb3IiLCJnZW5lcmF0ZUVuaGFuY2VkRmFsbGJhY2tMZXNzb24iLCJtZXRhZGF0YSIsImFuYWx5c2lzIiwiY29udGVudFR5cGUiLCJkb21haW4iLCJjb21wbGV4aXR5IiwidG9waWNzIiwia2V5Vm9jYWJ1bGFyeSIsImN1bHR1cmFsQ29udGV4dCIsImxlYXJuaW5nT2JqZWN0aXZlcyIsImRpZmZpY3VsdHkiLCJ0aXRsZSIsInNvdXJjZUNvdW50cnkiLCJkZXRlcm1pbmVTb3VyY2VDb3VudHJ5Iiwic2VudGVuY2VzIiwic3BsaXQiLCJmaWx0ZXIiLCJzIiwidHJpbSIsImF2Z1NlbnRlbmNlTGVuZ3RoIiwicmVkdWNlIiwic3VtIiwiY29tcGxleFdvcmRzIiwibWF0Y2giLCJ0b3RhbFdvcmRzIiwidG9waWNzUHJvbXB0Iiwic3Vic3RyaW5nIiwidG9waWNzUmVzcG9uc2UiLCJwcm9tcHQiLCJ0ZW1wZXJhdHVyZSIsIm1heFRva2VucyIsInBhcnNlTGlzdEZyb21UZXh0Iiwic2xpY2UiLCJ3YXJuIiwibWVzc2FnZSIsImV4dHJhY3RUb3BpY3NGcm9tSGVhZGluZ3MiLCJoZWFkaW5ncyIsInZvY2FiUHJvbXB0Iiwidm9jYWJSZXNwb25zZSIsImV4dHJhY3RWb2NhYnVsYXJ5RnJvbVRleHQiLCJkZXRlcm1pbmVDdWx0dXJhbENvbnRleHQiLCJnZW5lcmF0ZUxlYXJuaW5nT2JqZWN0aXZlcyIsInN1bW1hcnlQcm9tcHQiLCJqb2luIiwic3VtbWFyeSIsImJhc2ljU3VtbWFyeSIsInN1bW1hcml6ZSIsInR5cGUiLCJnZXRTdW1tYXJ5TGVuZ3RoIiwiZm9ybWF0Iiwic3VtbWFyeUVycm9yIiwiZ2VuZXJhdGVDb250ZXh0dWFsV2FybXVwUXVlc3Rpb25zIiwiY29udGVudCIsImxldmVsSW5zdHJ1Y3Rpb25zIiwid2FybXVwUHJvbXB0IiwicmVzcG9uc2UiLCJxdWVzdGlvbnMiLCJwdXNoIiwiZ2V0RmFsbGJhY2tXYXJtdXBRdWVzdGlvbiIsImdldENvbnRleHR1YWxXYXJtdXBGYWxsYmFjayIsImNvbnRleHR1YWxXYXJtdXAiLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2VkIiwicGFyc2UiLCJwYXJzZUVycm9yIiwianNvbk1hdGNoIiwiY2xlYW5lZCIsImNsZWFuRXJyb3IiLCJjcmVhdGVTdHJ1Y3R1cmVkRmFsbGJhY2siLCJzdHJ1Y3R1cmUiLCJzZWN0aW9ucyIsInZvY2FidWxhcnkiLCJpIiwidm9jYWIiLCJjb250ZXh0dWFsRXhhbXBsZVByb21wdCIsIndvcmQiLCJlbmhhbmNlZEV4YW1wbGUiLCJ3cml0ZSIsInRvbmUiLCJleGFtcGxlIiwiY29udGV4dHVhbE1lYW5pbmdQcm9tcHQiLCJjb250ZXh0dWFsTWVhbmluZyIsImRpc2N1c3Npb24iLCJlbmhhbmNlZERpc2N1c3Npb25Qcm9tcHQiLCJlbmhhbmNlZERpc2N1c3Npb24iLCJyZWFkaW5nIiwic3RydWN0dXJlZFJlYWRpbmdQcm9tcHQiLCJtYXAiLCJoIiwidGV4dCIsImVuaGFuY2VkUmVhZGluZyIsInJld3JpdGUiLCJhdWRpZW5jZSIsImdldEF1ZGllbmNlTGV2ZWwiLCJncmFtbWFyIiwiZm9jdXMiLCJncmFtbWFyRXhhbXBsZXNQcm9tcHQiLCJjb250ZXh0dWFsR3JhbW1hckV4YW1wbGVzIiwiY29udGV4dHVhbEV4YW1wbGVzIiwibGVzc29uIiwic2VjdGlvbnNUb1Byb29mcmVhZCIsInNlY3Rpb25QYXRoIiwidmFsdWUiLCJnZXROZXN0ZWRWYWx1ZSIsInByb29mcmVhZCIsImNoZWNrR3JhbW1hciIsImNoZWNrU3BlbGxpbmciLCJjaGVja1N0eWxlIiwic2V0TmVzdGVkVmFsdWUiLCJjb3JyZWN0ZWRfdGV4dCIsImdlbmVyYXRlRmFsbGJhY2tMZXNzb24iLCJ3YXJtdXAiLCJnZXRUZW1wbGF0ZVdhcm11cCIsImV4dHJhY3RWb2NhYnVsYXJ5Iiwic2ltcGxpZnlUZXh0IiwiY29tcHJlaGVuc2lvbiIsImdldFRlbXBsYXRlQ29tcHJlaGVuc2lvbiIsImdldFRlbXBsYXRlRGlzY3Vzc2lvbiIsImdldFRlbXBsYXRlR3JhbW1hciIsInByb251bmNpYXRpb24iLCJnZXRUZW1wbGF0ZVByb251bmNpYXRpb24iLCJ3cmFwdXAiLCJnZXRUZW1wbGF0ZVdyYXB1cCIsImxldmVsIiwibGVuZ3RoTWFwIiwiQTEiLCJBMiIsIkIxIiwiQjIiLCJDMSIsImxhbmd1YWdlIiwibGFuZ3VhZ2VNYXAiLCJzcGFuaXNoIiwiZnJlbmNoIiwiZ2VybWFuIiwiaXRhbGlhbiIsInBvcnR1Z3Vlc2UiLCJqYXBhbmVzZSIsImtvcmVhbiIsImNoaW5lc2UiLCJsaW5lIiwicmVwbGFjZSIsIm9iaiIsInBhdGgiLCJjdXJyZW50Iiwia2V5IiwibGFzdEtleSIsInBvcCIsInRhcmdldCIsIndvcmRzIiwidG9Mb3dlckNhc2UiLCJ1bmlxdWVXb3JkcyIsIlNldCIsImZhbGxiYWNrIiwibWVhbmluZyIsInRlbXBsYXRlcyIsInRyYXZlbCIsImJ1c2luZXNzIiwic2VsZWN0ZWRXb3JkcyIsIm1heExlbmd0aCIsImxpbWl0IiwiZ3JhbW1hckZvY2kiLCJleGFtcGxlcyIsImV4ZXJjaXNlIiwic2VsZWN0ZWRXb3JkIiwiaXBhIiwicHJhY3RpY2UiLCJjb21wbGV4aXR5VGhyZXNob2xkIiwiY3VsdHVyYWxJbmRpY2F0b3JzIiwiYW1lcmljYW5NYXJrZXJzIiwiYnJpdGlzaE1hcmtlcnMiLCJhbWVyaWNhbkNvdW50IiwibWFya2VyIiwiaW5jbHVkZXMiLCJicml0aXNoQ291bnQiLCJvYmplY3RpdmVzIiwiZm9yRWFjaCIsInRvcGljIiwiY2VmckxldmVsIiwibGV2ZWxNYXAiLCJnZXRDb250ZXh0dWFsV2FybXVwIiwiZXh0cmFjdENvbnRleHR1YWxWb2NhYnVsYXJ5IiwiZ2V0Q29udGV4dHVhbENvbXByZWhlbnNpb24iLCJnZXRDb250ZXh0dWFsRGlzY3Vzc2lvbiIsImdldENvbnRleHR1YWxXcmFwdXAiLCJtb2NrQW5hbHlzaXMiLCJpbmRleCIsImNvbnRleHQiLCJiYXNlUXVlc3Rpb25zIiwiY291bnRyeU1hcCIsImRvbWFpbktleSIsImNvdW50cnkiLCJlbnRyaWVzIiwicXVlc3Rpb25JbmRleCIsImZhbGxiYWNrUXVlc3Rpb25zIiwibGV2ZWxRdWVzdGlvbnMiLCJmYWxsYmFja1NldHMiLCJsZXNzb25BSVNlcnZlckdlbmVyYXRvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/lesson-ai-generator-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createServerSupabaseClient: () => (/* binding */ createServerSupabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\nconst createServerSupabaseClient = ()=>{\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://jbkpnirowdvlwlgheqho.supabase.co\" || 0, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impia3BuaXJvd2R2bHdsZ2hlcWhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MTQ3NTEsImV4cCI6MjA3NDQ5MDc1MX0.FZhruXKDzIkZLhla5oerfs7yzjvTsGLlKTUer34N6N0\" || 0, {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            },\n            set (name, value, options) {\n                cookieStore.set({\n                    name,\n                    value,\n                    ...options\n                });\n            },\n            remove (name, options) {\n                cookieStore.set({\n                    name,\n                    value: \"\",\n                    ...options\n                });\n            }\n        }\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFrRDtBQUNaO0FBRS9CLE1BQU1FLDZCQUE2QjtJQUN4QyxNQUFNQyxjQUFjRixxREFBT0E7SUFFM0IsT0FBT0QsaUVBQWtCQSxDQUN2QkksMENBQW9DLElBQUksR0FDeENBLGtOQUF5QyxJQUFJLEdBQzdDO1FBQ0FILFNBQVM7WUFDUE8sS0FBSUMsSUFBWTtnQkFDZCxPQUFPTixZQUFZSyxHQUFHLENBQUNDLE9BQU9DO1lBQ2hDO1lBQ0FDLEtBQUlGLElBQVksRUFBRUMsS0FBYSxFQUFFRSxPQUFZO2dCQUMzQ1QsWUFBWVEsR0FBRyxDQUFDO29CQUFFRjtvQkFBTUM7b0JBQU8sR0FBR0UsT0FBTztnQkFBQztZQUM1QztZQUNBQyxRQUFPSixJQUFZLEVBQUVHLE9BQVk7Z0JBQy9CVCxZQUFZUSxHQUFHLENBQUM7b0JBQUVGO29CQUFNQyxPQUFPO29CQUFJLEdBQUdFLE9BQU87Z0JBQUM7WUFDaEQ7UUFDRjtJQUNGO0FBQ0YsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzPzA5NGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zc3JcIlxuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIlxuXG5leHBvcnQgY29uc3QgY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQgPSAoKSA9PiB7XG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpXG5cbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgJ2h0dHBzOi8vcGxhY2Vob2xkZXIuc3VwYWJhc2UuY28nLCBcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCAncGxhY2Vob2xkZXIta2V5JywgXG4gICAge1xuICAgIGNvb2tpZXM6IHtcbiAgICAgIGdldChuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGNvb2tpZVN0b3JlLmdldChuYW1lKT8udmFsdWVcbiAgICAgIH0sXG4gICAgICBzZXQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWUsIC4uLm9wdGlvbnMgfSlcbiAgICAgIH0sXG4gICAgICByZW1vdmUobmFtZTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWU6IFwiXCIsIC4uLm9wdGlvbnMgfSlcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJjb29raWVzIiwiY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldCIsIm5hbWUiLCJ2YWx1ZSIsInNldCIsIm9wdGlvbnMiLCJyZW1vdmUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/cookie","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();