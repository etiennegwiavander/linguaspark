"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate-lesson/route";
exports.ids = ["app/api/generate-lesson/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_linguaspark_app_api_generate_lesson_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate-lesson/route.ts */ \"(rsc)/./app/api/generate-lesson/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate-lesson/route\",\n        pathname: \"/api/generate-lesson\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate-lesson/route\"\n    },\n    resolvedPagePath: \"D:\\\\linguaspark\\\\app\\\\api\\\\generate-lesson\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_linguaspark_app_api_generate_lesson_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generate-lesson/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZS1sZXNzb24lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmdlbmVyYXRlLWxlc3NvbiUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmdlbmVyYXRlLWxlc3NvbiUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDbGluZ3Vhc3BhcmslNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNsaW5ndWFzcGFyayZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDSTtBQUNqRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvPzI3ZDQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiRDpcXFxcbGluZ3Vhc3BhcmtcXFxcYXBwXFxcXGFwaVxcXFxnZW5lcmF0ZS1sZXNzb25cXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlLWxlc3NvblwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZ2VuZXJhdGUtbGVzc29uL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiRDpcXFxcbGluZ3Vhc3BhcmtcXFxcYXBwXFxcXGFwaVxcXFxnZW5lcmF0ZS1sZXNzb25cXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/generate-lesson/route.ts":
/*!******************************************!*\
  !*** ./app/api/generate-lesson/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_lesson_ai_generator_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/lesson-ai-generator-server */ \"(rsc)/./lib/lesson-ai-generator-server.ts\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n\n // Updated import to use server-side generator\n\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { sourceText, lessonType, studentLevel, targetLanguage, sourceUrl, contentMetadata, structuredContent, wordCount, readingTime } = body;\n        // Validate required fields\n        if (!sourceText || !lessonType || !studentLevel || !targetLanguage) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing required fields\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate user authentication\n        const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_2__.createServerSupabaseClient)();\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\n        if (authError || !user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Authentication required\"\n            }, {\n                status: 401\n            });\n        }\n        // Generate lesson using enhanced AI pipeline with contextual information\n        const lesson = await _lib_lesson_ai_generator_server__WEBPACK_IMPORTED_MODULE_1__.lessonAIServerGenerator.generateLesson({\n            sourceText,\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sourceUrl,\n            contentMetadata,\n            structuredContent,\n            wordCount,\n            readingTime\n        });\n        console.log(\"\\uD83C\\uDF93 Generated lesson structure:\", {\n            hasLesson: !!lesson,\n            hasSections: !!lesson?.sections,\n            sectionKeys: lesson?.sections ? Object.keys(lesson.sections) : [],\n            lessonType: lesson?.lessonType,\n            studentLevel: lesson?.studentLevel,\n            targetLanguage: lesson?.targetLanguage\n        });\n        // Ensure lesson has proper structure\n        const safeLesson = {\n            lessonType: lesson.lessonType || lessonType,\n            studentLevel: lesson.studentLevel || studentLevel,\n            targetLanguage: lesson.targetLanguage || targetLanguage,\n            sections: {\n                warmup: lesson.sections?.warmup || [\n                    \"What do you already know about this topic?\",\n                    \"Have you had similar experiences?\",\n                    \"What would you like to learn more about?\"\n                ],\n                vocabulary: lesson.sections?.vocabulary || [],\n                reading: lesson.sections?.reading || sourceText.substring(0, 500),\n                comprehension: lesson.sections?.comprehension || [\n                    \"What is the main idea of this text?\",\n                    \"What supporting details can you identify?\"\n                ],\n                discussion: lesson.sections?.discussion || [\n                    \"What is your opinion on this topic?\",\n                    \"How would you handle this situation?\"\n                ],\n                grammar: lesson.sections?.grammar || {\n                    focus: \"Present Perfect Tense\",\n                    examples: [\n                        \"I have learned many new things.\",\n                        \"She has improved her skills.\"\n                    ],\n                    exercise: [\n                        \"I _____ (learn) a lot today.\",\n                        \"They _____ (complete) the project.\"\n                    ]\n                },\n                pronunciation: lesson.sections?.pronunciation || {\n                    word: \"communication\",\n                    ipa: \"/kÉ™ËŒmjuËnÉªËˆkeÉªÊƒÉ™n/\",\n                    practice: \"Practice saying: communication in a sentence.\"\n                },\n                wrapup: lesson.sections?.wrapup || [\n                    \"What new vocabulary did you learn?\",\n                    \"Which concepts need more practice?\"\n                ]\n            }\n        };\n        console.log(\"âœ… Safe lesson structure created with all required sections\");\n        // Save lesson to database\n        const { data: savedLesson, error: saveError } = await supabase.from(\"lessons\").insert({\n            tutor_id: user.id,\n            title: `${lessonType} Lesson - ${new Date().toLocaleDateString()}`,\n            lesson_type: lessonType,\n            student_level: studentLevel,\n            target_language: targetLanguage,\n            source_url: sourceUrl,\n            source_text: sourceText,\n            lesson_data: safeLesson\n        }).select().single();\n        if (saveError) {\n            console.error(\"Error saving lesson:\", saveError);\n            // Return lesson even if save fails\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                lesson: safeLesson\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            lesson: {\n                ...safeLesson,\n                id: savedLesson.id\n            }\n        });\n    } catch (error) {\n        console.error(\"Error generating lesson:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate lesson\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2dlbmVyYXRlLWxlc3Nvbi9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTREO0FBQ2MsQ0FBQyw4Q0FBOEM7QUFDdkQ7QUFFM0QsZUFBZUcsS0FBS0MsT0FBb0I7SUFDN0MsSUFBSTtRQUNGLE1BQU1DLE9BQU8sTUFBTUQsUUFBUUUsSUFBSTtRQUMvQixNQUFNLEVBQ0pDLFVBQVUsRUFDVkMsVUFBVSxFQUNWQyxZQUFZLEVBQ1pDLGNBQWMsRUFDZEMsU0FBUyxFQUNUQyxlQUFlLEVBQ2ZDLGlCQUFpQixFQUNqQkMsU0FBUyxFQUNUQyxXQUFXLEVBQ1osR0FBR1Y7UUFFSiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDRSxjQUFjLENBQUNDLGNBQWMsQ0FBQ0MsZ0JBQWdCLENBQUNDLGdCQUFnQjtZQUNsRSxPQUFPVixxREFBWUEsQ0FBQ00sSUFBSSxDQUFDO2dCQUFFVSxPQUFPO1lBQTBCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUMvRTtRQUVBLCtCQUErQjtRQUMvQixNQUFNQyxXQUFXaEIsZ0ZBQTBCQTtRQUMzQyxNQUFNLEVBQ0ppQixNQUFNLEVBQUVDLElBQUksRUFBRSxFQUNkSixPQUFPSyxTQUFTLEVBQ2pCLEdBQUcsTUFBTUgsU0FBU0ksSUFBSSxDQUFDQyxPQUFPO1FBRS9CLElBQUlGLGFBQWEsQ0FBQ0QsTUFBTTtZQUN0QixPQUFPcEIscURBQVlBLENBQUNNLElBQUksQ0FBQztnQkFBRVUsT0FBTztZQUEwQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDL0U7UUFFQSx5RUFBeUU7UUFDekUsTUFBTU8sU0FBUyxNQUFNdkIsb0ZBQXVCQSxDQUFDd0IsY0FBYyxDQUFDO1lBQzFEbEI7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7WUFDQUM7UUFDRjtRQUVBVyxRQUFRQyxHQUFHLENBQUMsNENBQWtDO1lBQzVDQyxXQUFXLENBQUMsQ0FBQ0o7WUFDYkssYUFBYSxDQUFDLENBQUNMLFFBQVFNO1lBQ3ZCQyxhQUFhUCxRQUFRTSxXQUFXRSxPQUFPQyxJQUFJLENBQUNULE9BQU9NLFFBQVEsSUFBSSxFQUFFO1lBQ2pFdEIsWUFBWWdCLFFBQVFoQjtZQUNwQkMsY0FBY2UsUUFBUWY7WUFDdEJDLGdCQUFnQmMsUUFBUWQ7UUFDMUI7UUFFQSxxQ0FBcUM7UUFDckMsTUFBTXdCLGFBQWE7WUFDakIxQixZQUFZZ0IsT0FBT2hCLFVBQVUsSUFBSUE7WUFDakNDLGNBQWNlLE9BQU9mLFlBQVksSUFBSUE7WUFDckNDLGdCQUFnQmMsT0FBT2QsY0FBYyxJQUFJQTtZQUN6Q29CLFVBQVU7Z0JBQ1JLLFFBQVFYLE9BQU9NLFFBQVEsRUFBRUssVUFBVTtvQkFBQztvQkFBOEM7b0JBQXFDO2lCQUEyQztnQkFDbEtDLFlBQVlaLE9BQU9NLFFBQVEsRUFBRU0sY0FBYyxFQUFFO2dCQUM3Q0MsU0FBU2IsT0FBT00sUUFBUSxFQUFFTyxXQUFXOUIsV0FBVytCLFNBQVMsQ0FBQyxHQUFHO2dCQUM3REMsZUFBZWYsT0FBT00sUUFBUSxFQUFFUyxpQkFBaUI7b0JBQUM7b0JBQXVDO2lCQUE0QztnQkFDcklDLFlBQVloQixPQUFPTSxRQUFRLEVBQUVVLGNBQWM7b0JBQUM7b0JBQXVDO2lCQUF1QztnQkFDMUhDLFNBQVNqQixPQUFPTSxRQUFRLEVBQUVXLFdBQVc7b0JBQ25DQyxPQUFPO29CQUNQQyxVQUFVO3dCQUFDO3dCQUFtQztxQkFBK0I7b0JBQzdFQyxVQUFVO3dCQUFDO3dCQUFnQztxQkFBcUM7Z0JBQ2xGO2dCQUNBQyxlQUFlckIsT0FBT00sUUFBUSxFQUFFZSxpQkFBaUI7b0JBQy9DQyxNQUFNO29CQUNOQyxLQUFLO29CQUNMQyxVQUFVO2dCQUNaO2dCQUNBQyxRQUFRekIsT0FBT00sUUFBUSxFQUFFbUIsVUFBVTtvQkFBQztvQkFBc0M7aUJBQXFDO1lBQ2pIO1FBQ0Y7UUFFQXZCLFFBQVFDLEdBQUcsQ0FBQztRQUVaLDBCQUEwQjtRQUMxQixNQUFNLEVBQUVSLE1BQU0rQixXQUFXLEVBQUVsQyxPQUFPbUMsU0FBUyxFQUFFLEdBQUcsTUFBTWpDLFNBQ25Ea0MsSUFBSSxDQUFDLFdBQ0xDLE1BQU0sQ0FBQztZQUNOQyxVQUFVbEMsS0FBS21DLEVBQUU7WUFDakJDLE9BQU8sQ0FBQyxFQUFFaEQsV0FBVyxVQUFVLEVBQUUsSUFBSWlELE9BQU9DLGtCQUFrQixHQUFHLENBQUM7WUFDbEVDLGFBQWFuRDtZQUNib0QsZUFBZW5EO1lBQ2ZvRCxpQkFBaUJuRDtZQUNqQm9ELFlBQVluRDtZQUNab0QsYUFBYXhEO1lBQ2J5RCxhQUFhOUI7UUFDZixHQUNDK0IsTUFBTSxHQUNOQyxNQUFNO1FBRVQsSUFBSWYsV0FBVztZQUNiekIsUUFBUVYsS0FBSyxDQUFDLHdCQUF3Qm1DO1lBQ3RDLG1DQUFtQztZQUNuQyxPQUFPbkQscURBQVlBLENBQUNNLElBQUksQ0FBQztnQkFBRWtCLFFBQVFVO1lBQVc7UUFDaEQ7UUFFQSxPQUFPbEMscURBQVlBLENBQUNNLElBQUksQ0FBQztZQUN2QmtCLFFBQVE7Z0JBQ04sR0FBR1UsVUFBVTtnQkFDYnFCLElBQUlMLFlBQVlLLEVBQUU7WUFDcEI7UUFDRjtJQUNGLEVBQUUsT0FBT3ZDLE9BQU87UUFDZFUsUUFBUVYsS0FBSyxDQUFDLDRCQUE0QkE7UUFDMUMsT0FBT2hCLHFEQUFZQSxDQUFDTSxJQUFJLENBQUM7WUFBRVUsT0FBTztRQUE0QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUNqRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2FwcC9hcGkvZ2VuZXJhdGUtbGVzc29uL3JvdXRlLnRzPzVhYmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHlwZSBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCJcbmltcG9ydCB7IGxlc3NvbkFJU2VydmVyR2VuZXJhdG9yIH0gZnJvbSBcIkAvbGliL2xlc3Nvbi1haS1nZW5lcmF0b3Itc2VydmVyXCIgLy8gVXBkYXRlZCBpbXBvcnQgdG8gdXNlIHNlcnZlci1zaWRlIGdlbmVyYXRvclxuaW1wb3J0IHsgY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQgfSBmcm9tIFwiQC9saWIvc3VwYWJhc2Utc2VydmVyXCJcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IFxuICAgICAgc291cmNlVGV4dCwgXG4gICAgICBsZXNzb25UeXBlLCBcbiAgICAgIHN0dWRlbnRMZXZlbCwgXG4gICAgICB0YXJnZXRMYW5ndWFnZSwgXG4gICAgICBzb3VyY2VVcmwsXG4gICAgICBjb250ZW50TWV0YWRhdGEsXG4gICAgICBzdHJ1Y3R1cmVkQ29udGVudCxcbiAgICAgIHdvcmRDb3VudCxcbiAgICAgIHJlYWRpbmdUaW1lXG4gICAgfSA9IGJvZHlcblxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgIGlmICghc291cmNlVGV4dCB8fCAhbGVzc29uVHlwZSB8fCAhc3R1ZGVudExldmVsIHx8ICF0YXJnZXRMYW5ndWFnZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyByZXF1aXJlZCBmaWVsZHNcIiB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgdXNlciBhdXRoZW50aWNhdGlvblxuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQoKVxuICAgIGNvbnN0IHtcbiAgICAgIGRhdGE6IHsgdXNlciB9LFxuICAgICAgZXJyb3I6IGF1dGhFcnJvcixcbiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKClcblxuICAgIGlmIChhdXRoRXJyb3IgfHwgIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXCIgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGxlc3NvbiB1c2luZyBlbmhhbmNlZCBBSSBwaXBlbGluZSB3aXRoIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICBjb25zdCBsZXNzb24gPSBhd2FpdCBsZXNzb25BSVNlcnZlckdlbmVyYXRvci5nZW5lcmF0ZUxlc3Nvbih7XG4gICAgICBzb3VyY2VUZXh0LFxuICAgICAgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgc291cmNlVXJsLFxuICAgICAgY29udGVudE1ldGFkYXRhLFxuICAgICAgc3RydWN0dXJlZENvbnRlbnQsXG4gICAgICB3b3JkQ291bnQsXG4gICAgICByZWFkaW5nVGltZSxcbiAgICB9KVxuXG4gICAgY29uc29sZS5sb2coXCLwn46TIEdlbmVyYXRlZCBsZXNzb24gc3RydWN0dXJlOlwiLCB7XG4gICAgICBoYXNMZXNzb246ICEhbGVzc29uLFxuICAgICAgaGFzU2VjdGlvbnM6ICEhbGVzc29uPy5zZWN0aW9ucyxcbiAgICAgIHNlY3Rpb25LZXlzOiBsZXNzb24/LnNlY3Rpb25zID8gT2JqZWN0LmtleXMobGVzc29uLnNlY3Rpb25zKSA6IFtdLFxuICAgICAgbGVzc29uVHlwZTogbGVzc29uPy5sZXNzb25UeXBlLFxuICAgICAgc3R1ZGVudExldmVsOiBsZXNzb24/LnN0dWRlbnRMZXZlbCxcbiAgICAgIHRhcmdldExhbmd1YWdlOiBsZXNzb24/LnRhcmdldExhbmd1YWdlXG4gICAgfSlcblxuICAgIC8vIEVuc3VyZSBsZXNzb24gaGFzIHByb3BlciBzdHJ1Y3R1cmVcbiAgICBjb25zdCBzYWZlTGVzc29uID0ge1xuICAgICAgbGVzc29uVHlwZTogbGVzc29uLmxlc3NvblR5cGUgfHwgbGVzc29uVHlwZSxcbiAgICAgIHN0dWRlbnRMZXZlbDogbGVzc29uLnN0dWRlbnRMZXZlbCB8fCBzdHVkZW50TGV2ZWwsXG4gICAgICB0YXJnZXRMYW5ndWFnZTogbGVzc29uLnRhcmdldExhbmd1YWdlIHx8IHRhcmdldExhbmd1YWdlLFxuICAgICAgc2VjdGlvbnM6IHtcbiAgICAgICAgd2FybXVwOiBsZXNzb24uc2VjdGlvbnM/Lndhcm11cCB8fCBbXCJXaGF0IGRvIHlvdSBhbHJlYWR5IGtub3cgYWJvdXQgdGhpcyB0b3BpYz9cIiwgXCJIYXZlIHlvdSBoYWQgc2ltaWxhciBleHBlcmllbmNlcz9cIiwgXCJXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGxlYXJuIG1vcmUgYWJvdXQ/XCJdLFxuICAgICAgICB2b2NhYnVsYXJ5OiBsZXNzb24uc2VjdGlvbnM/LnZvY2FidWxhcnkgfHwgW10sXG4gICAgICAgIHJlYWRpbmc6IGxlc3Nvbi5zZWN0aW9ucz8ucmVhZGluZyB8fCBzb3VyY2VUZXh0LnN1YnN0cmluZygwLCA1MDApLFxuICAgICAgICBjb21wcmVoZW5zaW9uOiBsZXNzb24uc2VjdGlvbnM/LmNvbXByZWhlbnNpb24gfHwgW1wiV2hhdCBpcyB0aGUgbWFpbiBpZGVhIG9mIHRoaXMgdGV4dD9cIiwgXCJXaGF0IHN1cHBvcnRpbmcgZGV0YWlscyBjYW4geW91IGlkZW50aWZ5P1wiXSxcbiAgICAgICAgZGlzY3Vzc2lvbjogbGVzc29uLnNlY3Rpb25zPy5kaXNjdXNzaW9uIHx8IFtcIldoYXQgaXMgeW91ciBvcGluaW9uIG9uIHRoaXMgdG9waWM/XCIsIFwiSG93IHdvdWxkIHlvdSBoYW5kbGUgdGhpcyBzaXR1YXRpb24/XCJdLFxuICAgICAgICBncmFtbWFyOiBsZXNzb24uc2VjdGlvbnM/LmdyYW1tYXIgfHwge1xuICAgICAgICAgIGZvY3VzOiBcIlByZXNlbnQgUGVyZmVjdCBUZW5zZVwiLFxuICAgICAgICAgIGV4YW1wbGVzOiBbXCJJIGhhdmUgbGVhcm5lZCBtYW55IG5ldyB0aGluZ3MuXCIsIFwiU2hlIGhhcyBpbXByb3ZlZCBoZXIgc2tpbGxzLlwiXSxcbiAgICAgICAgICBleGVyY2lzZTogW1wiSSBfX19fXyAobGVhcm4pIGEgbG90IHRvZGF5LlwiLCBcIlRoZXkgX19fX18gKGNvbXBsZXRlKSB0aGUgcHJvamVjdC5cIl1cbiAgICAgICAgfSxcbiAgICAgICAgcHJvbnVuY2lhdGlvbjogbGVzc29uLnNlY3Rpb25zPy5wcm9udW5jaWF0aW9uIHx8IHtcbiAgICAgICAgICB3b3JkOiBcImNvbW11bmljYXRpb25cIixcbiAgICAgICAgICBpcGE6IFwiL2vJmcuMbWp1y5BuyarLiGtlyarKg8mZbi9cIixcbiAgICAgICAgICBwcmFjdGljZTogXCJQcmFjdGljZSBzYXlpbmc6IGNvbW11bmljYXRpb24gaW4gYSBzZW50ZW5jZS5cIlxuICAgICAgICB9LFxuICAgICAgICB3cmFwdXA6IGxlc3Nvbi5zZWN0aW9ucz8ud3JhcHVwIHx8IFtcIldoYXQgbmV3IHZvY2FidWxhcnkgZGlkIHlvdSBsZWFybj9cIiwgXCJXaGljaCBjb25jZXB0cyBuZWVkIG1vcmUgcHJhY3RpY2U/XCJdXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCLinIUgU2FmZSBsZXNzb24gc3RydWN0dXJlIGNyZWF0ZWQgd2l0aCBhbGwgcmVxdWlyZWQgc2VjdGlvbnNcIilcblxuICAgIC8vIFNhdmUgbGVzc29uIHRvIGRhdGFiYXNlXG4gICAgY29uc3QgeyBkYXRhOiBzYXZlZExlc3NvbiwgZXJyb3I6IHNhdmVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwibGVzc29uc1wiKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHR1dG9yX2lkOiB1c2VyLmlkLFxuICAgICAgICB0aXRsZTogYCR7bGVzc29uVHlwZX0gTGVzc29uIC0gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpfWAsXG4gICAgICAgIGxlc3Nvbl90eXBlOiBsZXNzb25UeXBlLFxuICAgICAgICBzdHVkZW50X2xldmVsOiBzdHVkZW50TGV2ZWwsXG4gICAgICAgIHRhcmdldF9sYW5ndWFnZTogdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICAgIHNvdXJjZV91cmw6IHNvdXJjZVVybCxcbiAgICAgICAgc291cmNlX3RleHQ6IHNvdXJjZVRleHQsXG4gICAgICAgIGxlc3Nvbl9kYXRhOiBzYWZlTGVzc29uLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpXG5cbiAgICBpZiAoc2F2ZUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2F2aW5nIGxlc3NvbjpcIiwgc2F2ZUVycm9yKVxuICAgICAgLy8gUmV0dXJuIGxlc3NvbiBldmVuIGlmIHNhdmUgZmFpbHNcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGxlc3Nvbjogc2FmZUxlc3NvbiB9KVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBsZXNzb246IHtcbiAgICAgICAgLi4uc2FmZUxlc3NvbixcbiAgICAgICAgaWQ6IHNhdmVkTGVzc29uLmlkLFxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIGxlc3NvbjpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGxlc3NvblwiIH0sIHsgc3RhdHVzOiA1MDAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImxlc3NvbkFJU2VydmVyR2VuZXJhdG9yIiwiY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQiLCJQT1NUIiwicmVxdWVzdCIsImJvZHkiLCJqc29uIiwic291cmNlVGV4dCIsImxlc3NvblR5cGUiLCJzdHVkZW50TGV2ZWwiLCJ0YXJnZXRMYW5ndWFnZSIsInNvdXJjZVVybCIsImNvbnRlbnRNZXRhZGF0YSIsInN0cnVjdHVyZWRDb250ZW50Iiwid29yZENvdW50IiwicmVhZGluZ1RpbWUiLCJlcnJvciIsInN0YXR1cyIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsImxlc3NvbiIsImdlbmVyYXRlTGVzc29uIiwiY29uc29sZSIsImxvZyIsImhhc0xlc3NvbiIsImhhc1NlY3Rpb25zIiwic2VjdGlvbnMiLCJzZWN0aW9uS2V5cyIsIk9iamVjdCIsImtleXMiLCJzYWZlTGVzc29uIiwid2FybXVwIiwidm9jYWJ1bGFyeSIsInJlYWRpbmciLCJzdWJzdHJpbmciLCJjb21wcmVoZW5zaW9uIiwiZGlzY3Vzc2lvbiIsImdyYW1tYXIiLCJmb2N1cyIsImV4YW1wbGVzIiwiZXhlcmNpc2UiLCJwcm9udW5jaWF0aW9uIiwid29yZCIsImlwYSIsInByYWN0aWNlIiwid3JhcHVwIiwic2F2ZWRMZXNzb24iLCJzYXZlRXJyb3IiLCJmcm9tIiwiaW5zZXJ0IiwidHV0b3JfaWQiLCJpZCIsInRpdGxlIiwiRGF0ZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsImxlc3Nvbl90eXBlIiwic3R1ZGVudF9sZXZlbCIsInRhcmdldF9sYW5ndWFnZSIsInNvdXJjZV91cmwiLCJzb3VyY2VfdGV4dCIsImxlc3Nvbl9kYXRhIiwic2VsZWN0Iiwic2luZ2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate-lesson/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/google-ai-server.ts":
/*!*********************************!*\
  !*** ./lib/google-ai-server.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createGoogleAIServerService: () => (/* binding */ createGoogleAIServerService)\n/* harmony export */ });\n// Server-side Google AI (Gemini) APIs service layer\nclass GoogleAIServerService {\n    constructor(config){\n        this.model = \"models/gemini-2.5-flash\" // Use actual available model\n        ;\n        this.config = config;\n    }\n    async makeGeminiRequest(prompt, options = {}) {\n        // Try different model names based on actual available models from API\n        const modelsToTry = [\n            \"models/gemini-2.5-flash\",\n            \"models/gemini-2.5-pro\",\n            \"models/gemini-2.0-flash\",\n            \"models/gemini-flash-latest\",\n            \"models/gemini-pro-latest\",\n            \"models/gemini-2.0-flash-001\",\n            \"gemini-2.5-flash\",\n            \"gemini-2.5-pro\",\n            \"gemini-2.0-flash\",\n            \"gemini-flash-latest\",\n            \"gemini-pro-latest\"\n        ];\n        const possibleUrls = [];\n        // Generate URLs for different combinations\n        for (const model of modelsToTry){\n            possibleUrls.push(`${this.config.baseUrl}/v1beta/models/${model}:generateContent?key=${this.config.apiKey}`);\n            possibleUrls.push(`${this.config.baseUrl}/v1/models/${model}:generateContent?key=${this.config.apiKey}`);\n        }\n        const requestBody = {\n            contents: [\n                {\n                    parts: [\n                        {\n                            text: prompt\n                        }\n                    ]\n                }\n            ],\n            generationConfig: {\n                temperature: options.temperature || 0.7,\n                maxOutputTokens: options.maxTokens || 1000,\n                topP: options.topP || 0.9\n            }\n        };\n        console.log(\"\\uD83D\\uDD17 Trying Gemini API endpoints...\");\n        // Try each URL until one works\n        for(let i = 0; i < possibleUrls.length; i++){\n            const url = possibleUrls[i];\n            console.log(`ðŸŒ Attempt ${i + 1}: ${url.replace(this.config.apiKey, \"API_KEY_HIDDEN\")}`);\n            try {\n                const response = await fetch(url, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(requestBody)\n                });\n                console.log(`ðŸ“¡ Response status: ${response.status} ${response.statusText}`);\n                if (response.ok) {\n                    const result = await response.json();\n                    console.log(\"âœ… Successful API response received\");\n                    if (result.candidates && result.candidates[0] && result.candidates[0].content) {\n                        return result.candidates[0].content.parts[0].text;\n                    } else {\n                        console.warn(\"âš ï¸ Invalid response structure:\", result);\n                        throw new Error(\"Invalid response structure from Gemini API\");\n                    }\n                } else {\n                    const errorText = await response.text();\n                    console.warn(`âŒ Attempt ${i + 1} failed:`, response.status, errorText);\n                    // If this is the last attempt, throw the error\n                    if (i === possibleUrls.length - 1) {\n                        throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorText}`);\n                    }\n                }\n            } catch (error) {\n                console.warn(`âŒ Attempt ${i + 1} exception:`, error.message);\n                // If this is the last attempt, throw the error\n                if (i === possibleUrls.length - 1) {\n                    throw error;\n                }\n            }\n        }\n    }\n    async summarize(text, options = {}) {\n        const summaryType = options.type || \"key-points\";\n        const length = options.length || \"medium\";\n        const lengthInstructions = {\n            short: \"in 2-3 sentences\",\n            medium: \"in 4-6 sentences\",\n            long: \"in 7-10 sentences\"\n        };\n        const typeInstructions = {\n            \"key-points\": \"Extract and summarize the key points\",\n            \"tl-dr\": \"Create a TL;DR summary\",\n            \"teaser\": \"Write an engaging teaser summary\",\n            \"headline\": \"Create a headline-style summary\"\n        };\n        const prompt = `${typeInstructions[summaryType]} of the following text ${lengthInstructions[length]}:\n\n${text}\n\nSummary:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.3\n            });\n        } catch (error) {\n            console.error(\"Summarization failed:\", error);\n            // Fallback to simple truncation\n            return text.substring(0, 500) + \"...\";\n        }\n    }\n    async translate(text, options) {\n        const targetLang = this.getLanguageName(options.targetLanguage);\n        const prompt = `Translate the following text to ${targetLang}. Maintain the original meaning and tone:\n\n${text}\n\nTranslation:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.2\n            });\n        } catch (error) {\n            console.error(\"Translation failed:\", error);\n            // Return original text if translation fails\n            return text;\n        }\n    }\n    async prompt(prompt, options = {}) {\n        try {\n            return await this.makeGeminiRequest(prompt, options);\n        } catch (error) {\n            console.error(\"Prompt generation failed:\", error);\n            throw error;\n        }\n    }\n    async write(prompt, options = {}) {\n        const tone = options.tone || \"casual\";\n        const length = options.length || \"medium\";\n        const format = options.format || \"paragraph\";\n        const lengthInstructions = {\n            short: \"Keep it brief and concise\",\n            medium: \"Write a moderate length response\",\n            long: \"Provide a detailed and comprehensive response\"\n        };\n        const formatInstructions = {\n            paragraph: \"Write in paragraph form\",\n            \"bullet-points\": \"Format as bullet points\",\n            \"numbered-list\": \"Format as a numbered list\"\n        };\n        const enhancedPrompt = `${prompt}\n\nInstructions:\n- Tone: ${tone}\n- ${lengthInstructions[length]}\n- ${formatInstructions[format]}\n\nResponse:`;\n        try {\n            return await this.makeGeminiRequest(enhancedPrompt, {\n                temperature: 0.7\n            });\n        } catch (error) {\n            console.error(\"Writing failed:\", error);\n            throw error;\n        }\n    }\n    async rewrite(text, options = {}) {\n        const tone = options.tone || \"casual\";\n        const length = options.length || \"same\";\n        const audience = options.audience || \"general\";\n        const lengthInstructions = {\n            shorter: \"Make it more concise\",\n            longer: \"Expand and add more detail\",\n            same: \"Keep approximately the same length\"\n        };\n        const prompt = `Rewrite the following text with these requirements:\n- Tone: ${tone}\n- Audience: ${audience}\n- Length: ${lengthInstructions[length]}\n\nOriginal text:\n${text}\n\nRewritten text:`;\n        try {\n            return await this.makeGeminiRequest(prompt, {\n                temperature: 0.5\n            });\n        } catch (error) {\n            console.error(\"Rewriting failed:\", error);\n            return text // Return original if rewriting fails\n            ;\n        }\n    }\n    async proofread(text, options = {}) {\n        const checkGrammar = options.checkGrammar !== false;\n        const checkSpelling = options.checkSpelling !== false;\n        const checkStyle = options.checkStyle !== false;\n        const checks = [];\n        if (checkGrammar) checks.push(\"grammar\");\n        if (checkSpelling) checks.push(\"spelling\");\n        if (checkStyle) checks.push(\"style and clarity\");\n        const prompt = `Proofread and correct the following text for ${checks.join(\", \")}. Return only the corrected text:\n\n${text}\n\nCorrected text:`;\n        try {\n            const correctedText = await this.makeGeminiRequest(prompt, {\n                temperature: 0.2\n            });\n            return {\n                corrected_text: correctedText,\n                suggestions: [],\n                errors: []\n            };\n        } catch (error) {\n            console.error(\"Proofreading failed:\", error);\n            return {\n                corrected_text: text,\n                suggestions: [],\n                errors: []\n            };\n        }\n    }\n    getLanguageName(code) {\n        const languageMap = {\n            es: \"Spanish\",\n            fr: \"French\",\n            de: \"German\",\n            it: \"Italian\",\n            pt: \"Portuguese\",\n            ja: \"Japanese\",\n            ko: \"Korean\",\n            zh: \"Chinese\",\n            en: \"English\"\n        };\n        return languageMap[code] || \"English\";\n    }\n}\n// Server-side only initialization\nconst createGoogleAIServerService = ()=>{\n    const apiKey = \"AIzaSyAkDCpwWTPKYftoc1Fdm77P6B00Lj89Lio\";\n    const baseUrl = \"https://generativelanguage.googleapis.com\" || 0;\n    if (!apiKey) {\n        console.warn(\"Google AI API key not found. Lesson generation will use fallback templates.\");\n        // Return a service that will always throw errors, triggering fallbacks\n        return new GoogleAIServerService({\n            apiKey: \"dummy\",\n            baseUrl\n        });\n    }\n    return new GoogleAIServerService({\n        apiKey,\n        baseUrl\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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c291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9nb29nbGUtYWktc2VydmVyLnRzPzUyZDYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gU2VydmVyLXNpZGUgR29vZ2xlIEFJIChHZW1pbmkpIEFQSXMgc2VydmljZSBsYXllclxuaW50ZXJmYWNlIEdvb2dsZUFJQ29uZmlnIHtcbiAgYXBpS2V5OiBzdHJpbmdcbiAgYmFzZVVybDogc3RyaW5nXG59XG5cbmludGVyZmFjZSBTdW1tYXJpemVyT3B0aW9ucyB7XG4gIHR5cGU/OiBcImtleS1wb2ludHNcIiB8IFwidGwtZHJcIiB8IFwidGVhc2VyXCIgfCBcImhlYWRsaW5lXCJcbiAgbGVuZ3RoPzogXCJzaG9ydFwiIHwgXCJtZWRpdW1cIiB8IFwibG9uZ1wiXG4gIGZvcm1hdD86IFwibWFya2Rvd25cIiB8IFwicGxhaW4tdGV4dFwiXG59XG5cbmludGVyZmFjZSBUcmFuc2xhdG9yT3B0aW9ucyB7XG4gIHNvdXJjZUxhbmd1YWdlPzogc3RyaW5nXG4gIHRhcmdldExhbmd1YWdlOiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFByb21wdE9wdGlvbnMge1xuICB0ZW1wZXJhdHVyZT86IG51bWJlclxuICBtYXhUb2tlbnM/OiBudW1iZXJcbiAgdG9wUD86IG51bWJlclxufVxuXG5pbnRlcmZhY2UgV3JpdGVyT3B0aW9ucyB7XG4gIHRvbmU/OiBcImZvcm1hbFwiIHwgXCJjYXN1YWxcIiB8IFwiYWNhZGVtaWNcIiB8IFwiY3JlYXRpdmVcIlxuICBsZW5ndGg/OiBcInNob3J0XCIgfCBcIm1lZGl1bVwiIHwgXCJsb25nXCJcbiAgZm9ybWF0PzogXCJwYXJhZ3JhcGhcIiB8IFwiYnVsbGV0LXBvaW50c1wiIHwgXCJudW1iZXJlZC1saXN0XCJcbn1cblxuaW50ZXJmYWNlIFJld3JpdGVyT3B0aW9ucyB7XG4gIHRvbmU/OiBcImZvcm1hbFwiIHwgXCJjYXN1YWxcIiB8IFwiYWNhZGVtaWNcIiB8IFwiY3JlYXRpdmVcIlxuICBsZW5ndGg/OiBcInNob3J0ZXJcIiB8IFwibG9uZ2VyXCIgfCBcInNhbWVcIlxuICBhdWRpZW5jZT86IFwiZ2VuZXJhbFwiIHwgXCJleHBlcnRcIiB8IFwiYmVnaW5uZXJcIlxufVxuXG5pbnRlcmZhY2UgUHJvb2ZyZWFkZXJPcHRpb25zIHtcbiAgY2hlY2tHcmFtbWFyPzogYm9vbGVhblxuICBjaGVja1NwZWxsaW5nPzogYm9vbGVhblxuICBjaGVja1N0eWxlPzogYm9vbGVhblxuICBzdWdnZXN0SW1wcm92ZW1lbnRzPzogYm9vbGVhblxufVxuXG5jbGFzcyBHb29nbGVBSVNlcnZlclNlcnZpY2Uge1xuICBwcml2YXRlIGNvbmZpZzogR29vZ2xlQUlDb25maWdcbiAgcHJpdmF0ZSBtb2RlbDogc3RyaW5nID0gXCJtb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaFwiIC8vIFVzZSBhY3R1YWwgYXZhaWxhYmxlIG1vZGVsXG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBHb29nbGVBSUNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG1ha2VHZW1pbmlSZXF1ZXN0KHByb21wdDogc3RyaW5nLCBvcHRpb25zOiBhbnkgPSB7fSkge1xuICAgIC8vIFRyeSBkaWZmZXJlbnQgbW9kZWwgbmFtZXMgYmFzZWQgb24gYWN0dWFsIGF2YWlsYWJsZSBtb2RlbHMgZnJvbSBBUElcbiAgICBjb25zdCBtb2RlbHNUb1RyeSA9IFtcbiAgICAgICdtb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICAnbW9kZWxzL2dlbWluaS0yLjUtcHJvJywgXG4gICAgICAnbW9kZWxzL2dlbWluaS0yLjAtZmxhc2gnLFxuICAgICAgJ21vZGVscy9nZW1pbmktZmxhc2gtbGF0ZXN0JyxcbiAgICAgICdtb2RlbHMvZ2VtaW5pLXByby1sYXRlc3QnLFxuICAgICAgJ21vZGVscy9nZW1pbmktMi4wLWZsYXNoLTAwMScsXG4gICAgICAnZ2VtaW5pLTIuNS1mbGFzaCcsXG4gICAgICAnZ2VtaW5pLTIuNS1wcm8nLFxuICAgICAgJ2dlbWluaS0yLjAtZmxhc2gnLFxuICAgICAgJ2dlbWluaS1mbGFzaC1sYXRlc3QnLFxuICAgICAgJ2dlbWluaS1wcm8tbGF0ZXN0J1xuICAgIF1cbiAgICBcbiAgICBjb25zdCBwb3NzaWJsZVVybHMgPSBbXVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIFVSTHMgZm9yIGRpZmZlcmVudCBjb21iaW5hdGlvbnNcbiAgICBmb3IgKGNvbnN0IG1vZGVsIG9mIG1vZGVsc1RvVHJ5KSB7XG4gICAgICBwb3NzaWJsZVVybHMucHVzaChgJHt0aGlzLmNvbmZpZy5iYXNlVXJsfS92MWJldGEvbW9kZWxzLyR7bW9kZWx9OmdlbmVyYXRlQ29udGVudD9rZXk9JHt0aGlzLmNvbmZpZy5hcGlLZXl9YClcbiAgICAgIHBvc3NpYmxlVXJscy5wdXNoKGAke3RoaXMuY29uZmlnLmJhc2VVcmx9L3YxL21vZGVscy8ke21vZGVsfTpnZW5lcmF0ZUNvbnRlbnQ/a2V5PSR7dGhpcy5jb25maWcuYXBpS2V5fWApXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlcXVlc3RCb2R5ID0ge1xuICAgICAgY29udGVudHM6IFt7XG4gICAgICAgIHBhcnRzOiBbe1xuICAgICAgICAgIHRleHQ6IHByb21wdFxuICAgICAgICB9XVxuICAgICAgfV0sXG4gICAgICBnZW5lcmF0aW9uQ29uZmlnOiB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiBvcHRpb25zLnRlbXBlcmF0dXJlIHx8IDAuNyxcbiAgICAgICAgbWF4T3V0cHV0VG9rZW5zOiBvcHRpb25zLm1heFRva2VucyB8fCAxMDAwLFxuICAgICAgICB0b3BQOiBvcHRpb25zLnRvcFAgfHwgMC45LFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi8J+UlyBUcnlpbmcgR2VtaW5pIEFQSSBlbmRwb2ludHMuLi5cIilcblxuICAgIC8vIFRyeSBlYWNoIFVSTCB1bnRpbCBvbmUgd29ya3NcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBvc3NpYmxlVXJscy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgdXJsID0gcG9zc2libGVVcmxzW2ldXG4gICAgICBjb25zb2xlLmxvZyhg8J+MkCBBdHRlbXB0ICR7aSArIDF9OiAke3VybC5yZXBsYWNlKHRoaXMuY29uZmlnLmFwaUtleSwgJ0FQSV9LRVlfSElEREVOJyl9YClcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdEJvZHkpLFxuICAgICAgICB9KVxuXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OhIFJlc3BvbnNlIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlIHJlY2VpdmVkXCIpXG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHJlc3VsdC5jYW5kaWRhdGVzICYmIHJlc3VsdC5jYW5kaWRhdGVzWzBdICYmIHJlc3VsdC5jYW5kaWRhdGVzWzBdLmNvbnRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQuY2FuZGlkYXRlc1swXS5jb250ZW50LnBhcnRzWzBdLnRleHRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwi4pqg77iPIEludmFsaWQgcmVzcG9uc2Ugc3RydWN0dXJlOlwiLCByZXN1bHQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIHN0cnVjdHVyZSBmcm9tIEdlbWluaSBBUElcIilcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpXG4gICAgICAgICAgY29uc29sZS53YXJuKGDinYwgQXR0ZW1wdCAke2kgKyAxfSBmYWlsZWQ6YCwgcmVzcG9uc2Uuc3RhdHVzLCBlcnJvclRleHQpXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSWYgdGhpcyBpcyB0aGUgbGFzdCBhdHRlbXB0LCB0aHJvdyB0aGUgZXJyb3JcbiAgICAgICAgICBpZiAoaSA9PT0gcG9zc2libGVVcmxzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR2VtaW5pIEFQSSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH0gLSAke2Vycm9yVGV4dH1gKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDinYwgQXR0ZW1wdCAke2kgKyAxfSBleGNlcHRpb246YCwgZXJyb3IubWVzc2FnZSlcbiAgICAgICAgXG4gICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGxhc3QgYXR0ZW1wdCwgdGhyb3cgdGhlIGVycm9yXG4gICAgICAgIGlmIChpID09PSBwb3NzaWJsZVVybHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBzdW1tYXJpemUodGV4dDogc3RyaW5nLCBvcHRpb25zOiBTdW1tYXJpemVyT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3Qgc3VtbWFyeVR5cGUgPSBvcHRpb25zLnR5cGUgfHwgXCJrZXktcG9pbnRzXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcIm1lZGl1bVwiXG4gICAgXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnQ6IFwiaW4gMi0zIHNlbnRlbmNlc1wiLFxuICAgICAgbWVkaXVtOiBcImluIDQtNiBzZW50ZW5jZXNcIiwgXG4gICAgICBsb25nOiBcImluIDctMTAgc2VudGVuY2VzXCJcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgXCJrZXktcG9pbnRzXCI6IFwiRXh0cmFjdCBhbmQgc3VtbWFyaXplIHRoZSBrZXkgcG9pbnRzXCIsXG4gICAgICBcInRsLWRyXCI6IFwiQ3JlYXRlIGEgVEw7RFIgc3VtbWFyeVwiLFxuICAgICAgXCJ0ZWFzZXJcIjogXCJXcml0ZSBhbiBlbmdhZ2luZyB0ZWFzZXIgc3VtbWFyeVwiLFxuICAgICAgXCJoZWFkbGluZVwiOiBcIkNyZWF0ZSBhIGhlYWRsaW5lLXN0eWxlIHN1bW1hcnlcIlxuICAgIH1cblxuICAgIGNvbnN0IHByb21wdCA9IGAke3R5cGVJbnN0cnVjdGlvbnNbc3VtbWFyeVR5cGVdfSBvZiB0aGUgZm9sbG93aW5nIHRleHQgJHtsZW5ndGhJbnN0cnVjdGlvbnNbbGVuZ3RoXX06XG5cbiR7dGV4dH1cblxuU3VtbWFyeTpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QocHJvbXB0LCB7IHRlbXBlcmF0dXJlOiAwLjMgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlN1bW1hcml6YXRpb24gZmFpbGVkOlwiLCBlcnJvcilcbiAgICAgIC8vIEZhbGxiYWNrIHRvIHNpbXBsZSB0cnVuY2F0aW9uXG4gICAgICByZXR1cm4gdGV4dC5zdWJzdHJpbmcoMCwgNTAwKSArIFwiLi4uXCJcbiAgICB9XG4gIH1cblxuICBhc3luYyB0cmFuc2xhdGUodGV4dDogc3RyaW5nLCBvcHRpb25zOiBUcmFuc2xhdG9yT3B0aW9ucykge1xuICAgIGNvbnN0IHRhcmdldExhbmcgPSB0aGlzLmdldExhbmd1YWdlTmFtZShvcHRpb25zLnRhcmdldExhbmd1YWdlKVxuICAgIFxuICAgIGNvbnN0IHByb21wdCA9IGBUcmFuc2xhdGUgdGhlIGZvbGxvd2luZyB0ZXh0IHRvICR7dGFyZ2V0TGFuZ30uIE1haW50YWluIHRoZSBvcmlnaW5hbCBtZWFuaW5nIGFuZCB0b25lOlxuXG4ke3RleHR9XG5cblRyYW5zbGF0aW9uOmBcblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5tYWtlR2VtaW5pUmVxdWVzdChwcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuMiB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNsYXRpb24gZmFpbGVkOlwiLCBlcnJvcilcbiAgICAgIC8vIFJldHVybiBvcmlnaW5hbCB0ZXh0IGlmIHRyYW5zbGF0aW9uIGZhaWxzXG4gICAgICByZXR1cm4gdGV4dFxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb21wdChwcm9tcHQ6IHN0cmluZywgb3B0aW9uczogUHJvbXB0T3B0aW9ucyA9IHt9KSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLm1ha2VHZW1pbmlSZXF1ZXN0KHByb21wdCwgb3B0aW9ucylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlByb21wdCBnZW5lcmF0aW9uIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHdyaXRlKHByb21wdDogc3RyaW5nLCBvcHRpb25zOiBXcml0ZXJPcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB0b25lID0gb3B0aW9ucy50b25lIHx8IFwiY2FzdWFsXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcIm1lZGl1bVwiXG4gICAgY29uc3QgZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQgfHwgXCJwYXJhZ3JhcGhcIlxuXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnQ6IFwiS2VlcCBpdCBicmllZiBhbmQgY29uY2lzZVwiLFxuICAgICAgbWVkaXVtOiBcIldyaXRlIGEgbW9kZXJhdGUgbGVuZ3RoIHJlc3BvbnNlXCIsXG4gICAgICBsb25nOiBcIlByb3ZpZGUgYSBkZXRhaWxlZCBhbmQgY29tcHJlaGVuc2l2ZSByZXNwb25zZVwiXG4gICAgfVxuXG4gICAgY29uc3QgZm9ybWF0SW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgcGFyYWdyYXBoOiBcIldyaXRlIGluIHBhcmFncmFwaCBmb3JtXCIsXG4gICAgICBcImJ1bGxldC1wb2ludHNcIjogXCJGb3JtYXQgYXMgYnVsbGV0IHBvaW50c1wiLFxuICAgICAgXCJudW1iZXJlZC1saXN0XCI6IFwiRm9ybWF0IGFzIGEgbnVtYmVyZWQgbGlzdFwiXG4gICAgfVxuXG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgJHtwcm9tcHR9XG5cbkluc3RydWN0aW9uczpcbi0gVG9uZTogJHt0b25lfVxuLSAke2xlbmd0aEluc3RydWN0aW9uc1tsZW5ndGhdfVxuLSAke2Zvcm1hdEluc3RydWN0aW9uc1tmb3JtYXRdfVxuXG5SZXNwb25zZTpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QoZW5oYW5jZWRQcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuNyB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiV3JpdGluZyBmYWlsZWQ6XCIsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyByZXdyaXRlKHRleHQ6IHN0cmluZywgb3B0aW9uczogUmV3cml0ZXJPcHRpb25zID0ge30pIHtcbiAgICBjb25zdCB0b25lID0gb3B0aW9ucy50b25lIHx8IFwiY2FzdWFsXCJcbiAgICBjb25zdCBsZW5ndGggPSBvcHRpb25zLmxlbmd0aCB8fCBcInNhbWVcIlxuICAgIGNvbnN0IGF1ZGllbmNlID0gb3B0aW9ucy5hdWRpZW5jZSB8fCBcImdlbmVyYWxcIlxuXG4gICAgY29uc3QgbGVuZ3RoSW5zdHJ1Y3Rpb25zID0ge1xuICAgICAgc2hvcnRlcjogXCJNYWtlIGl0IG1vcmUgY29uY2lzZVwiLFxuICAgICAgbG9uZ2VyOiBcIkV4cGFuZCBhbmQgYWRkIG1vcmUgZGV0YWlsXCIsXG4gICAgICBzYW1lOiBcIktlZXAgYXBwcm94aW1hdGVseSB0aGUgc2FtZSBsZW5ndGhcIlxuICAgIH1cblxuICAgIGNvbnN0IHByb21wdCA9IGBSZXdyaXRlIHRoZSBmb2xsb3dpbmcgdGV4dCB3aXRoIHRoZXNlIHJlcXVpcmVtZW50czpcbi0gVG9uZTogJHt0b25lfVxuLSBBdWRpZW5jZTogJHthdWRpZW5jZX1cbi0gTGVuZ3RoOiAke2xlbmd0aEluc3RydWN0aW9uc1tsZW5ndGhdfVxuXG5PcmlnaW5hbCB0ZXh0OlxuJHt0ZXh0fVxuXG5SZXdyaXR0ZW4gdGV4dDpgXG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMubWFrZUdlbWluaVJlcXVlc3QocHJvbXB0LCB7IHRlbXBlcmF0dXJlOiAwLjUgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlJld3JpdGluZyBmYWlsZWQ6XCIsIGVycm9yKVxuICAgICAgcmV0dXJuIHRleHQgLy8gUmV0dXJuIG9yaWdpbmFsIGlmIHJld3JpdGluZyBmYWlsc1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb29mcmVhZCh0ZXh0OiBzdHJpbmcsIG9wdGlvbnM6IFByb29mcmVhZGVyT3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgY2hlY2tHcmFtbWFyID0gb3B0aW9ucy5jaGVja0dyYW1tYXIgIT09IGZhbHNlXG4gICAgY29uc3QgY2hlY2tTcGVsbGluZyA9IG9wdGlvbnMuY2hlY2tTcGVsbGluZyAhPT0gZmFsc2VcbiAgICBjb25zdCBjaGVja1N0eWxlID0gb3B0aW9ucy5jaGVja1N0eWxlICE9PSBmYWxzZVxuXG4gICAgY29uc3QgY2hlY2tzID0gW11cbiAgICBpZiAoY2hlY2tHcmFtbWFyKSBjaGVja3MucHVzaChcImdyYW1tYXJcIilcbiAgICBpZiAoY2hlY2tTcGVsbGluZykgY2hlY2tzLnB1c2goXCJzcGVsbGluZ1wiKVxuICAgIGlmIChjaGVja1N0eWxlKSBjaGVja3MucHVzaChcInN0eWxlIGFuZCBjbGFyaXR5XCIpXG5cbiAgICBjb25zdCBwcm9tcHQgPSBgUHJvb2ZyZWFkIGFuZCBjb3JyZWN0IHRoZSBmb2xsb3dpbmcgdGV4dCBmb3IgJHtjaGVja3Muam9pbihcIiwgXCIpfS4gUmV0dXJuIG9ubHkgdGhlIGNvcnJlY3RlZCB0ZXh0OlxuXG4ke3RleHR9XG5cbkNvcnJlY3RlZCB0ZXh0OmBcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb3JyZWN0ZWRUZXh0ID0gYXdhaXQgdGhpcy5tYWtlR2VtaW5pUmVxdWVzdChwcm9tcHQsIHsgdGVtcGVyYXR1cmU6IDAuMiB9KVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29ycmVjdGVkX3RleHQ6IGNvcnJlY3RlZFRleHQsXG4gICAgICAgIHN1Z2dlc3Rpb25zOiBbXSxcbiAgICAgICAgZXJyb3JzOiBbXVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiUHJvb2ZyZWFkaW5nIGZhaWxlZDpcIiwgZXJyb3IpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb3JyZWN0ZWRfdGV4dDogdGV4dCxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFtdLFxuICAgICAgICBlcnJvcnM6IFtdXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYW5ndWFnZU5hbWUoY29kZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBsYW5ndWFnZU1hcCA9IHtcbiAgICAgIGVzOiBcIlNwYW5pc2hcIixcbiAgICAgIGZyOiBcIkZyZW5jaFwiLCBcbiAgICAgIGRlOiBcIkdlcm1hblwiLFxuICAgICAgaXQ6IFwiSXRhbGlhblwiLFxuICAgICAgcHQ6IFwiUG9ydHVndWVzZVwiLFxuICAgICAgamE6IFwiSmFwYW5lc2VcIixcbiAgICAgIGtvOiBcIktvcmVhblwiLFxuICAgICAgemg6IFwiQ2hpbmVzZVwiLFxuICAgICAgZW46IFwiRW5nbGlzaFwiXG4gICAgfVxuICAgIHJldHVybiBsYW5ndWFnZU1hcFtjb2RlXSB8fCBcIkVuZ2xpc2hcIlxuICB9XG59XG5cbi8vIFNlcnZlci1zaWRlIG9ubHkgaW5pdGlhbGl6YXRpb25cbmV4cG9ydCBjb25zdCBjcmVhdGVHb29nbGVBSVNlcnZlclNlcnZpY2UgPSAoKSA9PiB7XG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0dPT0dMRV9BSV9BUElfS0VZXG4gIGNvbnN0IGJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19HT09HTEVfQUlfQkFTRV9VUkwgfHwgXCJodHRwczovL2dlbmVyYXRpdmVsYW5ndWFnZS5nb29nbGVhcGlzLmNvbVwiXG5cbiAgaWYgKCFhcGlLZXkpIHtcbiAgICBjb25zb2xlLndhcm4oXCJHb29nbGUgQUkgQVBJIGtleSBub3QgZm91bmQuIExlc3NvbiBnZW5lcmF0aW9uIHdpbGwgdXNlIGZhbGxiYWNrIHRlbXBsYXRlcy5cIilcbiAgICAvLyBSZXR1cm4gYSBzZXJ2aWNlIHRoYXQgd2lsbCBhbHdheXMgdGhyb3cgZXJyb3JzLCB0cmlnZ2VyaW5nIGZhbGxiYWNrc1xuICAgIHJldHVybiBuZXcgR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlKHsgYXBpS2V5OiBcImR1bW15XCIsIGJhc2VVcmwgfSlcbiAgfVxuXG4gIHJldHVybiBuZXcgR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlKHsgYXBpS2V5LCBiYXNlVXJsIH0pXG59XG5cbmV4cG9ydCB0eXBlIHsgU3VtbWFyaXplck9wdGlvbnMsIFRyYW5zbGF0b3JPcHRpb25zLCBQcm9tcHRPcHRpb25zLCBXcml0ZXJPcHRpb25zLCBSZXdyaXRlck9wdGlvbnMsIFByb29mcmVhZGVyT3B0aW9ucyB9XG4iXSwibmFtZXMiOlsiR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJtb2RlbCIsIm1ha2VHZW1pbmlSZXF1ZXN0IiwicHJvbXB0Iiwib3B0aW9ucyIsIm1vZGVsc1RvVHJ5IiwicG9zc2libGVVcmxzIiwicHVzaCIsImJhc2VVcmwiLCJhcGlLZXkiLCJyZXF1ZXN0Qm9keSIsImNvbnRlbnRzIiwicGFydHMiLCJ0ZXh0IiwiZ2VuZXJhdGlvbkNvbmZpZyIsInRlbXBlcmF0dXJlIiwibWF4T3V0cHV0VG9rZW5zIiwibWF4VG9rZW5zIiwidG9wUCIsImNvbnNvbGUiLCJsb2ciLCJpIiwibGVuZ3RoIiwidXJsIiwicmVwbGFjZSIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdGF0dXMiLCJzdGF0dXNUZXh0Iiwib2siLCJyZXN1bHQiLCJqc29uIiwiY2FuZGlkYXRlcyIsImNvbnRlbnQiLCJ3YXJuIiwiRXJyb3IiLCJlcnJvclRleHQiLCJlcnJvciIsIm1lc3NhZ2UiLCJzdW1tYXJpemUiLCJzdW1tYXJ5VHlwZSIsInR5cGUiLCJsZW5ndGhJbnN0cnVjdGlvbnMiLCJzaG9ydCIsIm1lZGl1bSIsImxvbmciLCJ0eXBlSW5zdHJ1Y3Rpb25zIiwic3Vic3RyaW5nIiwidHJhbnNsYXRlIiwidGFyZ2V0TGFuZyIsImdldExhbmd1YWdlTmFtZSIsInRhcmdldExhbmd1YWdlIiwid3JpdGUiLCJ0b25lIiwiZm9ybWF0IiwiZm9ybWF0SW5zdHJ1Y3Rpb25zIiwicGFyYWdyYXBoIiwiZW5oYW5jZWRQcm9tcHQiLCJyZXdyaXRlIiwiYXVkaWVuY2UiLCJzaG9ydGVyIiwibG9uZ2VyIiwic2FtZSIsInByb29mcmVhZCIsImNoZWNrR3JhbW1hciIsImNoZWNrU3BlbGxpbmciLCJjaGVja1N0eWxlIiwiY2hlY2tzIiwiam9pbiIsImNvcnJlY3RlZFRleHQiLCJjb3JyZWN0ZWRfdGV4dCIsInN1Z2dlc3Rpb25zIiwiZXJyb3JzIiwiY29kZSIsImxhbmd1YWdlTWFwIiwiZXMiLCJmciIsImRlIiwiaXQiLCJwdCIsImphIiwia28iLCJ6aCIsImVuIiwiY3JlYXRlR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0dPT0dMRV9BSV9BUElfS0VZIiwiTkVYVF9QVUJMSUNfR09PR0xFX0FJX0JBU0VfVVJMIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/google-ai-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/lesson-ai-generator-server.ts":
/*!*******************************************!*\
  !*** ./lib/lesson-ai-generator-server.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LessonAIServerGenerator: () => (/* binding */ LessonAIServerGenerator),\n/* harmony export */   lessonAIServerGenerator: () => (/* binding */ lessonAIServerGenerator)\n/* harmony export */ });\n/* harmony import */ var _google_ai_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./google-ai-server */ \"(rsc)/./lib/google-ai-server.ts\");\n\nclass LessonAIServerGenerator {\n    getGoogleAI() {\n        if (!this.googleAI) {\n            this.googleAI = (0,_google_ai_server__WEBPACK_IMPORTED_MODULE_0__.createGoogleAIServerService)();\n        }\n        return this.googleAI;\n    }\n    async generateLesson(params) {\n        const { sourceText, lessonType, studentLevel, targetLanguage, sourceUrl, contentMetadata, structuredContent, wordCount, readingTime } = params;\n        console.log(\"\\uD83D\\uDE80 Starting AI lesson generation with params:\", {\n            textLength: sourceText.length,\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            hasMetadata: !!contentMetadata,\n            hasStructuredContent: !!structuredContent\n        });\n        try {\n            // Step 1: Analyze content context and complexity\n            console.log(\"\\uD83D\\uDCCA Step 1: Analyzing content context...\");\n            const contentAnalysis = await this.analyzeContentContext(sourceText, contentMetadata, structuredContent, studentLevel);\n            console.log(\"âœ… Content analysis complete:\", contentAnalysis);\n            // Step 2: Create contextual summary based on lesson type and content analysis\n            console.log(\"\\uD83D\\uDCDD Step 2: Creating contextual summary...\");\n            const contextualSummary = await this.createContextualSummary(sourceText, contentAnalysis, lessonType, studentLevel);\n            console.log(\"âœ… Contextual summary created, length:\", contextualSummary.length);\n            // Step 3: Translate if needed (for non-English target languages)\n            let translatedContent = contextualSummary;\n            if (targetLanguage !== \"english\") {\n                console.log(\"\\uD83C\\uDF10 Step 3: Translating to\", targetLanguage);\n                translatedContent = await this.getGoogleAI().translate(contextualSummary, {\n                    targetLanguage: this.getLanguageCode(targetLanguage)\n                });\n                console.log(\"âœ… Translation complete, length:\", translatedContent.length);\n            } else {\n                console.log(\"â­ï¸ Step 3: Skipping translation (target is English)\");\n            }\n            // Step 4: Generate contextual lesson structure\n            console.log(\"\\uD83C\\uDFD7ï¸ Step 4: Generating lesson structure...\");\n            const lessonStructure = await this.generateContextualLessonStructure(translatedContent, contentAnalysis, lessonType, studentLevel, targetLanguage, contentMetadata);\n            console.log(\"âœ… Lesson structure generated:\", Object.keys(lessonStructure));\n            // Step 5: Generate detailed content for each section with context\n            console.log(\"\\uD83D\\uDD27 Step 5: Enhancing lesson content...\");\n            const detailedLesson = await this.generateDetailedContextualContent(lessonStructure, translatedContent, contentAnalysis, lessonType, studentLevel, targetLanguage, structuredContent);\n            console.log(\"âœ… Detailed content generated\");\n            // Step 6: Proofread and polish the final lesson\n            console.log(\"âœ¨ Step 6: Proofreading lesson...\");\n            const polishedLesson = await this.proofreadLesson(detailedLesson);\n            console.log(\"\\uD83C\\uDF89 AI lesson generation complete!\");\n            return polishedLesson;\n        } catch (error) {\n            console.error(\"âŒ Error in AI lesson generation:\", error);\n            console.log(\"\\uD83D\\uDD04 Falling back to enhanced template generation...\");\n            // Fallback to enhanced template-based generation with context\n            return this.generateEnhancedFallbackLesson(params);\n        }\n    }\n    // New method: Analyze content context and complexity\n    async analyzeContentContext(sourceText, metadata, structuredContent, studentLevel) {\n        console.log(\"\\uD83D\\uDD0D Analyzing content context...\");\n        const analysis = {\n            contentType: metadata?.contentType || \"general\",\n            domain: metadata?.domain || \"\",\n            complexity: \"medium\",\n            topics: [],\n            keyVocabulary: [],\n            culturalContext: \"\",\n            learningObjectives: [],\n            difficulty: studentLevel || \"B1\"\n        };\n        // Analyze content complexity based on text characteristics\n        const sentences = sourceText.split(/[.!?]+/).filter((s)=>s.trim().length > 10);\n        const avgSentenceLength = sentences.length > 0 ? sentences.reduce((sum, s)=>sum + s.split(\" \").length, 0) / sentences.length : 0;\n        const complexWords = sourceText.match(/\\b\\w{8,}\\b/g)?.length || 0;\n        const totalWords = sourceText.split(/\\s+/).length;\n        if (avgSentenceLength > 20 || complexWords / totalWords > 0.15) {\n            analysis.complexity = \"high\";\n        } else if (avgSentenceLength < 12 && complexWords / totalWords < 0.08) {\n            analysis.complexity = \"low\";\n        }\n        console.log(\"\\uD83D\\uDCC8 Text complexity analysis:\", {\n            avgSentenceLength,\n            complexWords,\n            totalWords,\n            complexity: analysis.complexity\n        });\n        // Extract key topics using AI\n        try {\n            console.log(\"\\uD83C\\uDFAF Extracting topics using AI...\");\n            const topicsPrompt = `Analyze this content and identify 3-5 main topics or themes. Return only the topics, one per line:\n\n\"${sourceText.substring(0, 1000)}\"\n\nTopics:`;\n            const topicsResponse = await this.getGoogleAI().prompt(topicsPrompt, {\n                temperature: 0.3,\n                maxTokens: 200\n            });\n            console.log(\"\\uD83E\\uDD16 AI topics response:\", topicsResponse);\n            analysis.topics = this.parseListFromText(topicsResponse).slice(0, 5);\n            console.log(\"âœ… Extracted topics:\", analysis.topics);\n        } catch (error) {\n            console.warn(\"âš ï¸ AI topic extraction failed, using fallback:\", error.message);\n            // Fallback topic extraction\n            analysis.topics = this.extractTopicsFromHeadings(structuredContent?.headings || []);\n            console.log(\"\\uD83D\\uDD04 Fallback topics:\", analysis.topics);\n        }\n        // Extract key vocabulary for the target level\n        try {\n            console.log(\"\\uD83D\\uDCDA Extracting vocabulary using AI...\");\n            const vocabPrompt = `Extract 8-10 key vocabulary words from this content that would be appropriate for ${studentLevel} level language learners. Focus on useful, practical words. Return only the words, one per line:\n\n\"${sourceText.substring(0, 800)}\"\n\nVocabulary words:`;\n            const vocabResponse = await this.getGoogleAI().prompt(vocabPrompt, {\n                temperature: 0.2,\n                maxTokens: 300\n            });\n            console.log(\"\\uD83E\\uDD16 AI vocabulary response:\", vocabResponse);\n            analysis.keyVocabulary = this.parseListFromText(vocabResponse).slice(0, 10);\n            console.log(\"âœ… Extracted vocabulary:\", analysis.keyVocabulary);\n        } catch (error) {\n            console.warn(\"âš ï¸ AI vocabulary extraction failed, using fallback:\", error.message);\n            // Fallback vocabulary extraction\n            analysis.keyVocabulary = this.extractVocabularyFromText(sourceText, studentLevel);\n            console.log(\"\\uD83D\\uDD04 Fallback vocabulary:\", analysis.keyVocabulary);\n        }\n        // Determine cultural context\n        if (metadata?.domain) {\n            analysis.culturalContext = this.determineCulturalContext(metadata.domain, sourceText);\n            console.log(\"\\uD83C\\uDF0D Cultural context:\", analysis.culturalContext);\n        }\n        // Generate learning objectives based on content type and lesson type\n        analysis.learningObjectives = this.generateLearningObjectives(analysis.contentType, analysis.topics, studentLevel);\n        console.log(\"\\uD83C\\uDFAF Learning objectives:\", analysis.learningObjectives);\n        return analysis;\n    }\n    // Enhanced contextual summary creation\n    async createContextualSummary(sourceText, contentAnalysis, lessonType, studentLevel) {\n        console.log(\"\\uD83D\\uDCDD Creating contextual summary...\");\n        const summaryPrompt = `Create a focused summary of this content for a ${lessonType} lesson at ${studentLevel} level.\n\nContent type: ${contentAnalysis.contentType}\nMain topics: ${contentAnalysis.topics.join(\", \")}\nComplexity: ${contentAnalysis.complexity}\n\nFocus on aspects most relevant for ${lessonType} learning objectives.\nKeep the summary appropriate for ${studentLevel} CEFR level students.\nWrite 4-6 sentences that capture the key information.\n\nContent: \"${sourceText.substring(0, 1500)}\"\n\nSummary:`;\n        try {\n            console.log(\"\\uD83E\\uDD16 Calling AI for contextual summary...\");\n            const summary = await this.getGoogleAI().prompt(summaryPrompt, {\n                temperature: 0.4,\n                maxTokens: 500\n            });\n            console.log(\"âœ… AI contextual summary created:\", summary.substring(0, 100) + \"...\");\n            return summary;\n        } catch (error) {\n            console.warn(\"âš ï¸ AI contextual summary failed, trying basic summarization:\", error.message);\n            // Fallback to basic summarization\n            try {\n                const basicSummary = await this.getGoogleAI().summarize(sourceText, {\n                    type: \"key-points\",\n                    length: this.getSummaryLength(studentLevel),\n                    format: \"plain-text\"\n                });\n                console.log(\"âœ… Basic AI summary created:\", basicSummary.substring(0, 100) + \"...\");\n                return basicSummary;\n            } catch (summaryError) {\n                console.warn(\"âš ï¸ All AI summarization failed, using text truncation:\", summaryError.message);\n                // Final fallback to simple truncation\n                return sourceText.substring(0, 800) + \"...\";\n            }\n        }\n    }\n    // Enhanced contextual lesson structure generation\n    async generateContextualLessonStructure(content, contentAnalysis, lessonType, studentLevel, targetLanguage, metadata) {\n        console.log(\"\\uD83C\\uDFD7ï¸ Generating contextual lesson structure...\");\n        const prompt = `Create a highly contextual ${lessonType} lesson for ${studentLevel} level students learning ${targetLanguage}.\n\nCONTENT CONTEXT:\n- Content Type: ${contentAnalysis.contentType}\n- Source: ${metadata?.domain || \"web content\"}\n- Main Topics: ${contentAnalysis.topics.join(\", \")}\n- Complexity Level: ${contentAnalysis.complexity}\n- Key Vocabulary: ${contentAnalysis.keyVocabulary.slice(0, 5).join(\", \")}\n- Cultural Context: ${contentAnalysis.culturalContext}\n\nLESSON CONTENT: \"${content.substring(0, 1000)}\"\n\nCreate a JSON structure with these sections, making each section highly relevant to the source content:\n\n{\n  \"warmup\": [\"question 1\", \"question 2\", \"question 3\"],\n  \"vocabulary\": [\n    {\"word\": \"word1\", \"meaning\": \"definition\", \"example\": \"example sentence\"},\n    {\"word\": \"word2\", \"meaning\": \"definition\", \"example\": \"example sentence\"}\n  ],\n  \"reading\": \"adapted reading passage\",\n  \"comprehension\": [\"question 1\", \"question 2\", \"question 3\", \"question 4\"],\n  \"discussion\": [\"question 1\", \"question 2\", \"question 3\"],\n  \"grammar\": {\n    \"focus\": \"grammar topic\",\n    \"examples\": [\"example 1\", \"example 2\"],\n    \"exercise\": [\"exercise 1\", \"exercise 2\"]\n  },\n  \"pronunciation\": {\n    \"word\": \"challenging word\",\n    \"ipa\": \"/pronunciation/\",\n    \"practice\": \"practice sentence\"\n  },\n  \"wrapup\": [\"reflection 1\", \"reflection 2\", \"reflection 3\"]\n}\n\nIMPORTANT: \n- All content must be directly related to and derived from the source material\n- Vocabulary should come from the actual text, not generic word lists\n- Examples should reference the specific content, not generic scenarios\n- Questions should be about the actual topics discussed, not general themes\n\nReturn only valid JSON:`;\n        try {\n            console.log(\"\\uD83E\\uDD16 Calling AI for lesson structure...\");\n            const response = await this.getGoogleAI().prompt(prompt, {\n                temperature: 0.7,\n                maxTokens: 2000\n            });\n            console.log(\"\\uD83E\\uDD16 AI lesson structure response:\", response.substring(0, 200) + \"...\");\n            try {\n                const parsed = JSON.parse(response);\n                console.log(\"âœ… Successfully parsed lesson structure JSON\");\n                return parsed;\n            } catch (parseError) {\n                console.warn(\"âš ï¸ Failed to parse JSON, attempting to clean response...\");\n                // Try to extract JSON from the response\n                const jsonMatch = response.match(/\\{[\\s\\S]*\\}/);\n                if (jsonMatch) {\n                    try {\n                        const cleaned = JSON.parse(jsonMatch[0]);\n                        console.log(\"âœ… Successfully parsed cleaned JSON\");\n                        return cleaned;\n                    } catch (cleanError) {\n                        console.warn(\"âš ï¸ Failed to parse cleaned JSON, using fallback\");\n                    }\n                }\n                // If JSON parsing fails, return a structured fallback\n                return this.createStructuredFallback(content, lessonType, studentLevel);\n            }\n        } catch (error) {\n            console.warn(\"âš ï¸ AI lesson structure generation failed, using fallback:\", error.message);\n            return this.createStructuredFallback(content, lessonType, studentLevel);\n        }\n    }\n    // Enhanced detailed content generation with context\n    async generateDetailedContextualContent(structure, content, contentAnalysis, lessonType, studentLevel, targetLanguage, structuredContent) {\n        // Use Writer API to expand each section with contextual, detailed content\n        const sections = {\n            ...structure\n        };\n        // Enhance vocabulary section with contextual examples\n        if (sections.vocabulary) {\n            for(let i = 0; i < sections.vocabulary.length; i++){\n                const vocab = sections.vocabulary[i];\n                try {\n                    const contextualExamplePrompt = `\nCreate a natural example sentence using the word \"${vocab.word}\" that relates to this content context:\nTopics: ${contentAnalysis.topics.join(\", \")}\nContent type: ${contentAnalysis.contentType}\nLevel: ${studentLevel}\n\nMake the example relevant to the source material and appropriate for ${studentLevel} level students.\n`;\n                    const enhancedExample = await this.getGoogleAI().write(contextualExamplePrompt, {\n                        tone: \"casual\",\n                        length: \"short\"\n                    });\n                    sections.vocabulary[i].example = enhancedExample;\n                    // Add contextual meaning based on source content\n                    const contextualMeaningPrompt = `\nExplain the meaning of \"${vocab.word}\" in the context of: ${contentAnalysis.topics[0] || contentAnalysis.contentType}\nKeep it simple for ${studentLevel} level students.\n`;\n                    const contextualMeaning = await this.getGoogleAI().write(contextualMeaningPrompt, {\n                        tone: \"casual\",\n                        length: \"short\"\n                    });\n                    sections.vocabulary[i].contextualMeaning = contextualMeaning;\n                } catch (error) {\n                    // Keep original if enhancement fails\n                    console.warn(`Failed to enhance vocabulary for ${vocab.word}:`, error);\n                }\n            }\n        }\n        // Enhance discussion questions with specific content references\n        if (sections.discussion) {\n            try {\n                const enhancedDiscussionPrompt = `\nEnhance these discussion questions for a ${lessonType} lesson about ${contentAnalysis.topics.join(\" and \")}:\n${sections.discussion.join(\"\\n\")}\n\nMake them more specific to the content, engaging for ${studentLevel} level students, and encourage deeper thinking about:\n- ${contentAnalysis.topics.slice(0, 3).join(\"\\n- \")}\n\nReturn 3-4 enhanced questions that reference specific aspects of the content.\n`;\n                const enhancedDiscussion = await this.getGoogleAI().write(enhancedDiscussionPrompt, {\n                    tone: \"casual\",\n                    length: \"medium\",\n                    format: \"bullet-points\"\n                });\n                sections.discussion = this.parseListFromText(enhancedDiscussion).slice(0, 4);\n            } catch (error) {\n                console.warn(\"Failed to enhance discussion questions:\", error);\n            }\n        }\n        // Enhance reading section with better structure\n        if (sections.reading && structuredContent?.headings?.length > 0) {\n            try {\n                const structuredReadingPrompt = `\nImprove this reading text by organizing it with clear structure based on these headings from the original:\n${structuredContent.headings.slice(0, 3).map((h)=>`- ${h.text}`).join(\"\\n\")}\n\nOriginal text: \"${sections.reading}\"\n\nCreate a well-structured, ${studentLevel}-appropriate reading passage that maintains the key information but improves readability.\n`;\n                const enhancedReading = await this.getGoogleAI().rewrite(sections.reading, {\n                    tone: \"casual\",\n                    length: \"same\",\n                    audience: this.getAudienceLevel(studentLevel)\n                });\n                sections.reading = enhancedReading;\n            } catch (error) {\n                console.warn(\"Failed to enhance reading section:\", error);\n            }\n        }\n        // Enhance grammar section with content-specific examples\n        if (sections.grammar && sections.grammar.focus) {\n            try {\n                const grammarExamplesPrompt = `\nCreate 3 grammar examples for \"${sections.grammar.focus}\" using vocabulary and concepts from this content:\nTopics: ${contentAnalysis.topics.join(\", \")}\nKey vocabulary: ${contentAnalysis.keyVocabulary.slice(0, 5).join(\", \")}\n\nMake examples relevant to the content and appropriate for ${studentLevel} level.\n`;\n                const contextualGrammarExamples = await this.getGoogleAI().write(grammarExamplesPrompt, {\n                    tone: \"casual\",\n                    length: \"short\",\n                    format: \"bullet-points\"\n                });\n                sections.grammar.contextualExamples = this.parseListFromText(contextualGrammarExamples);\n            } catch (error) {\n                console.warn(\"Failed to enhance grammar examples:\", error);\n            }\n        }\n        return sections;\n    }\n    async proofreadLesson(lesson) {\n        // Proofread key text sections\n        const sectionsToProofread = [\n            \"reading\",\n            \"grammar.examples\",\n            \"pronunciation.practice\"\n        ];\n        for (const sectionPath of sectionsToProofread){\n            const value = this.getNestedValue(lesson, sectionPath);\n            if (typeof value === \"string\") {\n                const proofread = await this.getGoogleAI().proofread(value, {\n                    checkGrammar: true,\n                    checkSpelling: true,\n                    checkStyle: true\n                });\n                this.setNestedValue(lesson, sectionPath, proofread.corrected_text);\n            }\n        }\n        return lesson;\n    }\n    generateFallbackLesson(params) {\n        // Template-based fallback when AI APIs fail\n        const { sourceText, lessonType, studentLevel, targetLanguage } = params;\n        return {\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sections: {\n                warmup: this.getTemplateWarmup(lessonType, studentLevel),\n                vocabulary: this.extractVocabulary(sourceText, studentLevel),\n                reading: this.simplifyText(sourceText, studentLevel),\n                comprehension: this.getTemplateComprehension(lessonType, studentLevel),\n                discussion: this.getTemplateDiscussion(lessonType, studentLevel),\n                grammar: this.getTemplateGrammar(studentLevel),\n                pronunciation: this.getTemplatePronunciation(sourceText),\n                wrapup: this.getTemplateWrapup(lessonType)\n            }\n        };\n    }\n    // Helper methods\n    getSummaryLength(level) {\n        const lengthMap = {\n            A1: \"short\",\n            A2: \"short\",\n            B1: \"medium\",\n            B2: \"medium\",\n            C1: \"long\"\n        };\n        return lengthMap[level] || \"medium\";\n    }\n    getLanguageCode(language) {\n        const languageMap = {\n            spanish: \"es\",\n            french: \"fr\",\n            german: \"de\",\n            italian: \"it\",\n            portuguese: \"pt\",\n            japanese: \"ja\",\n            korean: \"ko\",\n            chinese: \"zh\"\n        };\n        return languageMap[language] || \"en\";\n    }\n    parseListFromText(text) {\n        return text.split(\"\\n\").filter((line)=>line.trim()).map((line)=>line.replace(/^[-â€¢*]\\s*/, \"\").trim()).filter((line)=>line.length > 0).slice(0, 4) // Limit to 4 items\n        ;\n    }\n    getNestedValue(obj, path) {\n        return path.split(\".\").reduce((current, key)=>current?.[key], obj);\n    }\n    setNestedValue(obj, path, value) {\n        const keys = path.split(\".\");\n        const lastKey = keys.pop();\n        const target = keys.reduce((current, key)=>current[key], obj);\n        target[lastKey] = value;\n    }\n    createStructuredFallback(content, lessonType, studentLevel) {\n        console.log(\"\\uD83D\\uDD04 Creating structured fallback lesson...\");\n        // Extract some basic information from content for better fallback\n        const words = content.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ].slice(0, 6);\n        const fallback = {\n            warmup: this.getTemplateWarmup(lessonType, studentLevel),\n            vocabulary: uniqueWords.map((word)=>({\n                    word: word,\n                    meaning: `Definition of ${word}`,\n                    example: `Example sentence with ${word}.`\n                })),\n            reading: this.simplifyText(content, studentLevel),\n            comprehension: this.getTemplateComprehension(lessonType, studentLevel),\n            discussion: this.getTemplateDiscussion(lessonType, studentLevel),\n            grammar: this.getTemplateGrammar(studentLevel),\n            pronunciation: this.getTemplatePronunciation(content),\n            wrapup: this.getTemplateWrapup(lessonType)\n        };\n        console.log(\"âœ… Structured fallback created\");\n        return fallback;\n    }\n    getTemplateWarmup(lessonType, studentLevel) {\n        const templates = {\n            discussion: [\n                \"What do you already know about this topic?\",\n                \"Have you had similar experiences?\",\n                \"What would you like to learn more about?\"\n            ],\n            grammar: [\n                \"What grammar patterns do you notice?\",\n                \"Which sentences seem most complex?\",\n                \"What grammar rules do you remember?\"\n            ],\n            travel: [\n                \"Where would you like to travel next?\",\n                \"What travel experiences have you had?\",\n                \"What travel vocabulary do you know?\"\n            ],\n            business: [\n                \"What business situations are you familiar with?\",\n                \"How do you communicate professionally?\",\n                \"What business terms are challenging?\"\n            ],\n            pronunciation: [\n                \"Which sounds are difficult to pronounce?\",\n                \"How do you practice pronunciation?\",\n                \"What pronunciation goals do you have?\"\n            ]\n        };\n        return templates[lessonType] || templates.discussion;\n    }\n    extractVocabulary(text, studentLevel) {\n        // Simple vocabulary extraction based on word frequency and complexity\n        const words = text.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ];\n        const selectedWords = uniqueWords.slice(0, 6);\n        return selectedWords.map((word)=>({\n                word: word,\n                meaning: `Definition of ${word}`,\n                example: `Example sentence with ${word}.`\n            }));\n    }\n    simplifyText(text, studentLevel) {\n        // Basic text simplification based on level\n        const maxLength = {\n            A1: 200,\n            A2: 300,\n            B1: 400,\n            B2: 500,\n            C1: 600\n        };\n        const limit = maxLength[studentLevel] || 400;\n        return text.substring(0, limit) + (text.length > limit ? \"...\" : \"\");\n    }\n    getTemplateComprehension(lessonType, studentLevel) {\n        return [\n            \"What is the main idea of this text?\",\n            \"What supporting details can you identify?\",\n            \"How does this relate to your experience?\",\n            \"What conclusions can you draw?\"\n        ];\n    }\n    getTemplateDiscussion(lessonType, studentLevel) {\n        const templates = {\n            discussion: [\n                \"What is your opinion on this topic?\",\n                \"How would you handle this situation?\",\n                \"What alternative approaches exist?\"\n            ],\n            business: [\n                \"How would you apply this professionally?\",\n                \"What business challenges does this address?\",\n                \"How would you present this to colleagues?\"\n            ],\n            travel: [\n                \"How would this help while traveling?\",\n                \"What preparations would you make?\",\n                \"How would you share this experience?\"\n            ]\n        };\n        return templates[lessonType] || templates.discussion;\n    }\n    getTemplateGrammar(studentLevel) {\n        const grammarFoci = {\n            A1: \"Present Simple Tense\",\n            A2: \"Past Simple Tense\",\n            B1: \"Present Perfect Tense\",\n            B2: \"Conditional Sentences\",\n            C1: \"Advanced Grammar Structures\"\n        };\n        return {\n            focus: grammarFoci[studentLevel] || \"Present Perfect Tense\",\n            examples: [\n                \"I have learned many new things.\",\n                \"She has improved her skills.\",\n                \"We have discussed this topic.\"\n            ],\n            exercise: [\n                \"I _____ (learn) a lot today.\",\n                \"They _____ (complete) the project.\",\n                \"She _____ (improve) significantly.\"\n            ]\n        };\n    }\n    getTemplatePronunciation(text) {\n        // Extract a challenging word from the text\n        const words = text.match(/\\b[a-z]{6,}\\b/gi) || [\n            \"communication\"\n        ];\n        const selectedWord = words[0] || \"communication\";\n        return {\n            word: selectedWord.toLowerCase(),\n            ipa: \"/kÉ™ËŒmjuËnÉªËˆkeÉªÊƒÉ™n/\",\n            practice: `Practice saying: \"${selectedWord}\" in a sentence.`\n        };\n    }\n    getTemplateWrapup(lessonType) {\n        return [\n            \"What new vocabulary did you learn?\",\n            \"Which concepts need more practice?\",\n            \"How will you use this knowledge?\",\n            \"What questions do you still have?\"\n        ];\n    }\n    // New helper methods for enhanced contextual analysis\n    extractTopicsFromHeadings(headings) {\n        return headings.filter((h)=>h.level <= 3) // Focus on main headings\n        .map((h)=>h.text).slice(0, 5);\n    }\n    extractVocabularyFromText(text, level) {\n        // Extract words based on complexity appropriate for the level\n        const words = text.toLowerCase().match(/\\b[a-z]{4,}\\b/g) || [];\n        const uniqueWords = [\n            ...new Set(words)\n        ];\n        // Filter by complexity based on level\n        const complexityThreshold = {\n            \"A1\": 6,\n            \"A2\": 7,\n            \"B1\": 8,\n            \"B2\": 10,\n            \"C1\": 12\n        };\n        const maxLength = complexityThreshold[level] || 8;\n        return uniqueWords.filter((word)=>word.length <= maxLength && word.length >= 4).slice(0, 8);\n    }\n    determineCulturalContext(domain, text) {\n        // Determine cultural context based on domain and content\n        const culturalIndicators = {\n            \"bbc.com\": \"British English, UK culture\",\n            \"cnn.com\": \"American English, US culture\",\n            \"wikipedia.org\": \"International, encyclopedic\",\n            \"nytimes.com\": \"American English, US perspective\",\n            \"theguardian.com\": \"British English, UK perspective\"\n        };\n        if (culturalIndicators[domain]) {\n            return culturalIndicators[domain];\n        }\n        // Analyze text for cultural markers\n        const americanMarkers = [\n            \"dollar\",\n            \"president\",\n            \"congress\",\n            \"state\",\n            \"federal\"\n        ];\n        const britishMarkers = [\n            \"pound\",\n            \"minister\",\n            \"parliament\",\n            \"council\",\n            \"government\"\n        ];\n        const americanCount = americanMarkers.filter((marker)=>text.toLowerCase().includes(marker)).length;\n        const britishCount = britishMarkers.filter((marker)=>text.toLowerCase().includes(marker)).length;\n        if (americanCount > britishCount) {\n            return \"American English context\";\n        } else if (britishCount > americanCount) {\n            return \"British English context\";\n        }\n        return \"International context\";\n    }\n    generateLearningObjectives(contentType, topics, level) {\n        const objectives = [];\n        // Base objectives on content type\n        switch(contentType){\n            case \"news\":\n                objectives.push(\"Understand current events vocabulary\");\n                objectives.push(\"Practice reading news articles\");\n                break;\n            case \"blog\":\n                objectives.push(\"Learn informal writing style\");\n                objectives.push(\"Understand personal opinions and experiences\");\n                break;\n            case \"tutorial\":\n                objectives.push(\"Follow step-by-step instructions\");\n                objectives.push(\"Learn technical vocabulary\");\n                break;\n            case \"encyclopedia\":\n                objectives.push(\"Understand factual information\");\n                objectives.push(\"Learn academic vocabulary\");\n                break;\n            default:\n                objectives.push(\"Improve reading comprehension\");\n                objectives.push(\"Expand vocabulary knowledge\");\n        }\n        // Add topic-specific objectives\n        topics.slice(0, 2).forEach((topic)=>{\n            objectives.push(`Discuss topics related to ${topic.toLowerCase()}`);\n        });\n        return objectives.slice(0, 4);\n    }\n    getAudienceLevel(cefrLevel) {\n        const levelMap = {\n            \"A1\": \"beginner\",\n            \"A2\": \"beginner\",\n            \"B1\": \"general\",\n            \"B2\": \"general\",\n            \"C1\": \"expert\"\n        };\n        return levelMap[cefrLevel] || \"general\";\n    }\n    // Enhanced fallback lesson generation with context\n    generateEnhancedFallbackLesson(params) {\n        const { sourceText, lessonType, studentLevel, targetLanguage, contentMetadata, structuredContent } = params;\n        // Use available context even in fallback\n        const topics = structuredContent?.headings?.map((h)=>h.text).slice(0, 3) || [];\n        const contentType = contentMetadata?.contentType || \"general\";\n        return {\n            lessonType,\n            studentLevel,\n            targetLanguage,\n            sections: {\n                warmup: this.getContextualWarmup(lessonType, studentLevel, topics, contentType),\n                vocabulary: this.extractContextualVocabulary(sourceText, studentLevel, topics),\n                reading: this.simplifyText(sourceText, studentLevel),\n                comprehension: this.getContextualComprehension(lessonType, studentLevel, topics),\n                discussion: this.getContextualDiscussion(lessonType, studentLevel, topics),\n                grammar: this.getTemplateGrammar(studentLevel),\n                pronunciation: this.getTemplatePronunciation(sourceText),\n                wrapup: this.getContextualWrapup(lessonType, topics)\n            }\n        };\n    }\n    getContextualWarmup(lessonType, studentLevel, topics, contentType) {\n        const baseQuestions = this.getTemplateWarmup(lessonType, studentLevel);\n        if (topics.length > 0) {\n            return [\n                `What do you know about ${topics[0]?.toLowerCase()}?`,\n                `Have you experienced anything related to ${topics[1]?.toLowerCase() || topics[0]?.toLowerCase()}?`,\n                `What would you like to learn about this ${contentType} content?`\n            ];\n        }\n        return baseQuestions;\n    }\n    extractContextualVocabulary(text, studentLevel, topics) {\n        const vocabulary = this.extractVocabulary(text, studentLevel);\n        // Enhance with topic context if available\n        if (topics.length > 0) {\n            return vocabulary.map((vocab, index)=>({\n                    ...vocab,\n                    context: index < topics.length ? `Related to ${topics[index].toLowerCase()}` : vocab.meaning\n                }));\n        }\n        return vocabulary;\n    }\n    getContextualComprehension(lessonType, studentLevel, topics) {\n        const baseQuestions = this.getTemplateComprehension(lessonType, studentLevel);\n        if (topics.length > 0) {\n            return [\n                `What is the main point about ${topics[0]?.toLowerCase()}?`,\n                `How does the text explain ${topics[1]?.toLowerCase() || \"the topic\"}?`,\n                \"What supporting details can you identify?\",\n                \"What conclusions can you draw from this information?\"\n            ];\n        }\n        return baseQuestions;\n    }\n    getContextualDiscussion(lessonType, studentLevel, topics) {\n        const baseQuestions = this.getTemplateDiscussion(lessonType, studentLevel);\n        if (topics.length > 0) {\n            return [\n                `What is your opinion about ${topics[0]?.toLowerCase()}?`,\n                `How would you apply this information about ${topics[1]?.toLowerCase() || \"this topic\"}?`,\n                `What are the implications of what you learned about ${topics[0]?.toLowerCase()}?`\n            ];\n        }\n        return baseQuestions;\n    }\n    getContextualWrapup(lessonType, topics) {\n        if (topics.length > 0) {\n            return [\n                `What new vocabulary did you learn about ${topics[0]?.toLowerCase()}?`,\n                `Which concepts about ${topics[1]?.toLowerCase() || \"this topic\"} need more practice?`,\n                \"How will you use this knowledge in real situations?\",\n                \"What questions do you still have about this content?\"\n            ];\n        }\n        return this.getTemplateWrapup(lessonType);\n    }\n    constructor(){\n        this.googleAI = null;\n    }\n}\nconst lessonAIServerGenerator = new LessonAIServerGenerator();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y0FBYyxDQUFDLENBQUM7Z0JBQ3pELENBQUMsMkNBQTJDLEVBQUVySSxNQUFNLENBQUMsRUFBRSxFQUFFcUksaUJBQWlCLGFBQWEsQ0FBQyxDQUFDO2dCQUN6RixDQUFDLG9EQUFvRCxFQUFFckksTUFBTSxDQUFDLEVBQUUsRUFBRXFJLGNBQWMsQ0FBQyxDQUFDO2FBQ25GO1FBQ0g7UUFFQSxPQUFPb0M7SUFDVDtJQUVRRCxvQkFBb0I1TSxVQUFrQixFQUFFb0MsTUFBZ0IsRUFBWTtRQUMxRSxJQUFJQSxPQUFPekIsTUFBTSxHQUFHLEdBQUc7WUFDckIsT0FBTztnQkFDTCxDQUFDLHdDQUF3QyxFQUFFeUIsTUFBTSxDQUFDLEVBQUUsRUFBRXFJLGNBQWMsQ0FBQyxDQUFDO2dCQUN0RSxDQUFDLHFCQUFxQixFQUFFckksTUFBTSxDQUFDLEVBQUUsRUFBRXFJLGlCQUFpQixhQUFhLG9CQUFvQixDQUFDO2dCQUN0RjtnQkFDQTthQUNEO1FBQ0g7UUFFQSxPQUFPLElBQUksQ0FBQzVCLGlCQUFpQixDQUFDN0k7SUFDaEM7O2FBbjVCUUosV0FBa0U7O0FBbzVCNUU7QUFFTyxNQUFNb04sMEJBQTBCLElBQUl0TiwwQkFBeUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vbGliL2xlc3Nvbi1haS1nZW5lcmF0b3Itc2VydmVyLnRzPzBiYjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlIH0gZnJvbSBcIi4vZ29vZ2xlLWFpLXNlcnZlclwiXG5cbmludGVyZmFjZSBMZXNzb25HZW5lcmF0aW9uUGFyYW1zIHtcbiAgc291cmNlVGV4dDogc3RyaW5nXG4gIGxlc3NvblR5cGU6IHN0cmluZ1xuICBzdHVkZW50TGV2ZWw6IHN0cmluZ1xuICB0YXJnZXRMYW5ndWFnZTogc3RyaW5nXG4gIHNvdXJjZVVybD86IHN0cmluZ1xuICBjb250ZW50TWV0YWRhdGE/OiB7XG4gICAgdGl0bGU/OiBzdHJpbmdcbiAgICBkZXNjcmlwdGlvbj86IHN0cmluZ1xuICAgIGF1dGhvcj86IHN0cmluZ1xuICAgIHB1Ymxpc2hEYXRlPzogc3RyaW5nXG4gICAgY29udGVudFR5cGU/OiBzdHJpbmdcbiAgICBkb21haW4/OiBzdHJpbmdcbiAgICBsYW5ndWFnZT86IHN0cmluZ1xuICAgIGtleXdvcmRzPzogc3RyaW5nW11cbiAgfVxuICBzdHJ1Y3R1cmVkQ29udGVudD86IHtcbiAgICBoZWFkaW5ncz86IEFycmF5PHsgbGV2ZWw6IG51bWJlcjsgdGV4dDogc3RyaW5nIH0+XG4gICAgcGFyYWdyYXBocz86IHN0cmluZ1tdXG4gICAgbGlzdHM/OiBBcnJheTx7IHR5cGU6IHN0cmluZzsgaXRlbXM6IHN0cmluZ1tdIH0+XG4gICAgcXVvdGVzPzogc3RyaW5nW11cbiAgICBpbWFnZXM/OiBBcnJheTx7IGFsdDogc3RyaW5nOyBzcmM6IHN0cmluZyB9PlxuICAgIGxpbmtzPzogQXJyYXk8eyB0ZXh0OiBzdHJpbmc7IHVybDogc3RyaW5nIH0+XG4gIH1cbiAgd29yZENvdW50PzogbnVtYmVyXG4gIHJlYWRpbmdUaW1lPzogbnVtYmVyXG59XG5cbmludGVyZmFjZSBHZW5lcmF0ZWRMZXNzb24ge1xuICBsZXNzb25UeXBlOiBzdHJpbmdcbiAgc3R1ZGVudExldmVsOiBzdHJpbmdcbiAgdGFyZ2V0TGFuZ3VhZ2U6IHN0cmluZ1xuICBzZWN0aW9uczoge1xuICAgIHdhcm11cDogc3RyaW5nW11cbiAgICB2b2NhYnVsYXJ5OiBBcnJheTx7IHdvcmQ6IHN0cmluZzsgbWVhbmluZzogc3RyaW5nOyBleGFtcGxlOiBzdHJpbmcgfT5cbiAgICByZWFkaW5nOiBzdHJpbmdcbiAgICBjb21wcmVoZW5zaW9uOiBzdHJpbmdbXVxuICAgIGRpc2N1c3Npb246IHN0cmluZ1tdXG4gICAgZ3JhbW1hcjoge1xuICAgICAgZm9jdXM6IHN0cmluZ1xuICAgICAgZXhhbXBsZXM6IHN0cmluZ1tdXG4gICAgICBleGVyY2lzZTogc3RyaW5nW11cbiAgICB9XG4gICAgcHJvbnVuY2lhdGlvbjoge1xuICAgICAgd29yZDogc3RyaW5nXG4gICAgICBpcGE6IHN0cmluZ1xuICAgICAgcHJhY3RpY2U6IHN0cmluZ1xuICAgIH1cbiAgICB3cmFwdXA6IHN0cmluZ1tdXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIExlc3NvbkFJU2VydmVyR2VuZXJhdG9yIHtcbiAgcHJpdmF0ZSBnb29nbGVBSTogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlR29vZ2xlQUlTZXJ2ZXJTZXJ2aWNlPiB8IG51bGwgPSBudWxsXG5cbiAgcHJpdmF0ZSBnZXRHb29nbGVBSSgpIHtcbiAgICBpZiAoIXRoaXMuZ29vZ2xlQUkpIHtcbiAgICAgIHRoaXMuZ29vZ2xlQUkgPSBjcmVhdGVHb29nbGVBSVNlcnZlclNlcnZpY2UoKVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5nb29nbGVBSVxuICB9XG5cbiAgYXN5bmMgZ2VuZXJhdGVMZXNzb24ocGFyYW1zOiBMZXNzb25HZW5lcmF0aW9uUGFyYW1zKTogUHJvbWlzZTxHZW5lcmF0ZWRMZXNzb24+IHtcbiAgICBjb25zdCB7IFxuICAgICAgc291cmNlVGV4dCwgXG4gICAgICBsZXNzb25UeXBlLCBcbiAgICAgIHN0dWRlbnRMZXZlbCwgXG4gICAgICB0YXJnZXRMYW5ndWFnZSwgXG4gICAgICBzb3VyY2VVcmwsXG4gICAgICBjb250ZW50TWV0YWRhdGEsXG4gICAgICBzdHJ1Y3R1cmVkQ29udGVudCxcbiAgICAgIHdvcmRDb3VudCxcbiAgICAgIHJlYWRpbmdUaW1lXG4gICAgfSA9IHBhcmFtc1xuXG4gICAgY29uc29sZS5sb2coXCLwn5qAIFN0YXJ0aW5nIEFJIGxlc3NvbiBnZW5lcmF0aW9uIHdpdGggcGFyYW1zOlwiLCB7XG4gICAgICB0ZXh0TGVuZ3RoOiBzb3VyY2VUZXh0Lmxlbmd0aCxcbiAgICAgIGxlc3NvblR5cGUsXG4gICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICB0YXJnZXRMYW5ndWFnZSxcbiAgICAgIGhhc01ldGFkYXRhOiAhIWNvbnRlbnRNZXRhZGF0YSxcbiAgICAgIGhhc1N0cnVjdHVyZWRDb250ZW50OiAhIXN0cnVjdHVyZWRDb250ZW50XG4gICAgfSlcblxuICAgIHRyeSB7XG4gICAgICAvLyBTdGVwIDE6IEFuYWx5emUgY29udGVudCBjb250ZXh0IGFuZCBjb21wbGV4aXR5XG4gICAgICBjb25zb2xlLmxvZyhcIvCfk4ogU3RlcCAxOiBBbmFseXppbmcgY29udGVudCBjb250ZXh0Li4uXCIpXG4gICAgICBjb25zdCBjb250ZW50QW5hbHlzaXMgPSBhd2FpdCB0aGlzLmFuYWx5emVDb250ZW50Q29udGV4dChcbiAgICAgICAgc291cmNlVGV4dCxcbiAgICAgICAgY29udGVudE1ldGFkYXRhLFxuICAgICAgICBzdHJ1Y3R1cmVkQ29udGVudCxcbiAgICAgICAgc3R1ZGVudExldmVsXG4gICAgICApXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBDb250ZW50IGFuYWx5c2lzIGNvbXBsZXRlOlwiLCBjb250ZW50QW5hbHlzaXMpXG5cbiAgICAgIC8vIFN0ZXAgMjogQ3JlYXRlIGNvbnRleHR1YWwgc3VtbWFyeSBiYXNlZCBvbiBsZXNzb24gdHlwZSBhbmQgY29udGVudCBhbmFseXNpc1xuICAgICAgY29uc29sZS5sb2coXCLwn5OdIFN0ZXAgMjogQ3JlYXRpbmcgY29udGV4dHVhbCBzdW1tYXJ5Li4uXCIpXG4gICAgICBjb25zdCBjb250ZXh0dWFsU3VtbWFyeSA9IGF3YWl0IHRoaXMuY3JlYXRlQ29udGV4dHVhbFN1bW1hcnkoXG4gICAgICAgIHNvdXJjZVRleHQsXG4gICAgICAgIGNvbnRlbnRBbmFseXNpcyxcbiAgICAgICAgbGVzc29uVHlwZSxcbiAgICAgICAgc3R1ZGVudExldmVsXG4gICAgICApXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBDb250ZXh0dWFsIHN1bW1hcnkgY3JlYXRlZCwgbGVuZ3RoOlwiLCBjb250ZXh0dWFsU3VtbWFyeS5sZW5ndGgpXG5cbiAgICAgIC8vIFN0ZXAgMzogVHJhbnNsYXRlIGlmIG5lZWRlZCAoZm9yIG5vbi1FbmdsaXNoIHRhcmdldCBsYW5ndWFnZXMpXG4gICAgICBsZXQgdHJhbnNsYXRlZENvbnRlbnQgPSBjb250ZXh0dWFsU3VtbWFyeVxuICAgICAgaWYgKHRhcmdldExhbmd1YWdlICE9PSBcImVuZ2xpc2hcIikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIvCfjJAgU3RlcCAzOiBUcmFuc2xhdGluZyB0b1wiLCB0YXJnZXRMYW5ndWFnZSlcbiAgICAgICAgdHJhbnNsYXRlZENvbnRlbnQgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkudHJhbnNsYXRlKGNvbnRleHR1YWxTdW1tYXJ5LCB7XG4gICAgICAgICAgdGFyZ2V0TGFuZ3VhZ2U6IHRoaXMuZ2V0TGFuZ3VhZ2VDb2RlKHRhcmdldExhbmd1YWdlKSxcbiAgICAgICAgfSlcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgVHJhbnNsYXRpb24gY29tcGxldGUsIGxlbmd0aDpcIiwgdHJhbnNsYXRlZENvbnRlbnQubGVuZ3RoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLij63vuI8gU3RlcCAzOiBTa2lwcGluZyB0cmFuc2xhdGlvbiAodGFyZ2V0IGlzIEVuZ2xpc2gpXCIpXG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNDogR2VuZXJhdGUgY29udGV4dHVhbCBsZXNzb24gc3RydWN0dXJlXG4gICAgICBjb25zb2xlLmxvZyhcIvCfj5fvuI8gU3RlcCA0OiBHZW5lcmF0aW5nIGxlc3NvbiBzdHJ1Y3R1cmUuLi5cIilcbiAgICAgIGNvbnN0IGxlc3NvblN0cnVjdHVyZSA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVDb250ZXh0dWFsTGVzc29uU3RydWN0dXJlKFxuICAgICAgICB0cmFuc2xhdGVkQ29udGVudCxcbiAgICAgICAgY29udGVudEFuYWx5c2lzLFxuICAgICAgICBsZXNzb25UeXBlLFxuICAgICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgICBjb250ZW50TWV0YWRhdGFcbiAgICAgIClcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIExlc3NvbiBzdHJ1Y3R1cmUgZ2VuZXJhdGVkOlwiLCBPYmplY3Qua2V5cyhsZXNzb25TdHJ1Y3R1cmUpKVxuXG4gICAgICAvLyBTdGVwIDU6IEdlbmVyYXRlIGRldGFpbGVkIGNvbnRlbnQgZm9yIGVhY2ggc2VjdGlvbiB3aXRoIGNvbnRleHRcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UpyBTdGVwIDU6IEVuaGFuY2luZyBsZXNzb24gY29udGVudC4uLlwiKVxuICAgICAgY29uc3QgZGV0YWlsZWRMZXNzb24gPSBhd2FpdCB0aGlzLmdlbmVyYXRlRGV0YWlsZWRDb250ZXh0dWFsQ29udGVudChcbiAgICAgICAgbGVzc29uU3RydWN0dXJlLFxuICAgICAgICB0cmFuc2xhdGVkQ29udGVudCxcbiAgICAgICAgY29udGVudEFuYWx5c2lzLFxuICAgICAgICBsZXNzb25UeXBlLFxuICAgICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICAgIHRhcmdldExhbmd1YWdlLFxuICAgICAgICBzdHJ1Y3R1cmVkQ29udGVudFxuICAgICAgKVxuICAgICAgY29uc29sZS5sb2coXCLinIUgRGV0YWlsZWQgY29udGVudCBnZW5lcmF0ZWRcIilcblxuICAgICAgLy8gU3RlcCA2OiBQcm9vZnJlYWQgYW5kIHBvbGlzaCB0aGUgZmluYWwgbGVzc29uXG4gICAgICBjb25zb2xlLmxvZyhcIuKcqCBTdGVwIDY6IFByb29mcmVhZGluZyBsZXNzb24uLi5cIilcbiAgICAgIGNvbnN0IHBvbGlzaGVkTGVzc29uID0gYXdhaXQgdGhpcy5wcm9vZnJlYWRMZXNzb24oZGV0YWlsZWRMZXNzb24pXG4gICAgICBjb25zb2xlLmxvZyhcIvCfjokgQUkgbGVzc29uIGdlbmVyYXRpb24gY29tcGxldGUhXCIpXG5cbiAgICAgIHJldHVybiBwb2xpc2hlZExlc3NvblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGluIEFJIGxlc3NvbiBnZW5lcmF0aW9uOlwiLCBlcnJvcilcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UhCBGYWxsaW5nIGJhY2sgdG8gZW5oYW5jZWQgdGVtcGxhdGUgZ2VuZXJhdGlvbi4uLlwiKVxuICAgICAgLy8gRmFsbGJhY2sgdG8gZW5oYW5jZWQgdGVtcGxhdGUtYmFzZWQgZ2VuZXJhdGlvbiB3aXRoIGNvbnRleHRcbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlRW5oYW5jZWRGYWxsYmFja0xlc3NvbihwYXJhbXMpXG4gICAgfVxuICB9XG5cbiAgLy8gTmV3IG1ldGhvZDogQW5hbHl6ZSBjb250ZW50IGNvbnRleHQgYW5kIGNvbXBsZXhpdHlcbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplQ29udGVudENvbnRleHQoXG4gICAgc291cmNlVGV4dDogc3RyaW5nLFxuICAgIG1ldGFkYXRhPzogYW55LFxuICAgIHN0cnVjdHVyZWRDb250ZW50PzogYW55LFxuICAgIHN0dWRlbnRMZXZlbD86IHN0cmluZ1xuICApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCflI0gQW5hbHl6aW5nIGNvbnRlbnQgY29udGV4dC4uLlwiKVxuICAgIFxuICAgIGNvbnN0IGFuYWx5c2lzID0ge1xuICAgICAgY29udGVudFR5cGU6IG1ldGFkYXRhPy5jb250ZW50VHlwZSB8fCAnZ2VuZXJhbCcsXG4gICAgICBkb21haW46IG1ldGFkYXRhPy5kb21haW4gfHwgJycsXG4gICAgICBjb21wbGV4aXR5OiAnbWVkaXVtJyxcbiAgICAgIHRvcGljczogW10sXG4gICAgICBrZXlWb2NhYnVsYXJ5OiBbXSxcbiAgICAgIGN1bHR1cmFsQ29udGV4dDogJycsXG4gICAgICBsZWFybmluZ09iamVjdGl2ZXM6IFtdLFxuICAgICAgZGlmZmljdWx0eTogc3R1ZGVudExldmVsIHx8ICdCMScsXG4gICAgfVxuXG4gICAgLy8gQW5hbHl6ZSBjb250ZW50IGNvbXBsZXhpdHkgYmFzZWQgb24gdGV4dCBjaGFyYWN0ZXJpc3RpY3NcbiAgICBjb25zdCBzZW50ZW5jZXMgPSBzb3VyY2VUZXh0LnNwbGl0KC9bLiE/XSsvKS5maWx0ZXIocyA9PiBzLnRyaW0oKS5sZW5ndGggPiAxMClcbiAgICBjb25zdCBhdmdTZW50ZW5jZUxlbmd0aCA9IHNlbnRlbmNlcy5sZW5ndGggPiAwID8gc2VudGVuY2VzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLnNwbGl0KCcgJykubGVuZ3RoLCAwKSAvIHNlbnRlbmNlcy5sZW5ndGggOiAwXG4gICAgY29uc3QgY29tcGxleFdvcmRzID0gc291cmNlVGV4dC5tYXRjaCgvXFxiXFx3ezgsfVxcYi9nKT8ubGVuZ3RoIHx8IDBcbiAgICBjb25zdCB0b3RhbFdvcmRzID0gc291cmNlVGV4dC5zcGxpdCgvXFxzKy8pLmxlbmd0aFxuXG4gICAgaWYgKGF2Z1NlbnRlbmNlTGVuZ3RoID4gMjAgfHwgY29tcGxleFdvcmRzIC8gdG90YWxXb3JkcyA+IDAuMTUpIHtcbiAgICAgIGFuYWx5c2lzLmNvbXBsZXhpdHkgPSAnaGlnaCdcbiAgICB9IGVsc2UgaWYgKGF2Z1NlbnRlbmNlTGVuZ3RoIDwgMTIgJiYgY29tcGxleFdvcmRzIC8gdG90YWxXb3JkcyA8IDAuMDgpIHtcbiAgICAgIGFuYWx5c2lzLmNvbXBsZXhpdHkgPSAnbG93J1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi8J+TiCBUZXh0IGNvbXBsZXhpdHkgYW5hbHlzaXM6XCIsIHtcbiAgICAgIGF2Z1NlbnRlbmNlTGVuZ3RoLFxuICAgICAgY29tcGxleFdvcmRzLFxuICAgICAgdG90YWxXb3JkcyxcbiAgICAgIGNvbXBsZXhpdHk6IGFuYWx5c2lzLmNvbXBsZXhpdHlcbiAgICB9KVxuXG4gICAgLy8gRXh0cmFjdCBrZXkgdG9waWNzIHVzaW5nIEFJXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+OryBFeHRyYWN0aW5nIHRvcGljcyB1c2luZyBBSS4uLlwiKVxuICAgICAgY29uc3QgdG9waWNzUHJvbXB0ID0gYEFuYWx5emUgdGhpcyBjb250ZW50IGFuZCBpZGVudGlmeSAzLTUgbWFpbiB0b3BpY3Mgb3IgdGhlbWVzLiBSZXR1cm4gb25seSB0aGUgdG9waWNzLCBvbmUgcGVyIGxpbmU6XG5cblwiJHtzb3VyY2VUZXh0LnN1YnN0cmluZygwLCAxMDAwKX1cIlxuXG5Ub3BpY3M6YFxuICAgICAgXG4gICAgICBjb25zdCB0b3BpY3NSZXNwb25zZSA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9tcHQodG9waWNzUHJvbXB0LCB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICAgIG1heFRva2VuczogMjAwLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLwn6SWIEFJIHRvcGljcyByZXNwb25zZTpcIiwgdG9waWNzUmVzcG9uc2UpXG4gICAgICBhbmFseXNpcy50b3BpY3MgPSB0aGlzLnBhcnNlTGlzdEZyb21UZXh0KHRvcGljc1Jlc3BvbnNlKS5zbGljZSgwLCA1KVxuICAgICAgY29uc29sZS5sb2coXCLinIUgRXh0cmFjdGVkIHRvcGljczpcIiwgYW5hbHlzaXMudG9waWNzKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgdG9waWMgZXh0cmFjdGlvbiBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrOlwiLCBlcnJvci5tZXNzYWdlKVxuICAgICAgLy8gRmFsbGJhY2sgdG9waWMgZXh0cmFjdGlvblxuICAgICAgYW5hbHlzaXMudG9waWNzID0gdGhpcy5leHRyYWN0VG9waWNzRnJvbUhlYWRpbmdzKHN0cnVjdHVyZWRDb250ZW50Py5oZWFkaW5ncyB8fCBbXSlcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UhCBGYWxsYmFjayB0b3BpY3M6XCIsIGFuYWx5c2lzLnRvcGljcylcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IGtleSB2b2NhYnVsYXJ5IGZvciB0aGUgdGFyZ2V0IGxldmVsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+TmiBFeHRyYWN0aW5nIHZvY2FidWxhcnkgdXNpbmcgQUkuLi5cIilcbiAgICAgIGNvbnN0IHZvY2FiUHJvbXB0ID0gYEV4dHJhY3QgOC0xMCBrZXkgdm9jYWJ1bGFyeSB3b3JkcyBmcm9tIHRoaXMgY29udGVudCB0aGF0IHdvdWxkIGJlIGFwcHJvcHJpYXRlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwgbGFuZ3VhZ2UgbGVhcm5lcnMuIEZvY3VzIG9uIHVzZWZ1bCwgcHJhY3RpY2FsIHdvcmRzLiBSZXR1cm4gb25seSB0aGUgd29yZHMsIG9uZSBwZXIgbGluZTpcblxuXCIke3NvdXJjZVRleHQuc3Vic3RyaW5nKDAsIDgwMCl9XCJcblxuVm9jYWJ1bGFyeSB3b3JkczpgXG4gICAgICBcbiAgICAgIGNvbnN0IHZvY2FiUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkucHJvbXB0KHZvY2FiUHJvbXB0LCB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjIsXG4gICAgICAgIG1heFRva2VuczogMzAwLFxuICAgICAgfSlcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coXCLwn6SWIEFJIHZvY2FidWxhcnkgcmVzcG9uc2U6XCIsIHZvY2FiUmVzcG9uc2UpXG4gICAgICBhbmFseXNpcy5rZXlWb2NhYnVsYXJ5ID0gdGhpcy5wYXJzZUxpc3RGcm9tVGV4dCh2b2NhYlJlc3BvbnNlKS5zbGljZSgwLCAxMClcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIEV4dHJhY3RlZCB2b2NhYnVsYXJ5OlwiLCBhbmFseXNpcy5rZXlWb2NhYnVsYXJ5KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgdm9jYWJ1bGFyeSBleHRyYWN0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2s6XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgICAvLyBGYWxsYmFjayB2b2NhYnVsYXJ5IGV4dHJhY3Rpb25cbiAgICAgIGFuYWx5c2lzLmtleVZvY2FidWxhcnkgPSB0aGlzLmV4dHJhY3RWb2NhYnVsYXJ5RnJvbVRleHQoc291cmNlVGV4dCwgc3R1ZGVudExldmVsKVxuICAgICAgY29uc29sZS5sb2coXCLwn5SEIEZhbGxiYWNrIHZvY2FidWxhcnk6XCIsIGFuYWx5c2lzLmtleVZvY2FidWxhcnkpXG4gICAgfVxuXG4gICAgLy8gRGV0ZXJtaW5lIGN1bHR1cmFsIGNvbnRleHRcbiAgICBpZiAobWV0YWRhdGE/LmRvbWFpbikge1xuICAgICAgYW5hbHlzaXMuY3VsdHVyYWxDb250ZXh0ID0gdGhpcy5kZXRlcm1pbmVDdWx0dXJhbENvbnRleHQobWV0YWRhdGEuZG9tYWluLCBzb3VyY2VUZXh0KVxuICAgICAgY29uc29sZS5sb2coXCLwn4yNIEN1bHR1cmFsIGNvbnRleHQ6XCIsIGFuYWx5c2lzLmN1bHR1cmFsQ29udGV4dClcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBsZWFybmluZyBvYmplY3RpdmVzIGJhc2VkIG9uIGNvbnRlbnQgdHlwZSBhbmQgbGVzc29uIHR5cGVcbiAgICBhbmFseXNpcy5sZWFybmluZ09iamVjdGl2ZXMgPSB0aGlzLmdlbmVyYXRlTGVhcm5pbmdPYmplY3RpdmVzKFxuICAgICAgYW5hbHlzaXMuY29udGVudFR5cGUsXG4gICAgICBhbmFseXNpcy50b3BpY3MsXG4gICAgICBzdHVkZW50TGV2ZWxcbiAgICApXG4gICAgY29uc29sZS5sb2coXCLwn46vIExlYXJuaW5nIG9iamVjdGl2ZXM6XCIsIGFuYWx5c2lzLmxlYXJuaW5nT2JqZWN0aXZlcylcblxuICAgIHJldHVybiBhbmFseXNpc1xuICB9XG5cbiAgLy8gRW5oYW5jZWQgY29udGV4dHVhbCBzdW1tYXJ5IGNyZWF0aW9uXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQ29udGV4dHVhbFN1bW1hcnkoXG4gICAgc291cmNlVGV4dDogc3RyaW5nLFxuICAgIGNvbnRlbnRBbmFseXNpczogYW55LFxuICAgIGxlc3NvblR5cGU6IHN0cmluZyxcbiAgICBzdHVkZW50TGV2ZWw6IHN0cmluZ1xuICApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCfk50gQ3JlYXRpbmcgY29udGV4dHVhbCBzdW1tYXJ5Li4uXCIpXG4gICAgXG4gICAgY29uc3Qgc3VtbWFyeVByb21wdCA9IGBDcmVhdGUgYSBmb2N1c2VkIHN1bW1hcnkgb2YgdGhpcyBjb250ZW50IGZvciBhICR7bGVzc29uVHlwZX0gbGVzc29uIGF0ICR7c3R1ZGVudExldmVsfSBsZXZlbC5cblxuQ29udGVudCB0eXBlOiAke2NvbnRlbnRBbmFseXNpcy5jb250ZW50VHlwZX1cbk1haW4gdG9waWNzOiAke2NvbnRlbnRBbmFseXNpcy50b3BpY3Muam9pbignLCAnKX1cbkNvbXBsZXhpdHk6ICR7Y29udGVudEFuYWx5c2lzLmNvbXBsZXhpdHl9XG5cbkZvY3VzIG9uIGFzcGVjdHMgbW9zdCByZWxldmFudCBmb3IgJHtsZXNzb25UeXBlfSBsZWFybmluZyBvYmplY3RpdmVzLlxuS2VlcCB0aGUgc3VtbWFyeSBhcHByb3ByaWF0ZSBmb3IgJHtzdHVkZW50TGV2ZWx9IENFRlIgbGV2ZWwgc3R1ZGVudHMuXG5Xcml0ZSA0LTYgc2VudGVuY2VzIHRoYXQgY2FwdHVyZSB0aGUga2V5IGluZm9ybWF0aW9uLlxuXG5Db250ZW50OiBcIiR7c291cmNlVGV4dC5zdWJzdHJpbmcoMCwgMTUwMCl9XCJcblxuU3VtbWFyeTpgXG5cbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coXCLwn6SWIENhbGxpbmcgQUkgZm9yIGNvbnRleHR1YWwgc3VtbWFyeS4uLlwiKVxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9tcHQoc3VtbWFyeVByb21wdCwge1xuICAgICAgICB0ZW1wZXJhdHVyZTogMC40LFxuICAgICAgICBtYXhUb2tlbnM6IDUwMCxcbiAgICAgIH0pXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBBSSBjb250ZXh0dWFsIHN1bW1hcnkgY3JlYXRlZDpcIiwgc3VtbWFyeS5zdWJzdHJpbmcoMCwgMTAwKSArIFwiLi4uXCIpXG4gICAgICByZXR1cm4gc3VtbWFyeVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgY29udGV4dHVhbCBzdW1tYXJ5IGZhaWxlZCwgdHJ5aW5nIGJhc2ljIHN1bW1hcml6YXRpb246XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgICAvLyBGYWxsYmFjayB0byBiYXNpYyBzdW1tYXJpemF0aW9uXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBiYXNpY1N1bW1hcnkgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkuc3VtbWFyaXplKHNvdXJjZVRleHQsIHtcbiAgICAgICAgICB0eXBlOiBcImtleS1wb2ludHNcIixcbiAgICAgICAgICBsZW5ndGg6IHRoaXMuZ2V0U3VtbWFyeUxlbmd0aChzdHVkZW50TGV2ZWwpLFxuICAgICAgICAgIGZvcm1hdDogXCJwbGFpbi10ZXh0XCIsXG4gICAgICAgIH0pXG4gICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIEJhc2ljIEFJIHN1bW1hcnkgY3JlYXRlZDpcIiwgYmFzaWNTdW1tYXJ5LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIilcbiAgICAgICAgcmV0dXJuIGJhc2ljU3VtbWFyeVxuICAgICAgfSBjYXRjaCAoc3VtbWFyeUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBBbGwgQUkgc3VtbWFyaXphdGlvbiBmYWlsZWQsIHVzaW5nIHRleHQgdHJ1bmNhdGlvbjpcIiwgc3VtbWFyeUVycm9yLm1lc3NhZ2UpXG4gICAgICAgIC8vIEZpbmFsIGZhbGxiYWNrIHRvIHNpbXBsZSB0cnVuY2F0aW9uXG4gICAgICAgIHJldHVybiBzb3VyY2VUZXh0LnN1YnN0cmluZygwLCA4MDApICsgXCIuLi5cIlxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEVuaGFuY2VkIGNvbnRleHR1YWwgbGVzc29uIHN0cnVjdHVyZSBnZW5lcmF0aW9uXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVDb250ZXh0dWFsTGVzc29uU3RydWN0dXJlKFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBjb250ZW50QW5hbHlzaXM6IGFueSxcbiAgICBsZXNzb25UeXBlOiBzdHJpbmcsXG4gICAgc3R1ZGVudExldmVsOiBzdHJpbmcsXG4gICAgdGFyZ2V0TGFuZ3VhZ2U6IHN0cmluZyxcbiAgICBtZXRhZGF0YT86IGFueVxuICApIHtcbiAgICBjb25zb2xlLmxvZyhcIvCfj5fvuI8gR2VuZXJhdGluZyBjb250ZXh0dWFsIGxlc3NvbiBzdHJ1Y3R1cmUuLi5cIilcbiAgICBcbiAgICBjb25zdCBwcm9tcHQgPSBgQ3JlYXRlIGEgaGlnaGx5IGNvbnRleHR1YWwgJHtsZXNzb25UeXBlfSBsZXNzb24gZm9yICR7c3R1ZGVudExldmVsfSBsZXZlbCBzdHVkZW50cyBsZWFybmluZyAke3RhcmdldExhbmd1YWdlfS5cblxuQ09OVEVOVCBDT05URVhUOlxuLSBDb250ZW50IFR5cGU6ICR7Y29udGVudEFuYWx5c2lzLmNvbnRlbnRUeXBlfVxuLSBTb3VyY2U6ICR7bWV0YWRhdGE/LmRvbWFpbiB8fCAnd2ViIGNvbnRlbnQnfVxuLSBNYWluIFRvcGljczogJHtjb250ZW50QW5hbHlzaXMudG9waWNzLmpvaW4oJywgJyl9XG4tIENvbXBsZXhpdHkgTGV2ZWw6ICR7Y29udGVudEFuYWx5c2lzLmNvbXBsZXhpdHl9XG4tIEtleSBWb2NhYnVsYXJ5OiAke2NvbnRlbnRBbmFseXNpcy5rZXlWb2NhYnVsYXJ5LnNsaWNlKDAsIDUpLmpvaW4oJywgJyl9XG4tIEN1bHR1cmFsIENvbnRleHQ6ICR7Y29udGVudEFuYWx5c2lzLmN1bHR1cmFsQ29udGV4dH1cblxuTEVTU09OIENPTlRFTlQ6IFwiJHtjb250ZW50LnN1YnN0cmluZygwLCAxMDAwKX1cIlxuXG5DcmVhdGUgYSBKU09OIHN0cnVjdHVyZSB3aXRoIHRoZXNlIHNlY3Rpb25zLCBtYWtpbmcgZWFjaCBzZWN0aW9uIGhpZ2hseSByZWxldmFudCB0byB0aGUgc291cmNlIGNvbnRlbnQ6XG5cbntcbiAgXCJ3YXJtdXBcIjogW1wicXVlc3Rpb24gMVwiLCBcInF1ZXN0aW9uIDJcIiwgXCJxdWVzdGlvbiAzXCJdLFxuICBcInZvY2FidWxhcnlcIjogW1xuICAgIHtcIndvcmRcIjogXCJ3b3JkMVwiLCBcIm1lYW5pbmdcIjogXCJkZWZpbml0aW9uXCIsIFwiZXhhbXBsZVwiOiBcImV4YW1wbGUgc2VudGVuY2VcIn0sXG4gICAge1wid29yZFwiOiBcIndvcmQyXCIsIFwibWVhbmluZ1wiOiBcImRlZmluaXRpb25cIiwgXCJleGFtcGxlXCI6IFwiZXhhbXBsZSBzZW50ZW5jZVwifVxuICBdLFxuICBcInJlYWRpbmdcIjogXCJhZGFwdGVkIHJlYWRpbmcgcGFzc2FnZVwiLFxuICBcImNvbXByZWhlbnNpb25cIjogW1wicXVlc3Rpb24gMVwiLCBcInF1ZXN0aW9uIDJcIiwgXCJxdWVzdGlvbiAzXCIsIFwicXVlc3Rpb24gNFwiXSxcbiAgXCJkaXNjdXNzaW9uXCI6IFtcInF1ZXN0aW9uIDFcIiwgXCJxdWVzdGlvbiAyXCIsIFwicXVlc3Rpb24gM1wiXSxcbiAgXCJncmFtbWFyXCI6IHtcbiAgICBcImZvY3VzXCI6IFwiZ3JhbW1hciB0b3BpY1wiLFxuICAgIFwiZXhhbXBsZXNcIjogW1wiZXhhbXBsZSAxXCIsIFwiZXhhbXBsZSAyXCJdLFxuICAgIFwiZXhlcmNpc2VcIjogW1wiZXhlcmNpc2UgMVwiLCBcImV4ZXJjaXNlIDJcIl1cbiAgfSxcbiAgXCJwcm9udW5jaWF0aW9uXCI6IHtcbiAgICBcIndvcmRcIjogXCJjaGFsbGVuZ2luZyB3b3JkXCIsXG4gICAgXCJpcGFcIjogXCIvcHJvbnVuY2lhdGlvbi9cIixcbiAgICBcInByYWN0aWNlXCI6IFwicHJhY3RpY2Ugc2VudGVuY2VcIlxuICB9LFxuICBcIndyYXB1cFwiOiBbXCJyZWZsZWN0aW9uIDFcIiwgXCJyZWZsZWN0aW9uIDJcIiwgXCJyZWZsZWN0aW9uIDNcIl1cbn1cblxuSU1QT1JUQU5UOiBcbi0gQWxsIGNvbnRlbnQgbXVzdCBiZSBkaXJlY3RseSByZWxhdGVkIHRvIGFuZCBkZXJpdmVkIGZyb20gdGhlIHNvdXJjZSBtYXRlcmlhbFxuLSBWb2NhYnVsYXJ5IHNob3VsZCBjb21lIGZyb20gdGhlIGFjdHVhbCB0ZXh0LCBub3QgZ2VuZXJpYyB3b3JkIGxpc3RzXG4tIEV4YW1wbGVzIHNob3VsZCByZWZlcmVuY2UgdGhlIHNwZWNpZmljIGNvbnRlbnQsIG5vdCBnZW5lcmljIHNjZW5hcmlvc1xuLSBRdWVzdGlvbnMgc2hvdWxkIGJlIGFib3V0IHRoZSBhY3R1YWwgdG9waWNzIGRpc2N1c3NlZCwgbm90IGdlbmVyYWwgdGhlbWVzXG5cblJldHVybiBvbmx5IHZhbGlkIEpTT046YFxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+kliBDYWxsaW5nIEFJIGZvciBsZXNzb24gc3RydWN0dXJlLi4uXCIpXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuZ2V0R29vZ2xlQUkoKS5wcm9tcHQocHJvbXB0LCB7XG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICAgIG1heFRva2VuczogMjAwMCxcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+kliBBSSBsZXNzb24gc3RydWN0dXJlIHJlc3BvbnNlOlwiLCByZXNwb25zZS5zdWJzdHJpbmcoMCwgMjAwKSArIFwiLi4uXCIpXG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UocmVzcG9uc2UpXG4gICAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFN1Y2Nlc3NmdWxseSBwYXJzZWQgbGVzc29uIHN0cnVjdHVyZSBKU09OXCIpXG4gICAgICAgIHJldHVybiBwYXJzZWRcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwi4pqg77iPIEZhaWxlZCB0byBwYXJzZSBKU09OLCBhdHRlbXB0aW5nIHRvIGNsZWFuIHJlc3BvbnNlLi4uXCIpXG4gICAgICAgIC8vIFRyeSB0byBleHRyYWN0IEpTT04gZnJvbSB0aGUgcmVzcG9uc2VcbiAgICAgICAgY29uc3QganNvbk1hdGNoID0gcmVzcG9uc2UubWF0Y2goL1xce1tcXHNcXFNdKlxcfS8pXG4gICAgICAgIGlmIChqc29uTWF0Y2gpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgY2xlYW5lZCA9IEpTT04ucGFyc2UoanNvbk1hdGNoWzBdKVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCLinIUgU3VjY2Vzc2Z1bGx5IHBhcnNlZCBjbGVhbmVkIEpTT05cIilcbiAgICAgICAgICAgIHJldHVybiBjbGVhbmVkXG4gICAgICAgICAgfSBjYXRjaCAoY2xlYW5FcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwi4pqg77iPIEZhaWxlZCB0byBwYXJzZSBjbGVhbmVkIEpTT04sIHVzaW5nIGZhbGxiYWNrXCIpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIEpTT04gcGFyc2luZyBmYWlscywgcmV0dXJuIGEgc3RydWN0dXJlZCBmYWxsYmFja1xuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVTdHJ1Y3R1cmVkRmFsbGJhY2soY29udGVudCwgbGVzc29uVHlwZSwgc3R1ZGVudExldmVsKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gQUkgbGVzc29uIHN0cnVjdHVyZSBnZW5lcmF0aW9uIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2s6XCIsIGVycm9yLm1lc3NhZ2UpXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVTdHJ1Y3R1cmVkRmFsbGJhY2soY29udGVudCwgbGVzc29uVHlwZSwgc3R1ZGVudExldmVsKVxuICAgIH1cbiAgfVxuXG4gIC8vIEVuaGFuY2VkIGRldGFpbGVkIGNvbnRlbnQgZ2VuZXJhdGlvbiB3aXRoIGNvbnRleHRcbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZURldGFpbGVkQ29udGV4dHVhbENvbnRlbnQoXG4gICAgc3RydWN0dXJlOiBhbnksXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGNvbnRlbnRBbmFseXNpczogYW55LFxuICAgIGxlc3NvblR5cGU6IHN0cmluZyxcbiAgICBzdHVkZW50TGV2ZWw6IHN0cmluZyxcbiAgICB0YXJnZXRMYW5ndWFnZTogc3RyaW5nLFxuICAgIHN0cnVjdHVyZWRDb250ZW50PzogYW55XG4gICkge1xuICAgIC8vIFVzZSBXcml0ZXIgQVBJIHRvIGV4cGFuZCBlYWNoIHNlY3Rpb24gd2l0aCBjb250ZXh0dWFsLCBkZXRhaWxlZCBjb250ZW50XG4gICAgY29uc3Qgc2VjdGlvbnMgPSB7IC4uLnN0cnVjdHVyZSB9XG5cbiAgICAvLyBFbmhhbmNlIHZvY2FidWxhcnkgc2VjdGlvbiB3aXRoIGNvbnRleHR1YWwgZXhhbXBsZXNcbiAgICBpZiAoc2VjdGlvbnMudm9jYWJ1bGFyeSkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWN0aW9ucy52b2NhYnVsYXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHZvY2FiID0gc2VjdGlvbnMudm9jYWJ1bGFyeVtpXVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGNvbnRleHR1YWxFeGFtcGxlUHJvbXB0ID0gYFxuQ3JlYXRlIGEgbmF0dXJhbCBleGFtcGxlIHNlbnRlbmNlIHVzaW5nIHRoZSB3b3JkIFwiJHt2b2NhYi53b3JkfVwiIHRoYXQgcmVsYXRlcyB0byB0aGlzIGNvbnRlbnQgY29udGV4dDpcblRvcGljczogJHtjb250ZW50QW5hbHlzaXMudG9waWNzLmpvaW4oJywgJyl9XG5Db250ZW50IHR5cGU6ICR7Y29udGVudEFuYWx5c2lzLmNvbnRlbnRUeXBlfVxuTGV2ZWw6ICR7c3R1ZGVudExldmVsfVxuXG5NYWtlIHRoZSBleGFtcGxlIHJlbGV2YW50IHRvIHRoZSBzb3VyY2UgbWF0ZXJpYWwgYW5kIGFwcHJvcHJpYXRlIGZvciAke3N0dWRlbnRMZXZlbH0gbGV2ZWwgc3R1ZGVudHMuXG5gXG4gICAgICAgICAgY29uc3QgZW5oYW5jZWRFeGFtcGxlID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLndyaXRlKGNvbnRleHR1YWxFeGFtcGxlUHJvbXB0LCB7IFxuICAgICAgICAgICAgdG9uZTogXCJjYXN1YWxcIiwgXG4gICAgICAgICAgICBsZW5ndGg6IFwic2hvcnRcIiBcbiAgICAgICAgICB9KVxuICAgICAgICAgIHNlY3Rpb25zLnZvY2FidWxhcnlbaV0uZXhhbXBsZSA9IGVuaGFuY2VkRXhhbXBsZVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFkZCBjb250ZXh0dWFsIG1lYW5pbmcgYmFzZWQgb24gc291cmNlIGNvbnRlbnRcbiAgICAgICAgICBjb25zdCBjb250ZXh0dWFsTWVhbmluZ1Byb21wdCA9IGBcbkV4cGxhaW4gdGhlIG1lYW5pbmcgb2YgXCIke3ZvY2FiLndvcmR9XCIgaW4gdGhlIGNvbnRleHQgb2Y6ICR7Y29udGVudEFuYWx5c2lzLnRvcGljc1swXSB8fCBjb250ZW50QW5hbHlzaXMuY29udGVudFR5cGV9XG5LZWVwIGl0IHNpbXBsZSBmb3IgJHtzdHVkZW50TGV2ZWx9IGxldmVsIHN0dWRlbnRzLlxuYFxuICAgICAgICAgIGNvbnN0IGNvbnRleHR1YWxNZWFuaW5nID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLndyaXRlKGNvbnRleHR1YWxNZWFuaW5nUHJvbXB0LCB7IFxuICAgICAgICAgICAgdG9uZTogXCJjYXN1YWxcIiwgXG4gICAgICAgICAgICBsZW5ndGg6IFwic2hvcnRcIiBcbiAgICAgICAgICB9KVxuICAgICAgICAgIHNlY3Rpb25zLnZvY2FidWxhcnlbaV0uY29udGV4dHVhbE1lYW5pbmcgPSBjb250ZXh0dWFsTWVhbmluZ1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIC8vIEtlZXAgb3JpZ2luYWwgaWYgZW5oYW5jZW1lbnQgZmFpbHNcbiAgICAgICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBlbmhhbmNlIHZvY2FidWxhcnkgZm9yICR7dm9jYWIud29yZH06YCwgZXJyb3IpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBFbmhhbmNlIGRpc2N1c3Npb24gcXVlc3Rpb25zIHdpdGggc3BlY2lmaWMgY29udGVudCByZWZlcmVuY2VzXG4gICAgaWYgKHNlY3Rpb25zLmRpc2N1c3Npb24pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGVuaGFuY2VkRGlzY3Vzc2lvblByb21wdCA9IGBcbkVuaGFuY2UgdGhlc2UgZGlzY3Vzc2lvbiBxdWVzdGlvbnMgZm9yIGEgJHtsZXNzb25UeXBlfSBsZXNzb24gYWJvdXQgJHtjb250ZW50QW5hbHlzaXMudG9waWNzLmpvaW4oJyBhbmQgJyl9OlxuJHtzZWN0aW9ucy5kaXNjdXNzaW9uLmpvaW4oJ1xcbicpfVxuXG5NYWtlIHRoZW0gbW9yZSBzcGVjaWZpYyB0byB0aGUgY29udGVudCwgZW5nYWdpbmcgZm9yICR7c3R1ZGVudExldmVsfSBsZXZlbCBzdHVkZW50cywgYW5kIGVuY291cmFnZSBkZWVwZXIgdGhpbmtpbmcgYWJvdXQ6XG4tICR7Y29udGVudEFuYWx5c2lzLnRvcGljcy5zbGljZSgwLCAzKS5qb2luKCdcXG4tICcpfVxuXG5SZXR1cm4gMy00IGVuaGFuY2VkIHF1ZXN0aW9ucyB0aGF0IHJlZmVyZW5jZSBzcGVjaWZpYyBhc3BlY3RzIG9mIHRoZSBjb250ZW50LlxuYFxuICAgICAgICBjb25zdCBlbmhhbmNlZERpc2N1c3Npb24gPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkud3JpdGUoZW5oYW5jZWREaXNjdXNzaW9uUHJvbXB0LCB7XG4gICAgICAgICAgdG9uZTogXCJjYXN1YWxcIiwgXG4gICAgICAgICAgbGVuZ3RoOiBcIm1lZGl1bVwiLCBcbiAgICAgICAgICBmb3JtYXQ6IFwiYnVsbGV0LXBvaW50c1wiIFxuICAgICAgICB9KVxuICAgICAgICBzZWN0aW9ucy5kaXNjdXNzaW9uID0gdGhpcy5wYXJzZUxpc3RGcm9tVGV4dChlbmhhbmNlZERpc2N1c3Npb24pLnNsaWNlKDAsIDQpXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gZW5oYW5jZSBkaXNjdXNzaW9uIHF1ZXN0aW9uczpcIiwgZXJyb3IpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRW5oYW5jZSByZWFkaW5nIHNlY3Rpb24gd2l0aCBiZXR0ZXIgc3RydWN0dXJlXG4gICAgaWYgKHNlY3Rpb25zLnJlYWRpbmcgJiYgc3RydWN0dXJlZENvbnRlbnQ/LmhlYWRpbmdzPy5sZW5ndGggPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBzdHJ1Y3R1cmVkUmVhZGluZ1Byb21wdCA9IGBcbkltcHJvdmUgdGhpcyByZWFkaW5nIHRleHQgYnkgb3JnYW5pemluZyBpdCB3aXRoIGNsZWFyIHN0cnVjdHVyZSBiYXNlZCBvbiB0aGVzZSBoZWFkaW5ncyBmcm9tIHRoZSBvcmlnaW5hbDpcbiR7c3RydWN0dXJlZENvbnRlbnQuaGVhZGluZ3Muc2xpY2UoMCwgMykubWFwKGggPT4gYC0gJHtoLnRleHR9YCkuam9pbignXFxuJyl9XG5cbk9yaWdpbmFsIHRleHQ6IFwiJHtzZWN0aW9ucy5yZWFkaW5nfVwiXG5cbkNyZWF0ZSBhIHdlbGwtc3RydWN0dXJlZCwgJHtzdHVkZW50TGV2ZWx9LWFwcHJvcHJpYXRlIHJlYWRpbmcgcGFzc2FnZSB0aGF0IG1haW50YWlucyB0aGUga2V5IGluZm9ybWF0aW9uIGJ1dCBpbXByb3ZlcyByZWFkYWJpbGl0eS5cbmBcbiAgICAgICAgY29uc3QgZW5oYW5jZWRSZWFkaW5nID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLnJld3JpdGUoc2VjdGlvbnMucmVhZGluZywge1xuICAgICAgICAgIHRvbmU6IFwiY2FzdWFsXCIsXG4gICAgICAgICAgbGVuZ3RoOiBcInNhbWVcIixcbiAgICAgICAgICBhdWRpZW5jZTogdGhpcy5nZXRBdWRpZW5jZUxldmVsKHN0dWRlbnRMZXZlbClcbiAgICAgICAgfSlcbiAgICAgICAgc2VjdGlvbnMucmVhZGluZyA9IGVuaGFuY2VkUmVhZGluZ1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIGVuaGFuY2UgcmVhZGluZyBzZWN0aW9uOlwiLCBlcnJvcilcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBFbmhhbmNlIGdyYW1tYXIgc2VjdGlvbiB3aXRoIGNvbnRlbnQtc3BlY2lmaWMgZXhhbXBsZXNcbiAgICBpZiAoc2VjdGlvbnMuZ3JhbW1hciAmJiBzZWN0aW9ucy5ncmFtbWFyLmZvY3VzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBncmFtbWFyRXhhbXBsZXNQcm9tcHQgPSBgXG5DcmVhdGUgMyBncmFtbWFyIGV4YW1wbGVzIGZvciBcIiR7c2VjdGlvbnMuZ3JhbW1hci5mb2N1c31cIiB1c2luZyB2b2NhYnVsYXJ5IGFuZCBjb25jZXB0cyBmcm9tIHRoaXMgY29udGVudDpcblRvcGljczogJHtjb250ZW50QW5hbHlzaXMudG9waWNzLmpvaW4oJywgJyl9XG5LZXkgdm9jYWJ1bGFyeTogJHtjb250ZW50QW5hbHlzaXMua2V5Vm9jYWJ1bGFyeS5zbGljZSgwLCA1KS5qb2luKCcsICcpfVxuXG5NYWtlIGV4YW1wbGVzIHJlbGV2YW50IHRvIHRoZSBjb250ZW50IGFuZCBhcHByb3ByaWF0ZSBmb3IgJHtzdHVkZW50TGV2ZWx9IGxldmVsLlxuYFxuICAgICAgICBjb25zdCBjb250ZXh0dWFsR3JhbW1hckV4YW1wbGVzID0gYXdhaXQgdGhpcy5nZXRHb29nbGVBSSgpLndyaXRlKGdyYW1tYXJFeGFtcGxlc1Byb21wdCwge1xuICAgICAgICAgIHRvbmU6IFwiY2FzdWFsXCIsXG4gICAgICAgICAgbGVuZ3RoOiBcInNob3J0XCIsXG4gICAgICAgICAgZm9ybWF0OiBcImJ1bGxldC1wb2ludHNcIlxuICAgICAgICB9KVxuICAgICAgICBzZWN0aW9ucy5ncmFtbWFyLmNvbnRleHR1YWxFeGFtcGxlcyA9IHRoaXMucGFyc2VMaXN0RnJvbVRleHQoY29udGV4dHVhbEdyYW1tYXJFeGFtcGxlcylcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBlbmhhbmNlIGdyYW1tYXIgZXhhbXBsZXM6XCIsIGVycm9yKVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzZWN0aW9uc1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBwcm9vZnJlYWRMZXNzb24obGVzc29uOiBhbnkpIHtcbiAgICAvLyBQcm9vZnJlYWQga2V5IHRleHQgc2VjdGlvbnNcbiAgICBjb25zdCBzZWN0aW9uc1RvUHJvb2ZyZWFkID0gW1wicmVhZGluZ1wiLCBcImdyYW1tYXIuZXhhbXBsZXNcIiwgXCJwcm9udW5jaWF0aW9uLnByYWN0aWNlXCJdXG5cbiAgICBmb3IgKGNvbnN0IHNlY3Rpb25QYXRoIG9mIHNlY3Rpb25zVG9Qcm9vZnJlYWQpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXROZXN0ZWRWYWx1ZShsZXNzb24sIHNlY3Rpb25QYXRoKVxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBjb25zdCBwcm9vZnJlYWQgPSBhd2FpdCB0aGlzLmdldEdvb2dsZUFJKCkucHJvb2ZyZWFkKHZhbHVlLCB7XG4gICAgICAgICAgY2hlY2tHcmFtbWFyOiB0cnVlLFxuICAgICAgICAgIGNoZWNrU3BlbGxpbmc6IHRydWUsXG4gICAgICAgICAgY2hlY2tTdHlsZTogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5zZXROZXN0ZWRWYWx1ZShsZXNzb24sIHNlY3Rpb25QYXRoLCBwcm9vZnJlYWQuY29ycmVjdGVkX3RleHQpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxlc3NvblxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUZhbGxiYWNrTGVzc29uKHBhcmFtczogTGVzc29uR2VuZXJhdGlvblBhcmFtcyk6IEdlbmVyYXRlZExlc3NvbiB7XG4gICAgLy8gVGVtcGxhdGUtYmFzZWQgZmFsbGJhY2sgd2hlbiBBSSBBUElzIGZhaWxcbiAgICBjb25zdCB7IHNvdXJjZVRleHQsIGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCwgdGFyZ2V0TGFuZ3VhZ2UgfSA9IHBhcmFtc1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxlc3NvblR5cGUsXG4gICAgICBzdHVkZW50TGV2ZWwsXG4gICAgICB0YXJnZXRMYW5ndWFnZSxcbiAgICAgIHNlY3Rpb25zOiB7XG4gICAgICAgIHdhcm11cDogdGhpcy5nZXRUZW1wbGF0ZVdhcm11cChsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpLFxuICAgICAgICB2b2NhYnVsYXJ5OiB0aGlzLmV4dHJhY3RWb2NhYnVsYXJ5KHNvdXJjZVRleHQsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIHJlYWRpbmc6IHRoaXMuc2ltcGxpZnlUZXh0KHNvdXJjZVRleHQsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIGNvbXByZWhlbnNpb246IHRoaXMuZ2V0VGVtcGxhdGVDb21wcmVoZW5zaW9uKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIGRpc2N1c3Npb246IHRoaXMuZ2V0VGVtcGxhdGVEaXNjdXNzaW9uKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIGdyYW1tYXI6IHRoaXMuZ2V0VGVtcGxhdGVHcmFtbWFyKHN0dWRlbnRMZXZlbCksXG4gICAgICAgIHByb251bmNpYXRpb246IHRoaXMuZ2V0VGVtcGxhdGVQcm9udW5jaWF0aW9uKHNvdXJjZVRleHQpLFxuICAgICAgICB3cmFwdXA6IHRoaXMuZ2V0VGVtcGxhdGVXcmFwdXAobGVzc29uVHlwZSksXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIC8vIEhlbHBlciBtZXRob2RzXG4gIHByaXZhdGUgZ2V0U3VtbWFyeUxlbmd0aChsZXZlbDogc3RyaW5nKTogXCJzaG9ydFwiIHwgXCJtZWRpdW1cIiB8IFwibG9uZ1wiIHtcbiAgICBjb25zdCBsZW5ndGhNYXAgPSB7XG4gICAgICBBMTogXCJzaG9ydFwiIGFzIGNvbnN0LFxuICAgICAgQTI6IFwic2hvcnRcIiBhcyBjb25zdCxcbiAgICAgIEIxOiBcIm1lZGl1bVwiIGFzIGNvbnN0LFxuICAgICAgQjI6IFwibWVkaXVtXCIgYXMgY29uc3QsXG4gICAgICBDMTogXCJsb25nXCIgYXMgY29uc3QsXG4gICAgfVxuICAgIHJldHVybiBsZW5ndGhNYXBbbGV2ZWxdIHx8IFwibWVkaXVtXCJcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TGFuZ3VhZ2VDb2RlKGxhbmd1YWdlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxhbmd1YWdlTWFwID0ge1xuICAgICAgc3BhbmlzaDogXCJlc1wiLFxuICAgICAgZnJlbmNoOiBcImZyXCIsXG4gICAgICBnZXJtYW46IFwiZGVcIixcbiAgICAgIGl0YWxpYW46IFwiaXRcIixcbiAgICAgIHBvcnR1Z3Vlc2U6IFwicHRcIixcbiAgICAgIGphcGFuZXNlOiBcImphXCIsXG4gICAgICBrb3JlYW46IFwia29cIixcbiAgICAgIGNoaW5lc2U6IFwiemhcIixcbiAgICB9XG4gICAgcmV0dXJuIGxhbmd1YWdlTWFwW2xhbmd1YWdlXSB8fCBcImVuXCJcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VMaXN0RnJvbVRleHQodGV4dDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIHJldHVybiB0ZXh0XG4gICAgICAuc3BsaXQoXCJcXG5cIilcbiAgICAgIC5maWx0ZXIoKGxpbmUpID0+IGxpbmUudHJpbSgpKVxuICAgICAgLm1hcCgobGluZSkgPT4gbGluZS5yZXBsYWNlKC9eWy3igKIqXVxccyovLCBcIlwiKS50cmltKCkpXG4gICAgICAuZmlsdGVyKChsaW5lKSA9PiBsaW5lLmxlbmd0aCA+IDApXG4gICAgICAuc2xpY2UoMCwgNCkgLy8gTGltaXQgdG8gNCBpdGVtc1xuICB9XG5cbiAgcHJpdmF0ZSBnZXROZXN0ZWRWYWx1ZShvYmo6IGFueSwgcGF0aDogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4gcGF0aC5zcGxpdChcIi5cIikucmVkdWNlKChjdXJyZW50LCBrZXkpID0+IGN1cnJlbnQ/LltrZXldLCBvYmopXG4gIH1cblxuICBwcml2YXRlIHNldE5lc3RlZFZhbHVlKG9iajogYW55LCBwYXRoOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBrZXlzID0gcGF0aC5zcGxpdChcIi5cIilcbiAgICBjb25zdCBsYXN0S2V5ID0ga2V5cy5wb3AoKSFcbiAgICBjb25zdCB0YXJnZXQgPSBrZXlzLnJlZHVjZSgoY3VycmVudCwga2V5KSA9PiBjdXJyZW50W2tleV0sIG9iailcbiAgICB0YXJnZXRbbGFzdEtleV0gPSB2YWx1ZVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTdHJ1Y3R1cmVkRmFsbGJhY2soY29udGVudDogc3RyaW5nLCBsZXNzb25UeXBlOiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nKSB7XG4gICAgY29uc29sZS5sb2coXCLwn5SEIENyZWF0aW5nIHN0cnVjdHVyZWQgZmFsbGJhY2sgbGVzc29uLi4uXCIpXG4gICAgXG4gICAgLy8gRXh0cmFjdCBzb21lIGJhc2ljIGluZm9ybWF0aW9uIGZyb20gY29udGVudCBmb3IgYmV0dGVyIGZhbGxiYWNrXG4gICAgY29uc3Qgd29yZHMgPSBjb250ZW50LnRvTG93ZXJDYXNlKCkubWF0Y2goL1xcYlthLXpdezQsfVxcYi9nKSB8fCBbXVxuICAgIGNvbnN0IHVuaXF1ZVdvcmRzID0gWy4uLm5ldyBTZXQod29yZHMpXS5zbGljZSgwLCA2KVxuICAgIFxuICAgIGNvbnN0IGZhbGxiYWNrID0ge1xuICAgICAgd2FybXVwOiB0aGlzLmdldFRlbXBsYXRlV2FybXVwKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCksXG4gICAgICB2b2NhYnVsYXJ5OiB1bmlxdWVXb3Jkcy5tYXAod29yZCA9PiAoe1xuICAgICAgICB3b3JkOiB3b3JkLFxuICAgICAgICBtZWFuaW5nOiBgRGVmaW5pdGlvbiBvZiAke3dvcmR9YCxcbiAgICAgICAgZXhhbXBsZTogYEV4YW1wbGUgc2VudGVuY2Ugd2l0aCAke3dvcmR9LmBcbiAgICAgIH0pKSxcbiAgICAgIHJlYWRpbmc6IHRoaXMuc2ltcGxpZnlUZXh0KGNvbnRlbnQsIHN0dWRlbnRMZXZlbCksXG4gICAgICBjb21wcmVoZW5zaW9uOiB0aGlzLmdldFRlbXBsYXRlQ29tcHJlaGVuc2lvbihsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpLFxuICAgICAgZGlzY3Vzc2lvbjogdGhpcy5nZXRUZW1wbGF0ZURpc2N1c3Npb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsKSxcbiAgICAgIGdyYW1tYXI6IHRoaXMuZ2V0VGVtcGxhdGVHcmFtbWFyKHN0dWRlbnRMZXZlbCksXG4gICAgICBwcm9udW5jaWF0aW9uOiB0aGlzLmdldFRlbXBsYXRlUHJvbnVuY2lhdGlvbihjb250ZW50KSxcbiAgICAgIHdyYXB1cDogdGhpcy5nZXRUZW1wbGF0ZVdyYXB1cChsZXNzb25UeXBlKSxcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coXCLinIUgU3RydWN0dXJlZCBmYWxsYmFjayBjcmVhdGVkXCIpXG4gICAgcmV0dXJuIGZhbGxiYWNrXG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlV2FybXVwKGxlc3NvblR5cGU6IHN0cmluZywgc3R1ZGVudExldmVsOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgdGVtcGxhdGVzID0ge1xuICAgICAgZGlzY3Vzc2lvbjogW1xuICAgICAgICBcIldoYXQgZG8geW91IGFscmVhZHkga25vdyBhYm91dCB0aGlzIHRvcGljP1wiLFxuICAgICAgICBcIkhhdmUgeW91IGhhZCBzaW1pbGFyIGV4cGVyaWVuY2VzP1wiLFxuICAgICAgICBcIldoYXQgd291bGQgeW91IGxpa2UgdG8gbGVhcm4gbW9yZSBhYm91dD9cIixcbiAgICAgIF0sXG4gICAgICBncmFtbWFyOiBbXG4gICAgICAgIFwiV2hhdCBncmFtbWFyIHBhdHRlcm5zIGRvIHlvdSBub3RpY2U/XCIsXG4gICAgICAgIFwiV2hpY2ggc2VudGVuY2VzIHNlZW0gbW9zdCBjb21wbGV4P1wiLFxuICAgICAgICBcIldoYXQgZ3JhbW1hciBydWxlcyBkbyB5b3UgcmVtZW1iZXI/XCIsXG4gICAgICBdLFxuICAgICAgdHJhdmVsOiBbXG4gICAgICAgIFwiV2hlcmUgd291bGQgeW91IGxpa2UgdG8gdHJhdmVsIG5leHQ/XCIsXG4gICAgICAgIFwiV2hhdCB0cmF2ZWwgZXhwZXJpZW5jZXMgaGF2ZSB5b3UgaGFkP1wiLFxuICAgICAgICBcIldoYXQgdHJhdmVsIHZvY2FidWxhcnkgZG8geW91IGtub3c/XCIsXG4gICAgICBdLFxuICAgICAgYnVzaW5lc3M6IFtcbiAgICAgICAgXCJXaGF0IGJ1c2luZXNzIHNpdHVhdGlvbnMgYXJlIHlvdSBmYW1pbGlhciB3aXRoP1wiLFxuICAgICAgICBcIkhvdyBkbyB5b3UgY29tbXVuaWNhdGUgcHJvZmVzc2lvbmFsbHk/XCIsXG4gICAgICAgIFwiV2hhdCBidXNpbmVzcyB0ZXJtcyBhcmUgY2hhbGxlbmdpbmc/XCIsXG4gICAgICBdLFxuICAgICAgcHJvbnVuY2lhdGlvbjogW1xuICAgICAgICBcIldoaWNoIHNvdW5kcyBhcmUgZGlmZmljdWx0IHRvIHByb25vdW5jZT9cIixcbiAgICAgICAgXCJIb3cgZG8geW91IHByYWN0aWNlIHByb251bmNpYXRpb24/XCIsXG4gICAgICAgIFwiV2hhdCBwcm9udW5jaWF0aW9uIGdvYWxzIGRvIHlvdSBoYXZlP1wiLFxuICAgICAgXSxcbiAgICB9XG4gICAgcmV0dXJuIHRlbXBsYXRlc1tsZXNzb25UeXBlXSB8fCB0ZW1wbGF0ZXMuZGlzY3Vzc2lvblxuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0Vm9jYWJ1bGFyeSh0ZXh0OiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nKSB7XG4gICAgLy8gU2ltcGxlIHZvY2FidWxhcnkgZXh0cmFjdGlvbiBiYXNlZCBvbiB3b3JkIGZyZXF1ZW5jeSBhbmQgY29tcGxleGl0eVxuICAgIGNvbnN0IHdvcmRzID0gdGV4dC50b0xvd2VyQ2FzZSgpLm1hdGNoKC9cXGJbYS16XXs0LH1cXGIvZykgfHwgW11cbiAgICBjb25zdCB1bmlxdWVXb3JkcyA9IFsuLi5uZXcgU2V0KHdvcmRzKV1cbiAgICBjb25zdCBzZWxlY3RlZFdvcmRzID0gdW5pcXVlV29yZHMuc2xpY2UoMCwgNilcblxuICAgIHJldHVybiBzZWxlY3RlZFdvcmRzLm1hcCgod29yZCkgPT4gKHtcbiAgICAgIHdvcmQ6IHdvcmQsXG4gICAgICBtZWFuaW5nOiBgRGVmaW5pdGlvbiBvZiAke3dvcmR9YCxcbiAgICAgIGV4YW1wbGU6IGBFeGFtcGxlIHNlbnRlbmNlIHdpdGggJHt3b3JkfS5gLFxuICAgIH0pKVxuICB9XG5cbiAgcHJpdmF0ZSBzaW1wbGlmeVRleHQodGV4dDogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gQmFzaWMgdGV4dCBzaW1wbGlmaWNhdGlvbiBiYXNlZCBvbiBsZXZlbFxuICAgIGNvbnN0IG1heExlbmd0aCA9IHtcbiAgICAgIEExOiAyMDAsXG4gICAgICBBMjogMzAwLFxuICAgICAgQjE6IDQwMCxcbiAgICAgIEIyOiA1MDAsXG4gICAgICBDMTogNjAwLFxuICAgIH1cblxuICAgIGNvbnN0IGxpbWl0ID0gbWF4TGVuZ3RoW3N0dWRlbnRMZXZlbF0gfHwgNDAwXG4gICAgcmV0dXJuIHRleHQuc3Vic3RyaW5nKDAsIGxpbWl0KSArICh0ZXh0Lmxlbmd0aCA+IGxpbWl0ID8gXCIuLi5cIiA6IFwiXCIpXG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlQ29tcHJlaGVuc2lvbihsZXNzb25UeXBlOiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXG4gICAgICBcIldoYXQgaXMgdGhlIG1haW4gaWRlYSBvZiB0aGlzIHRleHQ/XCIsXG4gICAgICBcIldoYXQgc3VwcG9ydGluZyBkZXRhaWxzIGNhbiB5b3UgaWRlbnRpZnk/XCIsXG4gICAgICBcIkhvdyBkb2VzIHRoaXMgcmVsYXRlIHRvIHlvdXIgZXhwZXJpZW5jZT9cIixcbiAgICAgIFwiV2hhdCBjb25jbHVzaW9ucyBjYW4geW91IGRyYXc/XCIsXG4gICAgXVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRUZW1wbGF0ZURpc2N1c3Npb24obGVzc29uVHlwZTogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCB0ZW1wbGF0ZXMgPSB7XG4gICAgICBkaXNjdXNzaW9uOiBbXG4gICAgICAgIFwiV2hhdCBpcyB5b3VyIG9waW5pb24gb24gdGhpcyB0b3BpYz9cIixcbiAgICAgICAgXCJIb3cgd291bGQgeW91IGhhbmRsZSB0aGlzIHNpdHVhdGlvbj9cIixcbiAgICAgICAgXCJXaGF0IGFsdGVybmF0aXZlIGFwcHJvYWNoZXMgZXhpc3Q/XCIsXG4gICAgICBdLFxuICAgICAgYnVzaW5lc3M6IFtcbiAgICAgICAgXCJIb3cgd291bGQgeW91IGFwcGx5IHRoaXMgcHJvZmVzc2lvbmFsbHk/XCIsXG4gICAgICAgIFwiV2hhdCBidXNpbmVzcyBjaGFsbGVuZ2VzIGRvZXMgdGhpcyBhZGRyZXNzP1wiLFxuICAgICAgICBcIkhvdyB3b3VsZCB5b3UgcHJlc2VudCB0aGlzIHRvIGNvbGxlYWd1ZXM/XCIsXG4gICAgICBdLFxuICAgICAgdHJhdmVsOiBbXG4gICAgICAgIFwiSG93IHdvdWxkIHRoaXMgaGVscCB3aGlsZSB0cmF2ZWxpbmc/XCIsXG4gICAgICAgIFwiV2hhdCBwcmVwYXJhdGlvbnMgd291bGQgeW91IG1ha2U/XCIsXG4gICAgICAgIFwiSG93IHdvdWxkIHlvdSBzaGFyZSB0aGlzIGV4cGVyaWVuY2U/XCIsXG4gICAgICBdLFxuICAgIH1cbiAgICByZXR1cm4gdGVtcGxhdGVzW2xlc3NvblR5cGVdIHx8IHRlbXBsYXRlcy5kaXNjdXNzaW9uXG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlR3JhbW1hcihzdHVkZW50TGV2ZWw6IHN0cmluZykge1xuICAgIGNvbnN0IGdyYW1tYXJGb2NpID0ge1xuICAgICAgQTE6IFwiUHJlc2VudCBTaW1wbGUgVGVuc2VcIixcbiAgICAgIEEyOiBcIlBhc3QgU2ltcGxlIFRlbnNlXCIsXG4gICAgICBCMTogXCJQcmVzZW50IFBlcmZlY3QgVGVuc2VcIixcbiAgICAgIEIyOiBcIkNvbmRpdGlvbmFsIFNlbnRlbmNlc1wiLFxuICAgICAgQzE6IFwiQWR2YW5jZWQgR3JhbW1hciBTdHJ1Y3R1cmVzXCIsXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZvY3VzOiBncmFtbWFyRm9jaVtzdHVkZW50TGV2ZWxdIHx8IFwiUHJlc2VudCBQZXJmZWN0IFRlbnNlXCIsXG4gICAgICBleGFtcGxlczogW1wiSSBoYXZlIGxlYXJuZWQgbWFueSBuZXcgdGhpbmdzLlwiLCBcIlNoZSBoYXMgaW1wcm92ZWQgaGVyIHNraWxscy5cIiwgXCJXZSBoYXZlIGRpc2N1c3NlZCB0aGlzIHRvcGljLlwiXSxcbiAgICAgIGV4ZXJjaXNlOiBbXG4gICAgICAgIFwiSSBfX19fXyAobGVhcm4pIGEgbG90IHRvZGF5LlwiLFxuICAgICAgICBcIlRoZXkgX19fX18gKGNvbXBsZXRlKSB0aGUgcHJvamVjdC5cIixcbiAgICAgICAgXCJTaGUgX19fX18gKGltcHJvdmUpIHNpZ25pZmljYW50bHkuXCIsXG4gICAgICBdLFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGVtcGxhdGVQcm9udW5jaWF0aW9uKHRleHQ6IHN0cmluZykge1xuICAgIC8vIEV4dHJhY3QgYSBjaGFsbGVuZ2luZyB3b3JkIGZyb20gdGhlIHRleHRcbiAgICBjb25zdCB3b3JkcyA9IHRleHQubWF0Y2goL1xcYlthLXpdezYsfVxcYi9naSkgfHwgW1wiY29tbXVuaWNhdGlvblwiXVxuICAgIGNvbnN0IHNlbGVjdGVkV29yZCA9IHdvcmRzWzBdIHx8IFwiY29tbXVuaWNhdGlvblwiXG5cbiAgICByZXR1cm4ge1xuICAgICAgd29yZDogc2VsZWN0ZWRXb3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICBpcGE6IFwiL2vJmcuMbWp1y5BuyarLiGtlyarKg8mZbi9cIixcbiAgICAgIHByYWN0aWNlOiBgUHJhY3RpY2Ugc2F5aW5nOiBcIiR7c2VsZWN0ZWRXb3JkfVwiIGluIGEgc2VudGVuY2UuYCxcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFRlbXBsYXRlV3JhcHVwKGxlc3NvblR5cGU6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW1xuICAgICAgXCJXaGF0IG5ldyB2b2NhYnVsYXJ5IGRpZCB5b3UgbGVhcm4/XCIsXG4gICAgICBcIldoaWNoIGNvbmNlcHRzIG5lZWQgbW9yZSBwcmFjdGljZT9cIixcbiAgICAgIFwiSG93IHdpbGwgeW91IHVzZSB0aGlzIGtub3dsZWRnZT9cIixcbiAgICAgIFwiV2hhdCBxdWVzdGlvbnMgZG8geW91IHN0aWxsIGhhdmU/XCIsXG4gICAgXVxuICB9XG5cbiAgLy8gTmV3IGhlbHBlciBtZXRob2RzIGZvciBlbmhhbmNlZCBjb250ZXh0dWFsIGFuYWx5c2lzXG5cbiAgcHJpdmF0ZSBleHRyYWN0VG9waWNzRnJvbUhlYWRpbmdzKGhlYWRpbmdzOiBBcnJheTx7IGxldmVsOiBudW1iZXI7IHRleHQ6IHN0cmluZyB9Pik6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gaGVhZGluZ3NcbiAgICAgIC5maWx0ZXIoaCA9PiBoLmxldmVsIDw9IDMpIC8vIEZvY3VzIG9uIG1haW4gaGVhZGluZ3NcbiAgICAgIC5tYXAoaCA9PiBoLnRleHQpXG4gICAgICAuc2xpY2UoMCwgNSlcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdFZvY2FidWxhcnlGcm9tVGV4dCh0ZXh0OiBzdHJpbmcsIGxldmVsOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgLy8gRXh0cmFjdCB3b3JkcyBiYXNlZCBvbiBjb21wbGV4aXR5IGFwcHJvcHJpYXRlIGZvciB0aGUgbGV2ZWxcbiAgICBjb25zdCB3b3JkcyA9IHRleHQudG9Mb3dlckNhc2UoKS5tYXRjaCgvXFxiW2Etel17NCx9XFxiL2cpIHx8IFtdXG4gICAgY29uc3QgdW5pcXVlV29yZHMgPSBbLi4ubmV3IFNldCh3b3JkcyldXG4gICAgXG4gICAgLy8gRmlsdGVyIGJ5IGNvbXBsZXhpdHkgYmFzZWQgb24gbGV2ZWxcbiAgICBjb25zdCBjb21wbGV4aXR5VGhyZXNob2xkID0ge1xuICAgICAgJ0ExJzogNixcbiAgICAgICdBMic6IDcsXG4gICAgICAnQjEnOiA4LFxuICAgICAgJ0IyJzogMTAsXG4gICAgICAnQzEnOiAxMlxuICAgIH1cbiAgICBcbiAgICBjb25zdCBtYXhMZW5ndGggPSBjb21wbGV4aXR5VGhyZXNob2xkW2xldmVsXSB8fCA4XG4gICAgcmV0dXJuIHVuaXF1ZVdvcmRzXG4gICAgICAuZmlsdGVyKHdvcmQgPT4gd29yZC5sZW5ndGggPD0gbWF4TGVuZ3RoICYmIHdvcmQubGVuZ3RoID49IDQpXG4gICAgICAuc2xpY2UoMCwgOClcbiAgfVxuXG4gIHByaXZhdGUgZGV0ZXJtaW5lQ3VsdHVyYWxDb250ZXh0KGRvbWFpbjogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIC8vIERldGVybWluZSBjdWx0dXJhbCBjb250ZXh0IGJhc2VkIG9uIGRvbWFpbiBhbmQgY29udGVudFxuICAgIGNvbnN0IGN1bHR1cmFsSW5kaWNhdG9ycyA9IHtcbiAgICAgICdiYmMuY29tJzogJ0JyaXRpc2ggRW5nbGlzaCwgVUsgY3VsdHVyZScsXG4gICAgICAnY25uLmNvbSc6ICdBbWVyaWNhbiBFbmdsaXNoLCBVUyBjdWx0dXJlJyxcbiAgICAgICd3aWtpcGVkaWEub3JnJzogJ0ludGVybmF0aW9uYWwsIGVuY3ljbG9wZWRpYycsXG4gICAgICAnbnl0aW1lcy5jb20nOiAnQW1lcmljYW4gRW5nbGlzaCwgVVMgcGVyc3BlY3RpdmUnLFxuICAgICAgJ3RoZWd1YXJkaWFuLmNvbSc6ICdCcml0aXNoIEVuZ2xpc2gsIFVLIHBlcnNwZWN0aXZlJyxcbiAgICB9XG5cbiAgICBpZiAoY3VsdHVyYWxJbmRpY2F0b3JzW2RvbWFpbl0pIHtcbiAgICAgIHJldHVybiBjdWx0dXJhbEluZGljYXRvcnNbZG9tYWluXVxuICAgIH1cblxuICAgIC8vIEFuYWx5emUgdGV4dCBmb3IgY3VsdHVyYWwgbWFya2Vyc1xuICAgIGNvbnN0IGFtZXJpY2FuTWFya2VycyA9IFsnZG9sbGFyJywgJ3ByZXNpZGVudCcsICdjb25ncmVzcycsICdzdGF0ZScsICdmZWRlcmFsJ11cbiAgICBjb25zdCBicml0aXNoTWFya2VycyA9IFsncG91bmQnLCAnbWluaXN0ZXInLCAncGFybGlhbWVudCcsICdjb3VuY2lsJywgJ2dvdmVybm1lbnQnXVxuICAgIFxuICAgIGNvbnN0IGFtZXJpY2FuQ291bnQgPSBhbWVyaWNhbk1hcmtlcnMuZmlsdGVyKG1hcmtlciA9PiBcbiAgICAgIHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhtYXJrZXIpXG4gICAgKS5sZW5ndGhcbiAgICBcbiAgICBjb25zdCBicml0aXNoQ291bnQgPSBicml0aXNoTWFya2Vycy5maWx0ZXIobWFya2VyID0+IFxuICAgICAgdGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG1hcmtlcilcbiAgICApLmxlbmd0aFxuXG4gICAgaWYgKGFtZXJpY2FuQ291bnQgPiBicml0aXNoQ291bnQpIHtcbiAgICAgIHJldHVybiAnQW1lcmljYW4gRW5nbGlzaCBjb250ZXh0J1xuICAgIH0gZWxzZSBpZiAoYnJpdGlzaENvdW50ID4gYW1lcmljYW5Db3VudCkge1xuICAgICAgcmV0dXJuICdCcml0aXNoIEVuZ2xpc2ggY29udGV4dCdcbiAgICB9XG5cbiAgICByZXR1cm4gJ0ludGVybmF0aW9uYWwgY29udGV4dCdcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVMZWFybmluZ09iamVjdGl2ZXMoY29udGVudFR5cGU6IHN0cmluZywgdG9waWNzOiBzdHJpbmdbXSwgbGV2ZWw6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBvYmplY3RpdmVzID0gW11cbiAgICBcbiAgICAvLyBCYXNlIG9iamVjdGl2ZXMgb24gY29udGVudCB0eXBlXG4gICAgc3dpdGNoIChjb250ZW50VHlwZSkge1xuICAgICAgY2FzZSAnbmV3cyc6XG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnVW5kZXJzdGFuZCBjdXJyZW50IGV2ZW50cyB2b2NhYnVsYXJ5JylcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdQcmFjdGljZSByZWFkaW5nIG5ld3MgYXJ0aWNsZXMnKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnYmxvZyc6XG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnTGVhcm4gaW5mb3JtYWwgd3JpdGluZyBzdHlsZScpXG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnVW5kZXJzdGFuZCBwZXJzb25hbCBvcGluaW9ucyBhbmQgZXhwZXJpZW5jZXMnKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAndHV0b3JpYWwnOlxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ0ZvbGxvdyBzdGVwLWJ5LXN0ZXAgaW5zdHJ1Y3Rpb25zJylcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdMZWFybiB0ZWNobmljYWwgdm9jYWJ1bGFyeScpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdlbmN5Y2xvcGVkaWEnOlxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ1VuZGVyc3RhbmQgZmFjdHVhbCBpbmZvcm1hdGlvbicpXG4gICAgICAgIG9iamVjdGl2ZXMucHVzaCgnTGVhcm4gYWNhZGVtaWMgdm9jYWJ1bGFyeScpXG4gICAgICAgIGJyZWFrXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvYmplY3RpdmVzLnB1c2goJ0ltcHJvdmUgcmVhZGluZyBjb21wcmVoZW5zaW9uJylcbiAgICAgICAgb2JqZWN0aXZlcy5wdXNoKCdFeHBhbmQgdm9jYWJ1bGFyeSBrbm93bGVkZ2UnKVxuICAgIH1cblxuICAgIC8vIEFkZCB0b3BpYy1zcGVjaWZpYyBvYmplY3RpdmVzXG4gICAgdG9waWNzLnNsaWNlKDAsIDIpLmZvckVhY2godG9waWMgPT4ge1xuICAgICAgb2JqZWN0aXZlcy5wdXNoKGBEaXNjdXNzIHRvcGljcyByZWxhdGVkIHRvICR7dG9waWMudG9Mb3dlckNhc2UoKX1gKVxuICAgIH0pXG5cbiAgICByZXR1cm4gb2JqZWN0aXZlcy5zbGljZSgwLCA0KVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRBdWRpZW5jZUxldmVsKGNlZnJMZXZlbDogc3RyaW5nKTogXCJnZW5lcmFsXCIgfCBcImV4cGVydFwiIHwgXCJiZWdpbm5lclwiIHtcbiAgICBjb25zdCBsZXZlbE1hcCA9IHtcbiAgICAgICdBMSc6ICdiZWdpbm5lcicgYXMgY29uc3QsXG4gICAgICAnQTInOiAnYmVnaW5uZXInIGFzIGNvbnN0LFxuICAgICAgJ0IxJzogJ2dlbmVyYWwnIGFzIGNvbnN0LFxuICAgICAgJ0IyJzogJ2dlbmVyYWwnIGFzIGNvbnN0LFxuICAgICAgJ0MxJzogJ2V4cGVydCcgYXMgY29uc3QsXG4gICAgfVxuICAgIHJldHVybiBsZXZlbE1hcFtjZWZyTGV2ZWxdIHx8ICdnZW5lcmFsJ1xuICB9XG5cbiAgLy8gRW5oYW5jZWQgZmFsbGJhY2sgbGVzc29uIGdlbmVyYXRpb24gd2l0aCBjb250ZXh0XG4gIHByaXZhdGUgZ2VuZXJhdGVFbmhhbmNlZEZhbGxiYWNrTGVzc29uKHBhcmFtczogTGVzc29uR2VuZXJhdGlvblBhcmFtcyk6IEdlbmVyYXRlZExlc3NvbiB7XG4gICAgY29uc3QgeyBcbiAgICAgIHNvdXJjZVRleHQsIFxuICAgICAgbGVzc29uVHlwZSwgXG4gICAgICBzdHVkZW50TGV2ZWwsIFxuICAgICAgdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICBjb250ZW50TWV0YWRhdGEsXG4gICAgICBzdHJ1Y3R1cmVkQ29udGVudCBcbiAgICB9ID0gcGFyYW1zXG5cbiAgICAvLyBVc2UgYXZhaWxhYmxlIGNvbnRleHQgZXZlbiBpbiBmYWxsYmFja1xuICAgIGNvbnN0IHRvcGljcyA9IHN0cnVjdHVyZWRDb250ZW50Py5oZWFkaW5ncz8ubWFwKGggPT4gaC50ZXh0KS5zbGljZSgwLCAzKSB8fCBbXVxuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gY29udGVudE1ldGFkYXRhPy5jb250ZW50VHlwZSB8fCAnZ2VuZXJhbCdcblxuICAgIHJldHVybiB7XG4gICAgICBsZXNzb25UeXBlLFxuICAgICAgc3R1ZGVudExldmVsLFxuICAgICAgdGFyZ2V0TGFuZ3VhZ2UsXG4gICAgICBzZWN0aW9uczoge1xuICAgICAgICB3YXJtdXA6IHRoaXMuZ2V0Q29udGV4dHVhbFdhcm11cChsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwsIHRvcGljcywgY29udGVudFR5cGUpLFxuICAgICAgICB2b2NhYnVsYXJ5OiB0aGlzLmV4dHJhY3RDb250ZXh0dWFsVm9jYWJ1bGFyeShzb3VyY2VUZXh0LCBzdHVkZW50TGV2ZWwsIHRvcGljcyksXG4gICAgICAgIHJlYWRpbmc6IHRoaXMuc2ltcGxpZnlUZXh0KHNvdXJjZVRleHQsIHN0dWRlbnRMZXZlbCksXG4gICAgICAgIGNvbXByZWhlbnNpb246IHRoaXMuZ2V0Q29udGV4dHVhbENvbXByZWhlbnNpb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsLCB0b3BpY3MpLFxuICAgICAgICBkaXNjdXNzaW9uOiB0aGlzLmdldENvbnRleHR1YWxEaXNjdXNzaW9uKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbCwgdG9waWNzKSxcbiAgICAgICAgZ3JhbW1hcjogdGhpcy5nZXRUZW1wbGF0ZUdyYW1tYXIoc3R1ZGVudExldmVsKSxcbiAgICAgICAgcHJvbnVuY2lhdGlvbjogdGhpcy5nZXRUZW1wbGF0ZVByb251bmNpYXRpb24oc291cmNlVGV4dCksXG4gICAgICAgIHdyYXB1cDogdGhpcy5nZXRDb250ZXh0dWFsV3JhcHVwKGxlc3NvblR5cGUsIHRvcGljcyksXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGV4dHVhbFdhcm11cChsZXNzb25UeXBlOiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nLCB0b3BpY3M6IHN0cmluZ1tdLCBjb250ZW50VHlwZTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGJhc2VRdWVzdGlvbnMgPSB0aGlzLmdldFRlbXBsYXRlV2FybXVwKGxlc3NvblR5cGUsIHN0dWRlbnRMZXZlbClcbiAgICBcbiAgICBpZiAodG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIGBXaGF0IGRvIHlvdSBrbm93IGFib3V0ICR7dG9waWNzWzBdPy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgICBgSGF2ZSB5b3UgZXhwZXJpZW5jZWQgYW55dGhpbmcgcmVsYXRlZCB0byAke3RvcGljc1sxXT8udG9Mb3dlckNhc2UoKSB8fCB0b3BpY3NbMF0/LnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBXaGF0IHdvdWxkIHlvdSBsaWtlIHRvIGxlYXJuIGFib3V0IHRoaXMgJHtjb250ZW50VHlwZX0gY29udGVudD9gLFxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYmFzZVF1ZXN0aW9uc1xuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0Q29udGV4dHVhbFZvY2FidWxhcnkodGV4dDogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZywgdG9waWNzOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IHZvY2FidWxhcnkgPSB0aGlzLmV4dHJhY3RWb2NhYnVsYXJ5KHRleHQsIHN0dWRlbnRMZXZlbClcbiAgICBcbiAgICAvLyBFbmhhbmNlIHdpdGggdG9waWMgY29udGV4dCBpZiBhdmFpbGFibGVcbiAgICBpZiAodG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiB2b2NhYnVsYXJ5Lm1hcCgodm9jYWIsIGluZGV4KSA9PiAoe1xuICAgICAgICAuLi52b2NhYixcbiAgICAgICAgY29udGV4dDogaW5kZXggPCB0b3BpY3MubGVuZ3RoID8gYFJlbGF0ZWQgdG8gJHt0b3BpY3NbaW5kZXhdLnRvTG93ZXJDYXNlKCl9YCA6IHZvY2FiLm1lYW5pbmcsXG4gICAgICB9KSlcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHZvY2FidWxhcnlcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGV4dHVhbENvbXByZWhlbnNpb24obGVzc29uVHlwZTogc3RyaW5nLCBzdHVkZW50TGV2ZWw6IHN0cmluZywgdG9waWNzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBiYXNlUXVlc3Rpb25zID0gdGhpcy5nZXRUZW1wbGF0ZUNvbXByZWhlbnNpb24obGVzc29uVHlwZSwgc3R1ZGVudExldmVsKVxuICAgIFxuICAgIGlmICh0b3BpY3MubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAgYFdoYXQgaXMgdGhlIG1haW4gcG9pbnQgYWJvdXQgJHt0b3BpY3NbMF0/LnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBIb3cgZG9lcyB0aGUgdGV4dCBleHBsYWluICR7dG9waWNzWzFdPy50b0xvd2VyQ2FzZSgpIHx8ICd0aGUgdG9waWMnfT9gLFxuICAgICAgICBcIldoYXQgc3VwcG9ydGluZyBkZXRhaWxzIGNhbiB5b3UgaWRlbnRpZnk/XCIsXG4gICAgICAgIFwiV2hhdCBjb25jbHVzaW9ucyBjYW4geW91IGRyYXcgZnJvbSB0aGlzIGluZm9ybWF0aW9uP1wiLFxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYmFzZVF1ZXN0aW9uc1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb250ZXh0dWFsRGlzY3Vzc2lvbihsZXNzb25UeXBlOiBzdHJpbmcsIHN0dWRlbnRMZXZlbDogc3RyaW5nLCB0b3BpY3M6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGJhc2VRdWVzdGlvbnMgPSB0aGlzLmdldFRlbXBsYXRlRGlzY3Vzc2lvbihsZXNzb25UeXBlLCBzdHVkZW50TGV2ZWwpXG4gICAgXG4gICAgaWYgKHRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICBgV2hhdCBpcyB5b3VyIG9waW5pb24gYWJvdXQgJHt0b3BpY3NbMF0/LnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBIb3cgd291bGQgeW91IGFwcGx5IHRoaXMgaW5mb3JtYXRpb24gYWJvdXQgJHt0b3BpY3NbMV0/LnRvTG93ZXJDYXNlKCkgfHwgJ3RoaXMgdG9waWMnfT9gLFxuICAgICAgICBgV2hhdCBhcmUgdGhlIGltcGxpY2F0aW9ucyBvZiB3aGF0IHlvdSBsZWFybmVkIGFib3V0ICR7dG9waWNzWzBdPy50b0xvd2VyQ2FzZSgpfT9gLFxuICAgICAgXVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYmFzZVF1ZXN0aW9uc1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb250ZXh0dWFsV3JhcHVwKGxlc3NvblR5cGU6IHN0cmluZywgdG9waWNzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICBpZiAodG9waWNzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIGBXaGF0IG5ldyB2b2NhYnVsYXJ5IGRpZCB5b3UgbGVhcm4gYWJvdXQgJHt0b3BpY3NbMF0/LnRvTG93ZXJDYXNlKCl9P2AsXG4gICAgICAgIGBXaGljaCBjb25jZXB0cyBhYm91dCAke3RvcGljc1sxXT8udG9Mb3dlckNhc2UoKSB8fCAndGhpcyB0b3BpYyd9IG5lZWQgbW9yZSBwcmFjdGljZT9gLFxuICAgICAgICBcIkhvdyB3aWxsIHlvdSB1c2UgdGhpcyBrbm93bGVkZ2UgaW4gcmVhbCBzaXR1YXRpb25zP1wiLFxuICAgICAgICBcIldoYXQgcXVlc3Rpb25zIGRvIHlvdSBzdGlsbCBoYXZlIGFib3V0IHRoaXMgY29udGVudD9cIixcbiAgICAgIF1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRoaXMuZ2V0VGVtcGxhdGVXcmFwdXAobGVzc29uVHlwZSlcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgbGVzc29uQUlTZXJ2ZXJHZW5lcmF0b3IgPSBuZXcgTGVzc29uQUlTZXJ2ZXJHZW5lcmF0b3IoKVxuIl0sIm5hbWVzIjpbImNyZWF0ZUdvb2dsZUFJU2VydmVyU2VydmljZSIsIkxlc3NvbkFJU2VydmVyR2VuZXJhdG9yIiwiZ2V0R29vZ2xlQUkiLCJnb29nbGVBSSIsImdlbmVyYXRlTGVzc29uIiwicGFyYW1zIiwic291cmNlVGV4dCIsImxlc3NvblR5cGUiLCJzdHVkZW50TGV2ZWwiLCJ0YXJnZXRMYW5ndWFnZSIsInNvdXJjZVVybCIsImNvbnRlbnRNZXRhZGF0YSIsInN0cnVjdHVyZWRDb250ZW50Iiwid29yZENvdW50IiwicmVhZGluZ1RpbWUiLCJjb25zb2xlIiwibG9nIiwidGV4dExlbmd0aCIsImxlbmd0aCIsImhhc01ldGFkYXRhIiwiaGFzU3RydWN0dXJlZENvbnRlbnQiLCJjb250ZW50QW5hbHlzaXMiLCJhbmFseXplQ29udGVudENvbnRleHQiLCJjb250ZXh0dWFsU3VtbWFyeSIsImNyZWF0ZUNvbnRleHR1YWxTdW1tYXJ5IiwidHJhbnNsYXRlZENvbnRlbnQiLCJ0cmFuc2xhdGUiLCJnZXRMYW5ndWFnZUNvZGUiLCJsZXNzb25TdHJ1Y3R1cmUiLCJnZW5lcmF0ZUNvbnRleHR1YWxMZXNzb25TdHJ1Y3R1cmUiLCJPYmplY3QiLCJrZXlzIiwiZGV0YWlsZWRMZXNzb24iLCJnZW5lcmF0ZURldGFpbGVkQ29udGV4dHVhbENvbnRlbnQiLCJwb2xpc2hlZExlc3NvbiIsInByb29mcmVhZExlc3NvbiIsImVycm9yIiwiZ2VuZXJhdGVFbmhhbmNlZEZhbGxiYWNrTGVzc29uIiwibWV0YWRhdGEiLCJhbmFseXNpcyIsImNvbnRlbnRUeXBlIiwiZG9tYWluIiwiY29tcGxleGl0eSIsInRvcGljcyIsImtleVZvY2FidWxhcnkiLCJjdWx0dXJhbENvbnRleHQiLCJsZWFybmluZ09iamVjdGl2ZXMiLCJkaWZmaWN1bHR5Iiwic2VudGVuY2VzIiwic3BsaXQiLCJmaWx0ZXIiLCJzIiwidHJpbSIsImF2Z1NlbnRlbmNlTGVuZ3RoIiwicmVkdWNlIiwic3VtIiwiY29tcGxleFdvcmRzIiwibWF0Y2giLCJ0b3RhbFdvcmRzIiwidG9waWNzUHJvbXB0Iiwic3Vic3RyaW5nIiwidG9waWNzUmVzcG9uc2UiLCJwcm9tcHQiLCJ0ZW1wZXJhdHVyZSIsIm1heFRva2VucyIsInBhcnNlTGlzdEZyb21UZXh0Iiwic2xpY2UiLCJ3YXJuIiwibWVzc2FnZSIsImV4dHJhY3RUb3BpY3NGcm9tSGVhZGluZ3MiLCJoZWFkaW5ncyIsInZvY2FiUHJvbXB0Iiwidm9jYWJSZXNwb25zZSIsImV4dHJhY3RWb2NhYnVsYXJ5RnJvbVRleHQiLCJkZXRlcm1pbmVDdWx0dXJhbENvbnRleHQiLCJnZW5lcmF0ZUxlYXJuaW5nT2JqZWN0aXZlcyIsInN1bW1hcnlQcm9tcHQiLCJqb2luIiwic3VtbWFyeSIsImJhc2ljU3VtbWFyeSIsInN1bW1hcml6ZSIsInR5cGUiLCJnZXRTdW1tYXJ5TGVuZ3RoIiwiZm9ybWF0Iiwic3VtbWFyeUVycm9yIiwiY29udGVudCIsInJlc3BvbnNlIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwicGFyc2VFcnJvciIsImpzb25NYXRjaCIsImNsZWFuZWQiLCJjbGVhbkVycm9yIiwiY3JlYXRlU3RydWN0dXJlZEZhbGxiYWNrIiwic3RydWN0dXJlIiwic2VjdGlvbnMiLCJ2b2NhYnVsYXJ5IiwiaSIsInZvY2FiIiwiY29udGV4dHVhbEV4YW1wbGVQcm9tcHQiLCJ3b3JkIiwiZW5oYW5jZWRFeGFtcGxlIiwid3JpdGUiLCJ0b25lIiwiZXhhbXBsZSIsImNvbnRleHR1YWxNZWFuaW5nUHJvbXB0IiwiY29udGV4dHVhbE1lYW5pbmciLCJkaXNjdXNzaW9uIiwiZW5oYW5jZWREaXNjdXNzaW9uUHJvbXB0IiwiZW5oYW5jZWREaXNjdXNzaW9uIiwicmVhZGluZyIsInN0cnVjdHVyZWRSZWFkaW5nUHJvbXB0IiwibWFwIiwiaCIsInRleHQiLCJlbmhhbmNlZFJlYWRpbmciLCJyZXdyaXRlIiwiYXVkaWVuY2UiLCJnZXRBdWRpZW5jZUxldmVsIiwiZ3JhbW1hciIsImZvY3VzIiwiZ3JhbW1hckV4YW1wbGVzUHJvbXB0IiwiY29udGV4dHVhbEdyYW1tYXJFeGFtcGxlcyIsImNvbnRleHR1YWxFeGFtcGxlcyIsImxlc3NvbiIsInNlY3Rpb25zVG9Qcm9vZnJlYWQiLCJzZWN0aW9uUGF0aCIsInZhbHVlIiwiZ2V0TmVzdGVkVmFsdWUiLCJwcm9vZnJlYWQiLCJjaGVja0dyYW1tYXIiLCJjaGVja1NwZWxsaW5nIiwiY2hlY2tTdHlsZSIsInNldE5lc3RlZFZhbHVlIiwiY29ycmVjdGVkX3RleHQiLCJnZW5lcmF0ZUZhbGxiYWNrTGVzc29uIiwid2FybXVwIiwiZ2V0VGVtcGxhdGVXYXJtdXAiLCJleHRyYWN0Vm9jYWJ1bGFyeSIsInNpbXBsaWZ5VGV4dCIsImNvbXByZWhlbnNpb24iLCJnZXRUZW1wbGF0ZUNvbXByZWhlbnNpb24iLCJnZXRUZW1wbGF0ZURpc2N1c3Npb24iLCJnZXRUZW1wbGF0ZUdyYW1tYXIiLCJwcm9udW5jaWF0aW9uIiwiZ2V0VGVtcGxhdGVQcm9udW5jaWF0aW9uIiwid3JhcHVwIiwiZ2V0VGVtcGxhdGVXcmFwdXAiLCJsZXZlbCIsImxlbmd0aE1hcCIsIkExIiwiQTIiLCJCMSIsIkIyIiwiQzEiLCJsYW5ndWFnZSIsImxhbmd1YWdlTWFwIiwic3BhbmlzaCIsImZyZW5jaCIsImdlcm1hbiIsIml0YWxpYW4iLCJwb3J0dWd1ZXNlIiwiamFwYW5lc2UiLCJrb3JlYW4iLCJjaGluZXNlIiwibGluZSIsInJlcGxhY2UiLCJvYmoiLCJwYXRoIiwiY3VycmVudCIsImtleSIsImxhc3RLZXkiLCJwb3AiLCJ0YXJnZXQiLCJ3b3JkcyIsInRvTG93ZXJDYXNlIiwidW5pcXVlV29yZHMiLCJTZXQiLCJmYWxsYmFjayIsIm1lYW5pbmciLCJ0ZW1wbGF0ZXMiLCJ0cmF2ZWwiLCJidXNpbmVzcyIsInNlbGVjdGVkV29yZHMiLCJtYXhMZW5ndGgiLCJsaW1pdCIsImdyYW1tYXJGb2NpIiwiZXhhbXBsZXMiLCJleGVyY2lzZSIsInNlbGVjdGVkV29yZCIsImlwYSIsInByYWN0aWNlIiwiY29tcGxleGl0eVRocmVzaG9sZCIsImN1bHR1cmFsSW5kaWNhdG9ycyIsImFtZXJpY2FuTWFya2VycyIsImJyaXRpc2hNYXJrZXJzIiwiYW1lcmljYW5Db3VudCIsIm1hcmtlciIsImluY2x1ZGVzIiwiYnJpdGlzaENvdW50Iiwib2JqZWN0aXZlcyIsInB1c2giLCJmb3JFYWNoIiwidG9waWMiLCJjZWZyTGV2ZWwiLCJsZXZlbE1hcCIsImdldENvbnRleHR1YWxXYXJtdXAiLCJleHRyYWN0Q29udGV4dHVhbFZvY2FidWxhcnkiLCJnZXRDb250ZXh0dWFsQ29tcHJlaGVuc2lvbiIsImdldENvbnRleHR1YWxEaXNjdXNzaW9uIiwiZ2V0Q29udGV4dHVhbFdyYXB1cCIsImJhc2VRdWVzdGlvbnMiLCJpbmRleCIsImNvbnRleHQiLCJsZXNzb25BSVNlcnZlckdlbmVyYXRvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/lesson-ai-generator-server.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createServerSupabaseClient: () => (/* binding */ createServerSupabaseClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\nconst createServerSupabaseClient = ()=>{\n    const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    return (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://jbkpnirowdvlwlgheqho.supabase.co\" || 0, \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impia3BuaXJvd2R2bHdsZ2hlcWhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5MTQ3NTEsImV4cCI6MjA3NDQ5MDc1MX0.FZhruXKDzIkZLhla5oerfs7yzjvTsGLlKTUer34N6N0\" || 0, {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            },\n            set (name, value, options) {\n                cookieStore.set({\n                    name,\n                    value,\n                    ...options\n                });\n            },\n            remove (name, options) {\n                cookieStore.set({\n                    name,\n                    value: \"\",\n                    ...options\n                });\n            }\n        }\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFrRDtBQUNaO0FBRS9CLE1BQU1FLDZCQUE2QjtJQUN4QyxNQUFNQyxjQUFjRixxREFBT0E7SUFFM0IsT0FBT0QsaUVBQWtCQSxDQUN2QkksMENBQW9DLElBQUksR0FDeENBLGtOQUF5QyxJQUFJLEdBQzdDO1FBQ0FILFNBQVM7WUFDUE8sS0FBSUMsSUFBWTtnQkFDZCxPQUFPTixZQUFZSyxHQUFHLENBQUNDLE9BQU9DO1lBQ2hDO1lBQ0FDLEtBQUlGLElBQVksRUFBRUMsS0FBYSxFQUFFRSxPQUFZO2dCQUMzQ1QsWUFBWVEsR0FBRyxDQUFDO29CQUFFRjtvQkFBTUM7b0JBQU8sR0FBR0UsT0FBTztnQkFBQztZQUM1QztZQUNBQyxRQUFPSixJQUFZLEVBQUVHLE9BQVk7Z0JBQy9CVCxZQUFZUSxHQUFHLENBQUM7b0JBQUVGO29CQUFNQyxPQUFPO29CQUFJLEdBQUdFLE9BQU87Z0JBQUM7WUFDaEQ7UUFDRjtJQUNGO0FBQ0YsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzPzA5NGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zc3JcIlxuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIlxuXG5leHBvcnQgY29uc3QgY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQgPSAoKSA9PiB7XG4gIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpXG5cbiAgcmV0dXJuIGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgJ2h0dHBzOi8vcGxhY2Vob2xkZXIuc3VwYWJhc2UuY28nLCBcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCAncGxhY2Vob2xkZXIta2V5JywgXG4gICAge1xuICAgIGNvb2tpZXM6IHtcbiAgICAgIGdldChuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGNvb2tpZVN0b3JlLmdldChuYW1lKT8udmFsdWVcbiAgICAgIH0sXG4gICAgICBzZXQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWUsIC4uLm9wdGlvbnMgfSlcbiAgICAgIH0sXG4gICAgICByZW1vdmUobmFtZTogc3RyaW5nLCBvcHRpb25zOiBhbnkpIHtcbiAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWU6IFwiXCIsIC4uLm9wdGlvbnMgfSlcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVTZXJ2ZXJDbGllbnQiLCJjb29raWVzIiwiY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQiLCJjb29raWVTdG9yZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdldCIsIm5hbWUiLCJ2YWx1ZSIsInNldCIsIm9wdGlvbnMiLCJyZW1vdmUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/cookie","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fgenerate-lesson%2Froute&page=%2Fapi%2Fgenerate-lesson%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate-lesson%2Froute.ts&appDir=D%3A%5Clinguaspark%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Clinguaspark&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();